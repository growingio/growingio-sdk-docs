<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/growingio-sdk-docs/blog/rss.xml" title="一站式数据增长引擎 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/growingio-sdk-docs/blog/atom.xml" title="一站式数据增长引擎 Blog Atom Feed"><title data-react-helmet="true">MavenCentral 迁移步骤 | 一站式数据增长引擎</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://growingio.github.io/growingio-sdk-docs/growingio-sdk-docs/blog/MavenCentral"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="MavenCentral 迁移步骤 | 一站式数据增长引擎"><meta data-react-helmet="true" name="description" content="随着 Jcenter 服务的即将过期，我们需要一个新的仓库来发行我们的SDK.于是我们找上了 MavenCentral，并针对如何在MavenCentral提交包写了这篇文章。"><meta data-react-helmet="true" property="og:description" content="随着 Jcenter 服务的即将过期，我们需要一个新的仓库来发行我们的SDK.于是我们找上了 MavenCentral，并针对如何在MavenCentral提交包写了这篇文章。"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-07-21T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/cpacm"><meta data-react-helmet="true" property="article:tag" content="scripts,gradle"><link data-react-helmet="true" rel="shortcut icon" href="/growingio-sdk-docs/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://growingio.github.io/growingio-sdk-docs/growingio-sdk-docs/blog/MavenCentral"><link data-react-helmet="true" rel="alternate" href="https://growingio.github.io/growingio-sdk-docs/growingio-sdk-docs/blog/MavenCentral" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://growingio.github.io/growingio-sdk-docs/growingio-sdk-docs/blog/MavenCentral" hreflang="x-default"><link rel="stylesheet" href="/growingio-sdk-docs/assets/css/styles.979e8752.css">
<link rel="preload" href="/growingio-sdk-docs/assets/js/runtime~main.b8ca66b8.js" as="script">
<link rel="preload" href="/growingio-sdk-docs/assets/js/main.546b92c9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/growingio-sdk-docs/"><img src="/growingio-sdk-docs/img/logo.svg" alt="GrowingIO Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/growingio-sdk-docs/img/logo.svg" alt="GrowingIO Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link" href="/growingio-sdk-docs/docs">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/growingio-sdk-docs/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://www.growingio.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>官网<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/growingio" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_MM2z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/growingio-sdk-docs/blog/MavenCentral">MavenCentral 迁移步骤</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">MavenCentral 迁移步骤</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-07-21T00:00:00.000Z" itemprop="datePublished">July 21, 2021</time> · 11 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/cpacm" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://avatars.githubusercontent.com/u/7134104?v=4" alt="cpacm"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/cpacm" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">cpacm</span></a></div><small class="avatar__subtitle" itemprop="description">GrowingIO SDK Team</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>随着 Jcenter 服务的即将过期，我们需要一个新的仓库来发行我们的SDK.于是我们找上了 MavenCentral，并针对如何在MavenCentral提交包写了这篇文章。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="注册账号"></a>注册账号<a class="hash-link" href="#注册账号" title="Direct link to heading">#</a></h2><p>前往 <a href="https://issues.sonatype.org/" target="_blank" rel="noopener noreferrer">sonatype</a> 注册账号，账号注册完毕后需要提个issue来申请 groupid .</p><p>如 <a href="https://issues.sonatype.org/browse/OSSRH-66388" target="_blank" rel="noopener noreferrer">OSSRH-66388</a> 所示，如果是GitHub或gitlab下的项目，可以申请 <code>io.github.&lt;yourname&gt;</code>。
如果是域名，则需要在域名的dns解析下添加 TXT 记录，如 <a href="https://issues.sonatype.org/browse/OSSRH-66397" target="_blank" rel="noopener noreferrer">OSSRH-66397</a>举例，txt前缀为OSSRH-66397 值为网址<a href="https://issues.sonatype.org/browse/OSSRH-66397" target="_blank" rel="noopener noreferrer">https://issues.sonatype.org/browse/OSSRH-66397</a>.</p><blockquote><p>在2021年2月前申请的账号，maven仓库的地址为 <a href="https://oss.sonatype.org/" target="_blank" rel="noopener noreferrer">https://oss.sonatype.org/</a>，而在之后申请的的地址为 <a href="https://s01.oss.sonatype.org/" target="_blank" rel="noopener noreferrer">https://s01.oss.sonatype.org/</a>.不过也可以在<a href="https://issues.sonatype.org/" target="_blank" rel="noopener noreferrer">sonatype</a>上提 issue 来申请变更域名地址，如这个issue所示-&gt;<a href="https://issues.sonatype.org/browse/OSSRH-66964" target="_blank" rel="noopener noreferrer">OSSRH-66964</a></p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="maven-central"></a>Maven Central<a class="hash-link" href="#maven-central" title="Direct link to heading">#</a></h2><p>注册结束后，可以前往<a href="https://s01.oss.sonatype.org/" target="_blank" rel="noopener noreferrer">nexus repository</a>查看自己的仓库。在仓库中一般分为两种提交方式，一种是 SNAPSHOT 版本，一种是正式版本。
两者仓库地址不同，分别为：<a href="https://s01.oss.sonatype.org/content/repositories/snapshots" target="_blank" rel="noopener noreferrer">https://s01.oss.sonatype.org/content/repositories/snapshots</a> 和 <a href="https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/" target="_blank" rel="noopener noreferrer">https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="snapshot"></a>SNAPSHOT<a class="hash-link" href="#snapshot" title="Direct link to heading">#</a></h3><p>SNAPSHOT 版本可以在同一版本号下多次提交，当其他人拉取该版本号时会取最后提交的包，如下图所示
<img alt="SNAPSHOT" src="/growingio-sdk-docs/assets/images/SNAPSHOT-df589c8a731b619549f4b193393ae814.png">
在 SNAPSHOT 仓库中同一个版本下多个包会通过提交日期来区分，这样别人依赖某个版本时就能获得最新更新的包。
同时 SNAPSHOT 不会对提交的包进行 <code>close</code> 操作来对其进行审核，没有一定要有 <code>javadoc</code>、<code>sources</code>、<code>GPG加密</code>等要求。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="正式版"></a>正式版<a class="hash-link" href="#正式版" title="Direct link to heading">#</a></h3><p>提交正式版后包会先进入 <code>Staging Repositories</code>,然后需要在这里依次执行 <code>close</code> 和 <code>release</code> 操作，<code>close</code>操作会验证本次的提交的包是否包含 <code>javadoc</code>、<code>sources</code>、<code>GPG加密文件</code> 和 <code>pom</code>文件的合法等，通过后才能执行 <code>release</code> 操作向官方仓库发布。</p><p><img alt="Staging Repositories" src="/growingio-sdk-docs/assets/images/Repositories-47dce28bfb4733fb20a5b42150110bf2.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="开始准备"></a>开始准备<a class="hash-link" href="#开始准备" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-配置-gpg-私钥"></a>1. 配置 GPG 私钥<a class="hash-link" href="#1-配置-gpg-私钥" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cmd"><pre tabindex="0" class="prism-code language-cmd codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># 生成证书，里面会要求输入用户名和密码，有效期两年。</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --gen-key</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看公钥</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-keys</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看私钥</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-secret-keys</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将证书上传 key server，恩，国内需要代理</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --keyserver-options http-proxy=127.0.0.1:1087 --send-keys D81E8990E415EDE0</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看8位短id</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-keys --keyid-format short</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># 生成私钥文件，配置到gradle使用</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --export-secret-keys -o secring.gpg</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># 生成base64文件，后续放入github secrets 中使用</span></span><span class="token-line" style="color:#393A34"><span class="token plain">base64 secring.gpg &gt; secring.gpg.b64</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>具体可参考 <a href="https://central.sonatype.org/publish/requirements/gpg/" target="_blank" rel="noopener noreferrer">gpg配置</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-本地全局-gradle-配置"></a>2. 本地全局 gradle 配置<a class="hash-link" href="#2-本地全局-gradle-配置" title="Direct link to heading">#</a></h3><p>找到 <code>.gradle</code>文件夹下gradle.properties文件，如下进行配置</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly gradle"><pre tabindex="0" class="prism-code language-gradle codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">## growingio&#x27;s config</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NEXUS_USERNAME=&lt;sonatype账号&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NEXUS_PASSWORD=&lt;sonatype密码&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">signing.keyId=09B66CAF</span></span><span class="token-line" style="color:#393A34"><span class="token plain">signing.password=&lt;生成证书时的输入密码&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">signing.secretKeyRingFile=&lt;生成私钥文件的文件路径&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>当然在项目下的gradle.properties也同样生效。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="3-配置-pom-文件"></a>3. 配置 pom 文件<a class="hash-link" href="#3-配置-pom-文件" title="Direct link to heading">#</a></h3><p>在根项目下的 gradle.properties 添加以下配置说明，这些说明将会一一填入到 pom 文件中</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">GROUP=com.growingio.android</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_DESCRIPTION=GrowingIO Android SDK Library.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_DEVELOPER_EMAIL=sdk-integration@growingio.com</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_URL=https://github.com/growingio/growingio-sdk-android-autotracker</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_SCM_URL=https://github.com/growingio/growingio-sdk-android-autotracker</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_SCM_CONNECTION=scm:git@github.com:growingio/growingio-sdk-android-autotracker.git</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_SCM_DEV_CONNECTION=scm:git@github.com:growingio/growingio-sdk-android-autotracker.git</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_LICENCE_NAME=The Apache Software License, Version 2.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_LICENCE_URL=http://www.apache.org/licenses/LICENSE-2.0.txt</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_LICENCE_DIST=repo</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_DEVELOPER_ID=GrowingIo Sdk</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_DEVELOPER_NAME=GrowingIo Sdk</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="4-编写gradle的maven上传代码"></a>4. 编写gradle的maven上传代码<a class="hash-link" href="#4-编写gradle的maven上传代码" title="Direct link to heading">#</a></h3><p><a href="https://central.sonatype.org/publish/publish-gradle/" target="_blank" rel="noopener noreferrer">sonatype 的gradle教程</a> 已经过期好久了，这里推荐在 Github 上的<a href="https://github.com/chrisbanes/gradle-mvn-push" target="_blank" rel="noopener noreferrer">gradle-mvn-push</a>。后面的所有改动都基于在这个文件版本上得来的，具体如何改动在后续说明。
示例代码 <code>publishMaven.gradle</code>：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/*</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Copyright 2021 Cpacm</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * you may not use this file except in compliance with the License.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * You may obtain a copy of the License at</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Unless required by applicable law or agreed to in writing, software</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * See the License for the specific language governing permissions and</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * limitations under the License.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Based on: https://github.com/mcxiaoke/gradle-mvn-push/blob/master/gradle-mvn-push.gradle.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * To install in a local maven repo:</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 1. In the project you want to test, add mavenLocal() to the repositories list.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 2. In Project, run: ./gradlew publishToMavenLocal</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * For faster runs add: -x check when building.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">apply plugin: &#x27;maven-publish&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">apply plugin: &#x27;signing&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">version = releaseConfiguration.releaseVersion</span></span><span class="token-line" style="color:#393A34"><span class="token plain">group = GROUP</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@SuppressWarnings(&quot;GrMethodMayBeStatic&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">def isReleaseBuild() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return !version.contains(&quot;SNAPSHOT&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">def getReleaseRepositoryUrl() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return hasProperty(&#x27;RELEASE_REPOSITORY_URL&#x27;) ? RELEASE_REPOSITORY_URL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            : &#x27;https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">def getSnapshotRepositoryUrl() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return hasProperty(&#x27;SNAPSHOT_REPOSITORY_URL&#x27;) ? SNAPSHOT_REPOSITORY_URL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            : &#x27;https://s01.oss.sonatype.org/content/repositories/snapshots/&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">def getRepositoryUsername() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return hasProperty(&#x27;USERNAME&#x27;) ? USERNAME : (hasProperty(&#x27;NEXUS_USERNAME&#x27;) ? NEXUS_USERNAME : &#x27;&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">def getRepositoryPassword() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return hasProperty(&#x27;PASSWORD&#x27;) ? PASSWORD : (hasProperty(&#x27;NEXUS_PASSWORD&#x27;) ? NEXUS_PASSWORD : &#x27;&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">def configurePom(pom) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom.name = POM_NAME</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom.packaging = POM_PACKAGING</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom.description = POM_DESCRIPTION</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom.url = POM_URL</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom.scm {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        url = POM_SCM_URL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        connection = POM_SCM_CONNECTION</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        developerConnection = POM_SCM_DEV_CONNECTION</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom.licenses {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        license {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            name = POM_LICENCE_NAME</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            url = POM_LICENCE_URL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            distribution = POM_LICENCE_DIST</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom.developers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        developer {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            id = POM_DEVELOPER_ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            name = POM_DEVELOPER_NAME</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            email = POM_DEVELOPER_EMAIL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">afterEvaluate { project -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def isAndroidProject = project.plugins.hasPlugin(&#x27;com.android.application&#x27;) || project.plugins.hasPlugin(&#x27;com.android.library&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    publishing {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        repositories {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            maven {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                def releasesRepoUrl = getReleaseRepositoryUrl()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                def snapshotsRepoUrl = getSnapshotRepositoryUrl()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                url = isReleaseBuild() ? releasesRepoUrl : snapshotsRepoUrl</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                credentials(PasswordCredentials) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    username = getRepositoryUsername()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    password = getRepositoryPassword()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (isAndroidProject) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        task androidJavadocs(type: Javadoc, dependsOn: assembleDebug) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            source = android.sourceSets.main.java.source</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            classpath += project.files(android.getBootClasspath().join(File.pathSeparator))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // include BuildConfig.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            classpath += project.files(project.file(&quot;build/generated/source/buildConfig/debug&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            excludes = [&#x27;**/*.kt&#x27;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        task androidJavadocsJar(type: Jar, dependsOn: androidJavadocs) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            classifier = &#x27;javadoc&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            from androidJavadocs.destinationDir</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        task androidSourcesJar(type: Jar) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            classifier = &#x27;sources&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            from android.sourceSets.main.java.source</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        android.libraryVariants.all { variant -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tasks.androidJavadocs.doFirst {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                classpath += files(variant.javaCompileProvider.get().classpath.files.join(File.pathSeparator))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        task sourcesJar(type: Jar, dependsOn: classes) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            classifier = &#x27;sources&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            from sourceSets.main.allSource</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        task javadocsJar(type: Jar, dependsOn: javadoc) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            classifier = &#x27;javadoc&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            from javadoc.destinationDir</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        artifacts {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            archives sourcesJar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            archives javadocsJar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (JavaVersion.current().isJava8Compatible()) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        allprojects {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tasks.withType(Javadoc) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                options.addStringOption(&#x27;Xdoclint:none&#x27;, &#x27;-quiet&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (JavaVersion.current().isJava9Compatible()) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        allprojects {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tasks.withType(Javadoc) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                options.addBooleanOption(&#x27;html5&#x27;, true)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    artifacts {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (isAndroidProject) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            archives androidSourcesJar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            archives androidJavadocsJar</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            archives project.tasks.bundleDebugAar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    publishing {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        publications {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            mavenAgent(MavenPublication) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                groupId GROUP</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                artifactId POM_ARTIFACT_ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                version version</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                configurePom(pom)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (isAndroidProject) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    artifact bundleReleaseAar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    artifact androidSourcesJar</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    pom.withXml {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        def dependenciesNode = asNode().appendNode(&#x27;dependencies&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        project.configurations.all { configuration -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            def name = configuration.name</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            // api will duplicate with implementation</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            if (name == &#x27;releaseImplementation&#x27; || name == &#x27;implementation&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                configuration.allDependencies.each {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    if (it.name != &quot;unspecified&quot; &amp;&amp; it.version != &quot;unspecified&quot;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        def groupId = it.group</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        def artifactId = it.name</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        if (it instanceof ProjectDependency) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            def properties = it.getDependencyProject().getProperties()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            groupId = properties.get(&quot;GROUP&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            artifactId = properties.get(&quot;POM_ARTIFACT_ID&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        println &quot;dependencies:&quot; + groupId + &quot;:&quot; + artifactId + &quot;:&quot; + it.version</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        def dependencyNode = dependenciesNode.appendNode(&#x27;dependency&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        dependencyNode.appendNode(&#x27;groupId&#x27;, groupId)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        dependencyNode.appendNode(&#x27;artifactId&#x27;, artifactId)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        dependencyNode.appendNode(&#x27;version&#x27;, it.version)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        dependencyNode.appendNode(&#x27;scope&#x27;, &#x27;compile&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                } else {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    from components.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    artifact sourcesJar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    artifact javadocsJar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (project.plugins.hasPlugin(&#x27;java-gradle-plugin&#x27;)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                pluginMaven(MavenPublication) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    groupId GROUP</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    artifactId POM_ARTIFACT_ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    version version</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    configurePom(pom)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">signing {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    required { isReleaseBuild() &amp;&amp; gradle.taskGraph.hasTask(&quot;publish&quot;) }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    publishing.publications.all { publication -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        sign publication</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>基本使用：在需要发布的项目下添加 <code>gradle.properties</code>文件，并注明 <code>ARTIFACT_ID</code>名，如下：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">POM_NAME=autotracker</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_ARTIFACT_ID=autotracker</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_PACKAGING=aar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_DESCRIPTION=GrowingIO Android SDK AutoTracker.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>同时在 <code>build.gradle</code> 中引入该文件</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly gradle"><pre tabindex="0" class="prism-code language-gradle codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">apply from: &quot;${rootProject.projectDir}/gradle/publishMaven.gradle&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cmd"><pre tabindex="0" class="prism-code language-cmd codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># 上传到本地仓库</span></span><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew publishToMavenLocal</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># 上传到远程仓库</span></span><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew publish</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="5-github-ci脚本"></a>5. Github Ci脚本<a class="hash-link" href="#5-github-ci脚本" title="Direct link to heading">#</a></h3><p>GitHub上有提供 Action 这一工具，该工具可以在线上进行各种操作：比如编译，测试，校验等，所以打包上传也是可以的。</p><ol><li><p>配置 Github Secrets
<img alt="Github Secrets" src="/growingio-sdk-docs/assets/images/Secrets-97c7b28c2cd437c3b4768d3bb6ae38ad.png">
各个配置分别对应 <code>全局 gradle 配置</code> 步骤中的各个参数，其中 <code>SIGNING_SECRET_KEY_RING_FILE</code> 是秘钥文件经过 base64 后产生的字符串。</p></li><li><p>自动 close 和 release
这里直接使用 <a href="https://github.com/Codearte/gradle-nexus-staging-plugin" target="_blank" rel="noopener noreferrer">gradle-nexus-staging-plugin</a>的插件。它能通过 sonatype 的api来自动实现 <code>Staging Repositories</code>上的close和release操作</p></li><li><p>完整ci脚本</p></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Publish Maven</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">types</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">published</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">publish</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v2</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set up JDK 1.8</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">java@v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">java-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Gradle 缓存配置</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Cache Gradle packages</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/cache@v2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~/.gradle/caches</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> runner.os </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gradle</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> hashFiles(&#x27;</span><span class="token important">**/*.gradle&#x27;)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">restore-keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> runner.os </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gradle</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 给 gradlew 文件授权</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Grant Permission to Execute</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          chmod +x gradlew</span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          chmod +x gradle/publishAllToMavenLocal.sh</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 构建项目</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Build with Gradle</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          bash ./gradle/publishAllToMavenLocal.sh</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 解码秘钥</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Decode</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          echo &quot;${{secrets.SIGNING_SECRET_KEY_RING_FILE}}&quot; &gt; ~/.gradle/secring.gpg.b64</span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          base64 -d ~/.gradle/secring.gpg.b64 &gt; ~/.gradle/secring.gpg</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Publish to Sonatype</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">NEXUS_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.NEXUS_USERNAME </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">NEXUS_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.NEXUS_PASSWORD </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./gradlew publish </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">PNEXUS_USERNAME=&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">NEXUS_USERNAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">PNEXUS_PASSWORD=&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">NEXUS_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Psigning.keyId=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">secrets.SIGNING_KEY_ID</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Psigning.password=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">secrets.SIGNING_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Psigning.secretKeyRingFile=$(echo ~/.gradle/secring.gpg)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Close And Release Package</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">NEXUS_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.NEXUS_USERNAME </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">NEXUS_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.NEXUS_PASSWORD </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./gradlew tryCloseAndReleaseRepository </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">PNEXUS_USERNAME=&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">NEXUS_USERNAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">PNEXUS_PASSWORD=&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">NEXUS_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>至此，一套完整的自动打包系统就搭建完成了。</p><hr><p>参考资料：</p><ol><li><a href="https://docs.github.com/cn/actions/reference/events-that-trigger-workflows" target="_blank" rel="noopener noreferrer">github action</a></li><li><a href="https://docs.gradle.org/current/userguide/signing_plugin.html#sec:signatory_credentials" target="_blank" rel="noopener noreferrer">gradle 配置</a></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="附录：关于在-growingio-各个仓库上遇到的几个问题"></a>附录：关于在 GrowingIO 各个仓库上遇到的几个问题<a class="hash-link" href="#附录：关于在-growingio-各个仓库上遇到的几个问题" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="gradle-plugin-插件打包"></a>gradle plugin 插件打包<a class="hash-link" href="#gradle-plugin-插件打包" title="Direct link to heading">#</a></h3><p>plugin项目应该属于 java 项目，但在 <code>publications</code>下它会单独走 <code>pluginMaven</code>，所以需要对其做特别处理来规范其 ARTIFACT_ID</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">if (project.plugins.hasPlugin(&#x27;java-gradle-plugin&#x27;)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    pluginMaven(MavenPublication) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        groupId GROUP</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        artifactId POM_ARTIFACT_ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        version version</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        configurePom(pom)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="javadoc找不到buildconfig文件"></a>javadoc找不到BuildConfig文件<a class="hash-link" href="#javadoc找不到buildconfig文件" title="Direct link to heading">#</a></h3><p>这里需要在生成 javadoc 包的时候添加 BuildConfig类的路径到 classpath 中。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">task androidJavadocs(type: Javadoc, dependsOn: assembleDebug) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    source = android.sourceSets.main.java.source</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    classpath += project.files(android.getBootClasspath().join(File.pathSeparator))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // include BuildConfig.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    classpath += project.files(project.file(&quot;build/generated/source/buildConfig/debug&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    excludes = [&#x27;**/*.kt&#x27;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>当然可能不同版本的gradle生成的地址不一样，请自己测试并添加</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="关于-uploadarchives"></a>关于 uploadArchives<a class="hash-link" href="#关于-uploadarchives" title="Direct link to heading">#</a></h3><p>旧版本 Gradle 的task，依赖于插件 maven。现在一般都是</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">apply plugin: &#x27;maven-publish&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">afterEvaluate { project -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    publishing {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>且在 gradle 版本 5.0后，需要将 publishing 放置在 afterEvaluate 中。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="关于依赖"></a>关于依赖<a class="hash-link" href="#关于依赖" title="Direct link to heading">#</a></h3><p>api依赖和implementation依赖会重复出现在 <code>project.configurations.all</code>循环中(api &gt; implementation)，所以只需要判断 <code>implementation</code>即可</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">pom.withXml {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def dependenciesNode = asNode().appendNode(&#x27;dependencies&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    project.configurations.all { configuration -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        def name = configuration.name</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // api will duplicate with implementation</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (name == &#x27;releaseImplementation&#x27; || name == &#x27;implementation&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            configuration.allDependencies.each {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (it.name != &quot;unspecified&quot; &amp;&amp; it.version != &quot;unspecified&quot;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    def groupId = it.group</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    def artifactId = it.name</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (it instanceof ProjectDependency) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        def properties = it.getDependencyProject().getProperties()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        groupId = properties.get(&quot;GROUP&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        artifactId = properties.get(&quot;POM_ARTIFACT_ID&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    println &quot;dependencies:&quot; + groupId + &quot;:&quot; + artifactId + &quot;:&quot; + it.version</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    def dependencyNode = dependenciesNode.appendNode(&#x27;dependency&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    dependencyNode.appendNode(&#x27;groupId&#x27;, groupId)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    dependencyNode.appendNode(&#x27;artifactId&#x27;, artifactId)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    dependencyNode.appendNode(&#x27;version&#x27;, it.version)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    dependencyNode.appendNode(&#x27;scope&#x27;, &#x27;compile&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/growingio-sdk-docs/blog/tags/scripts">scripts</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/growingio-sdk-docs/blog/tags/gradle">gradle</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2021-07-21-maven publish.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#注册账号" class="table-of-contents__link">注册账号</a></li><li><a href="#maven-central" class="table-of-contents__link">Maven Central</a><ul><li><a href="#snapshot" class="table-of-contents__link">SNAPSHOT</a></li><li><a href="#正式版" class="table-of-contents__link">正式版</a></li></ul></li><li><a href="#开始准备" class="table-of-contents__link">开始准备</a><ul><li><a href="#1-配置-gpg-私钥" class="table-of-contents__link">1. 配置 GPG 私钥</a></li><li><a href="#2-本地全局-gradle-配置" class="table-of-contents__link">2. 本地全局 gradle 配置</a></li><li><a href="#3-配置-pom-文件" class="table-of-contents__link">3. 配置 pom 文件</a></li><li><a href="#4-编写gradle的maven上传代码" class="table-of-contents__link">4. 编写gradle的maven上传代码</a></li><li><a href="#5-github-ci脚本" class="table-of-contents__link">5. Github Ci脚本</a></li></ul></li><li><a href="#附录：关于在-growingio-各个仓库上遇到的几个问题" class="table-of-contents__link">附录：关于在 GrowingIO 各个仓库上遇到的几个问题</a><ul><li><a href="#gradle-plugin-插件打包" class="table-of-contents__link">gradle plugin 插件打包</a></li><li><a href="#javadoc找不到buildconfig文件" class="table-of-contents__link">javadoc找不到BuildConfig文件</a></li><li><a href="#关于-uploadarchives" class="table-of-contents__link">关于 uploadArchives</a></li><li><a href="#关于依赖" class="table-of-contents__link">关于依赖</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/growingio-sdk-docs/docs">文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">SDK</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/growingio/growingio-sdk-android-autotracker" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Android<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/growingio/growingio-sdk-ios-autotracker" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>iOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/growingio/growingio-sdk-js-autotracker" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Web<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.growingio.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>官网<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/growingio-sdk-docs/blog">博客</a></li><li class="footer__item"><a href="https://github.com/growingio" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 北京易数科技有限公司 -- Built with Docusaurus.</div></div></div></footer></div>
<script src="/growingio-sdk-docs/assets/js/runtime~main.b8ca66b8.js"></script>
<script src="/growingio-sdk-docs/assets/js/main.546b92c9.js"></script>
</body>
</html>
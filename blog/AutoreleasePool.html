<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">ä» iOS AutoreleasePool åˆ°ç¼–è¯‘å™¨ä¼˜åŒ– | ä¸€ç«™å¼æ•°æ®å¢é•¿å¼•æ“</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://growingio.github.io/growingio-sdk-docs/blog/AutoreleasePool"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="ä» iOS AutoreleasePool åˆ°ç¼–è¯‘å™¨ä¼˜åŒ– | ä¸€ç«™å¼æ•°æ®å¢é•¿å¼•æ“"><meta data-rh="true" name="description" content="main.m ä¸­çš„ AutoreleasePool"><meta data-rh="true" property="og:description" content="main.m ä¸­çš„ AutoreleasePool"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-02-22T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/YoloMao"><meta data-rh="true" property="article:tag" content="iOS,AutoreleasePool,ç¼–è¯‘å™¨ä¼˜åŒ–"><link data-rh="true" rel="icon" href="/growingio-sdk-docs/img/favicon.png"><link data-rh="true" rel="canonical" href="https://growingio.github.io/growingio-sdk-docs/blog/AutoreleasePool"><link data-rh="true" rel="alternate" href="https://growingio.github.io/growingio-sdk-docs/blog/AutoreleasePool" hreflang="en"><link data-rh="true" rel="alternate" href="https://growingio.github.io/growingio-sdk-docs/blog/AutoreleasePool" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/growingio-sdk-docs/blog/rss.xml" title="ä¸€ç«™å¼æ•°æ®å¢é•¿å¼•æ“ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/growingio-sdk-docs/blog/atom.xml" title="ä¸€ç«™å¼æ•°æ®å¢é•¿å¼•æ“ Atom Feed"><link rel="stylesheet" href="/growingio-sdk-docs/assets/css/styles.fa513506.css">
<script src="/growingio-sdk-docs/assets/js/runtime~main.2392a697.js" defer="defer"></script>
<script src="/growingio-sdk-docs/assets/js/main.1edde875.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>


<script src="https://growingio.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e-T/-dtzt95/b/3/c95134bc67d3a521bb3f4331beb9b804/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?jsI18nTransformer=existing&amp;locale=en-US&amp;collectorId=d067cced"></script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">è‹¥è¦é›†æˆ3.0è€ç‰ˆæœ¬çš„SDK, è¯·å‰å¾€ ğŸ‘‰ <a target="_blank" rel="noopener noreferrer" href="https://growingio.github.io/growingio-sdk-docs-v3/">GrowingIO SDK 3.0 </a> ğŸ‘ˆ</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/growingio-sdk-docs/"><div class="navbar__logo"><img src="/growingio-sdk-docs/img/logo.svg" alt="GrowingIO Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/growingio-sdk-docs/img/logo_white.svg" alt="GrowingIO Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/growingio-sdk-docs/docs">å®¢æˆ·ç«¯æ–‡æ¡£</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/growingio-sdk-docs/docs/android">Android</a></li><li><a class="dropdown__link" href="/growingio-sdk-docs/docs/ios">Apple</a></li><li><a class="dropdown__link" href="/growingio-sdk-docs/docs/webjs">Web JS</a></li><li><a class="dropdown__link" href="/growingio-sdk-docs/docs/miniprogram">å°ç¨‹åº</a></li><li><a class="dropdown__link" href="/growingio-sdk-docs/docs/framework">å¤šå¹³å°</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/growingio-sdk-docs/docs/server">æœåŠ¡ç«¯æ–‡æ¡£</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/growingio-sdk-docs/docs/server/Java SDK">Java SDK</a></li><li><a class="dropdown__link" href="/growingio-sdk-docs/docs/server/PHP SDK">PHP SDK</a></li><li><a class="dropdown__link" href="/growingio-sdk-docs/docs/server/Python SDK">Python SDK</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/growingio-sdk-docs/knowledge">æ•°æ®æŒ‡å—</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/growingio-sdk-docs/knowledge/basicknowledge">åŸºç¡€çŸ¥è¯†</a></li><li><a class="dropdown__link" href="/growingio-sdk-docs/knowledge/compliance">åˆè§„æŒ‡å—</a></li><li><a class="dropdown__link" href="/growingio-sdk-docs/knowledge/debugverify">æ•°æ®æ ¡éªŒ</a></li><li><a class="dropdown__link" href="/growingio-sdk-docs/knowledge/measurement">æµ‹é‡åè®®</a></li></ul></div><a class="navbar__item navbar__link" href="/growingio-sdk-docs/docs/question">å¸¸è§é—®é¢˜</a></div><div class="navbar__items navbar__items--right"><a href="https://growingio.github.io/growingio-sdk-docs-v3/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">V3.0æ–‡æ¡£<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/growingio-sdk-docs/blog">åšå®¢</a><a href="https://github.com/growingio" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/growingio-sdk-docs/blog/custom ios sdk">åŸºäº GrowingIO ç°æœ‰ SDK åŸºç¡€ä¸Šçš„äºŒæ¬¡å¼€å‘ - iOS ç¯‡</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/growingio-sdk-docs/blog/custom android sdk">åŸºäº GrowingIO ç°æœ‰ SDK åŸºç¡€ä¸Šçš„äºŒæ¬¡å¼€å‘ - Android ç¯‡</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/growingio-sdk-docs/blog/AutoreleasePool">ä» iOS AutoreleasePool åˆ°ç¼–è¯‘å™¨ä¼˜åŒ–</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/growingio-sdk-docs/blog/JS Error">ä¸€æ–‡æå®šå‰ç«¯é”™è¯¯æ•è·å’Œä¸ŠæŠ¥</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/growingio-sdk-docs/blog/MavenCentral">MavenCentral è¿ç§»æ­¥éª¤</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="main.m ä¸­çš„ AutoreleasePool"><header><h1 class="title_f1Hy" itemprop="headline">ä» iOS AutoreleasePool åˆ°ç¼–è¯‘å™¨ä¼˜åŒ–</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-02-22T00:00:00.000Z" itemprop="datePublished">February 22, 2022</time> Â· <!-- -->12 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/YoloMao" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/16042670?v=4" alt="YoloMao" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/YoloMao" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">YoloMao</span></a></div><small class="avatar__subtitle" itemprop="description">GrowingIO SDK Team</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>main.m ä¸­çš„ AutoreleasePool
æŸæ¬¡å¶ç„¶å‘ç°main.mé‡Œçš„ main å‡½æ•°æœ‰æ‰€å˜åŒ–ï¼Œç»è¿‡ä¸€ç•ªæŸ¥è¯¢[1]ï¼Œå‘ç°æ˜¯ä» Xcode 11 å¼€å§‹ã€‚</p>
<picture><source srcset="/growingio-sdk-docs/blog/autoreleasepool/autoreleasepool-1.avif" type="image/avif"><source srcset="/growingio-sdk-docs/blog/autoreleasepool/autoreleasepool-1.webp" type="image/webp"><img src="/growingio-sdk-docs/blog/autoreleasepool/autoreleasepool-1.png"></picture>
<p>è€Œåœ¨æ­¤ä¹‹å‰ï¼Œ main å‡½æ•°çš„å®ç°ä¸ºï¼š</p>
<picture><source srcset="/growingio-sdk-docs/blog/autoreleasepool/autoreleasepool-2.avif" type="image/avif"><source srcset="/growingio-sdk-docs/blog/autoreleasepool/autoreleasepool-2.webp" type="image/webp"><img src="/growingio-sdk-docs/blog/autoreleasepool/autoreleasepool-2.png"></picture>
<p>ç†Ÿæ‚‰ AutoreleasePool åº•å±‚åŸç†çš„åŒå­¦åº”è¯¥éƒ½çŸ¥é“ï¼Œåœ¨@autoreleasepoolä½œç”¨èŒƒå›´å†…ç”Ÿæˆçš„å¯¹è±¡ï¼Œåœ¨ ARC çš„ä½œç”¨ä¸‹ï¼Œå°†åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± ã€‚å¦‚ Xcode 11 ä¹‹å‰çš„ main å‡½æ•°ï¼Œå®é™…å†…å­˜ç®¡ç†å°†å¤§æ¦‚ä¼šå±•å¼€ä¸ºä»¥ä¸‹å®ç°ï¼š</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pool </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">objc_autoreleasePoolPush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NSString </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">appDelegateClassName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NSStringFromClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AppDelegate class</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Â Â </span><span class="token comment" style="color:#999988;font-style:italic">// objc_autorelease(appDelegateClassName);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">objc_autoreleaseReturnValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appDelegateClassName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Â Â </span><span class="token comment" style="color:#999988;font-style:italic">// objc_retain(appDelegateClassName);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">objc_retainAutoreleasedReturnValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appDelegateClassName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> tmp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">UIApplicationMain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> appDelegateClassName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">objc_release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appDelegateClassName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å¯¹pushå’Œpopä¹‹é—´åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± çš„å¯¹è±¡è¿›è¡Œreleaseæ“ä½œï¼Œå³[appDelegateClassName release];</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">objc_autoreleasePoolPop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ä½†å®é™…ä¸Šï¼š</p>
<p>UIApplicationMainå‡½æ•°åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ä¸ä¼šè¿”å›ï¼Œå› æ­¤è¿™é‡Œç”Ÿæˆçš„ appDelegateClassName å¯¹è±¡ä¸€ç›´ä¼šå¤„åœ¨å †ä¸Šæ— æ³•é‡Šæ”¾é€ æˆå†…å­˜æ³„æ¼ï¼›</p>
<p>å¹¶ä¸”ç¨‹åºç»ˆæ­¢ä¹‹åï¼Œæ‰€ä½¿ç”¨çš„çš„å†…å­˜ç©ºé—´å°†ä¼šç”±ç³»ç»Ÿå›æ”¶ï¼Œè‡ªåŠ¨é‡Šæ”¾æ± çš„ drain åœ¨è¿™é‡Œæ²¡æœ‰æ„ä¹‰ã€‚</p>
<p>æ–°çš„æ¨¡æ¿ä»£ç ä¸­ï¼Œå°† appDelegateClassName å¯¹è±¡çš„åˆå§‹åŒ–æ“ä½œä¸UIApplicationMainåˆ†ç¦»å¼€ï¼Œå±•å¼€åå¦‚ä¸‹ï¼š</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NSString </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">appDelegateClassName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pool </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">objc_autoreleasePoolPush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  appDelegateClassName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NSStringFromClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AppDelegate class</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// objc_autorelease(appDelegateClassName);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  appDelegateClassName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">objc_autoreleaseReturnValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appDelegateClassName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// objc_retain(appDelegateClassName);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  appDelegateClassName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">objc_retainAutoreleasedReturnValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appDelegateClassName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æœªçŸ¥ä½œç”¨ï¼Œåœ¨æ±‡ç¼–ä¸­ï¼Œå¯„å­˜å™¨r0çš„å€¼ä¸º0x0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">objc_release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nil</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å¯¹è‡ªåŠ¨é‡Šæ”¾æ± å†…æ‰€æœ‰å¯¹è±¡è¿›è¡Œreleaseæ“ä½œï¼Œå³[appDelegateClassName release];</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">objc_autoreleasePoolPop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> tmp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">UIApplicationMain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> appDelegateClassName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">objc_storeStrong</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">appDelegateClassName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nil</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>appDelegateClassName å¯¹è±¡è¿˜æ˜¯å¾—ä¸åˆ°é‡Šæ”¾ï¼Œç¨‹åºåœ¨ç»ˆæ­¢å‰ä¸ä¼šæ‰§è¡Œåˆ°objc_storeStrong(&amp;appDelegateClassName, nil);ã€‚</p>
<p>é‚£ä¹ˆä¿®æ”¹çš„æ„ä¹‰ä½•åœ¨å‘¢ï¼Ÿ</p>
<p>// Setup code that might create autoreleased objects goes here.</p>
<p>å¦‚æœéœ€è¦åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡ï¼Œé‚£ä¹ˆç°åœ¨ï¼Œåœ¨@autoreleasepoolä½œç”¨åŸŸå†…åˆ›å»ºå³å¯æ­£å¸¸é‡Šæ”¾ã€‚</p>
<p><strong>æ³¨æ„ï¼šä»¥ä¸Šç¤ºä¾‹ä»£ç ä¸­</strong>ï¼Œobjc_autoreleaseReturnValue(appDelegateClassName) å…¶å®æ˜¯åœ¨ NSStringFromClass([AppDelegate class])ä¸­è°ƒç”¨ï¼Œè¿™é‡Œå°†å®ƒæå–å‡ºæ¥æ–¹ä¾¿ç†è§£ã€‚</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="thread-local-storage">Thread Local Storage<a href="#thread-local-storage" class="hash-link" aria-label="Direct link to Thread Local Storage" title="Direct link to Thread Local Storage">â€‹</a></h3>
<p>å…¶å®åœ¨ä¸Šæ–‡çš„ä¼ªå®ç°ä¸­ï¼Œobjc_autoreleaseReturnValue(appDelegateClassName)å’Œobjc_retainAutoreleasedReturnValue(appDelegateClassName)å¯ä»¥å»æ‰ï¼Œè¿™ä¸€åˆ‡éƒ½å½’åŠŸäº AutoreleasePool ä¸çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆThread Local Storage, TLSï¼‰[2]çš„é…åˆã€‚</p>
<p>åœ¨ arm64 æ¶æ„ä¸‹ï¼Œobjc_autoreleaseReturnValueæ‰§è¡Œæ—¶ï¼Œä¼šé€šè¿‡__builtin_return_address(0)åˆ¤æ–­å½“å‰å‡½æ•°è¿”å›åœ°å€å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œæ˜¯å¦æ˜¯mov fp, fpï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°† 0x1 ä½œä¸º valueï¼ŒRETURN_DISPOSITION_KEY ä½œä¸º keyï¼Œå­˜å‚¨åœ¨ TLS ä¸­ï¼Œå¹¶ç›´æ¥è¿”å› objï¼Œä¸æ‰§è¡Œobjc_autorelease(obj)ï¼›</p>
<p>ç›¸å…³æºç å¦‚ä¸‹ï¼š</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// NSObject.mm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Prepare a value at +1 for return through a +0 autoreleasing convention.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">objc_autoreleaseReturnValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">prepareOptimizedReturn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ReturnAtPlus1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">objc_autorelease</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// objc-object.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">ReturnDisposition</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bool </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ReturnAtPlus0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ReturnAtPlus1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Try to prepare for optimized return with the given disposition (+0 or +1).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Returns true if the optimized path is successful.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Otherwise the return value must be retained and/or autoreleased as usual.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> ALWAYS_INLINE bool </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">prepareOptimizedReturn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ReturnDisposition disposition</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">ASSERT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getReturnDisposition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> ReturnAtPlus0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">callerAcceptsOptimizedReturn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">__builtin_return_address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">disposition</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setReturnDisposition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">disposition</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//arm64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> ALWAYS_INLINE bool </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">callerAcceptsOptimizedReturn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ra</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// fd 03 1d aa    mov fp, fp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// arm64 instructions are well-aligned</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">ra </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xaa1d03fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>objc_retainAutoreleasedReturnValueæ‰§è¡Œæ—¶ï¼Œåˆ¤æ–­RETURN_DISPOSITION_KEY å¯¹åº” value æ˜¯å¦ä¸º 0x1 å¹¶é‡ç½®ä¸º 0x0ï¼Œæ˜¯çš„è¯ï¼Œåˆ™ç›´æ¥è¿”å› objï¼Œä¸æ‰§è¡Œobjc_retain(obj)ï¼›</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// NSObject.mm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Accept a value returned through a +0 autoreleasing convention for use at +1.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">objc_retainAutoreleasedReturnValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">acceptOptimizedReturn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> ReturnAtPlus1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">objc_retain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// objc-object.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Try to accept an optimized return.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Returns the disposition of the returned object (+0 or +1).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// An un-optimized return is +0.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> ALWAYS_INLINE ReturnDisposition </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">acceptOptimizedReturn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ReturnDisposition disposition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReturnDisposition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setReturnDisposition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ReturnAtPlus0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// reset to the unoptimized state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> disposition</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>åŸºäºä»¥ä¸Šä¼˜åŒ–ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”±å·¥å‚æ–¹æ³•ç”Ÿæˆçš„å¯¹è±¡ä¸å†éœ€è¦è¿›å…¥è‡ªåŠ¨é‡Šæ”¾æ± ï¼ŒåŠ å¿«äº†é‡Šæ”¾è¿‡ç¨‹ã€‚</p>
<p>å¦å¤–ï¼Œmov fp, fpæ˜¯ç¼–è¯‘å™¨å¯¹äºobjc_autoreleaseReturnValueå’Œobjc_retainAutoreleasedReturnValueè¿ç»­è°ƒç”¨æ‰€åšçš„ä¸€ä¸ªæ ‡è®°[3]ã€‚</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Well take a look at that. Itâ€™s added in a mov r7, r7 in each case which is a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">noop (i.e. does nothing as it moves r7 back into itself). If you examine the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binary values for these instructions then youâ€™ll see they match the values that</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">we were told to compare against. The compiler has added this as a marker to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tell the objc_autoreleaseReturnValue that the caller is about to call</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc_retainAutoreleasedReturnValue.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>æŒ‰ç…§ä»¥ä¸Šåˆ†æï¼Œæ–°çš„ main å‡½æ•°æ¨¡æ¿ä»£ç ä¸­ï¼ŒappDelegateClassName ä¸ä¼šè¿›å…¥è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œè€Œäº‹å®ä¸Šç¡®å®å¦‚æ­¤ï¼Œæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">import</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression operator" style="color:#393A34">&lt;</span><span class="token macro property expression" style="color:#36acaa">UIKit</span><span class="token macro property expression operator" style="color:#393A34">/</span><span class="token macro property expression" style="color:#36acaa">UIKit</span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression" style="color:#36acaa">h</span><span class="token macro property expression operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">import</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;AppDelegate.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">extern</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_objc_autoreleasePoolPrint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//    __weak NSString *a;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NSString </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">appDelegateClassName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @autoreleasepool </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Setup code that might create autoreleased objects goes here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        appDelegateClassName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NSStringFromClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AppDelegate class</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_objc_autoreleasePoolPrint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">UIApplicationMain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> appDelegateClassName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>lldb æ‰“å°ç»“æœä¸ºï¼š</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32590</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ##############</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32590</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> AUTORELEASE POOLS </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> thread </span><span class="token number" style="color:#36acaa">0x102493880</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32590</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> releases pending</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32590</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0x1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">PAGE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">placeholder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32590</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0x1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  ################  </span><span class="token function" style="color:#d73a49">POOL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">placeholder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32590</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ##############</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>å¯ä»¥çœ‹åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­æ²¡æœ‰ appDelegateClassName å¯¹è±¡ã€‚</p>
<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œä»¥ä¸Šä»£ç ä¸­æœ‰ä¸ª__weakä¿®é¥°çš„ a å˜é‡ï¼Œå½“æˆ‘ä»¬æŠŠå®ƒä¹ŸåŠ å…¥è¿è¡Œä»£ç ä¸­æ—¶ï¼Œlldb æ‰“å°ç»“æœä¸ºï¼š</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32676</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ##############</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32676</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> AUTORELEASE POOLS </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> thread </span><span class="token number" style="color:#36acaa">0x1025ab880</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32676</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> releases pending</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32676</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0x14c811000</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">PAGE</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hot</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cold</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32676</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0x14c811038</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  ################  POOL </span><span class="token number" style="color:#36acaa">0x14c811038</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32676</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0x14c811040</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">0x283f9c3e0</span><span class="token plain">  __NSCFString</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32676</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ##############</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>TLS é»‘é­”æ³•å¤±çµäº†ï¼</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ç¼–è¯‘å™¨ä¼˜åŒ–">ç¼–è¯‘å™¨ä¼˜åŒ–<a href="#ç¼–è¯‘å™¨ä¼˜åŒ–" class="hash-link" aria-label="Direct link to ç¼–è¯‘å™¨ä¼˜åŒ–" title="Direct link to ç¼–è¯‘å™¨ä¼˜åŒ–">â€‹</a></h3>
<p>æ—¢ç„¶ AutoreleasePool ä¾æ®æ±‡ç¼–å±‚é¢è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿ä»æ±‡ç¼–ä¸­ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//æ²¡æœ‰åŠ __weakï¼š </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x100072148</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">72</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  bl </span><span class="token number" style="color:#36acaa">0x100072478</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> symbol stub </span><span class="token keyword" style="color:#00009f">for</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NSStringFromClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x10007214c</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">76</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  mov x29</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x29 </span><span class="token comment" style="color:#999988;font-style:italic">//mov fp, fp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x100072150</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">80</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  bl </span><span class="token number" style="color:#36acaa">0x1000724e4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> symbol stub </span><span class="token keyword" style="color:#00009f">for</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> objc_retainAutoreleasedReturnValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//åŠ äº†__weakï¼š</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1001da0b8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">76</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  bl </span><span class="token number" style="color:#36acaa">0x1001da418</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> symbol stub </span><span class="token keyword" style="color:#00009f">for</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NSStringFromClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1001da0bc</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">80</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  str x0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> #</span><span class="token number" style="color:#36acaa">0x8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//å…¥æ ˆ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1001da0c0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">84</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  b </span><span class="token number" style="color:#36acaa">0x1001da0c4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">88</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> at main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">m</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">68</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//è·³è½¬åˆ° main.m 68:30 ç»§ç»­æ‰§è¡Œï¼Œå…¶å®å°±æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1001da0c4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">88</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  mov x29</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x29 </span><span class="token comment" style="color:#999988;font-style:italic">//mov fp, fp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1001da0c8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">92</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  ldr x0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> #</span><span class="token number" style="color:#36acaa">0x8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//å‡ºæ ˆ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1001da0cc</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">96</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  bl </span><span class="token number" style="color:#36acaa">0x1001da49c</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> symbol stub </span><span class="token keyword" style="color:#00009f">for</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> objc_retainAutoreleasedReturnValue</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>æè¿°å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">çˆ¶å‡½æ•°æ‰§è¡Œå­å‡½æ•°å‰ï¼Œä¼šå°†å¯„å­˜å™¨ä¸­çš„åŸå§‹å€¼å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå³å…¥æ ˆï¼›</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å­å‡½æ•°æ‰§è¡Œåï¼Œå†ä»æ ˆä¸­å°†å†…å®¹è¯»å–åˆ°å¯„å­˜å™¨ï¼Œå³å‡ºæ ˆï¼Œæ¥ç€ç»§ç»­æ‰§è¡Œåé¢çš„æŒ‡ä»¤ã€‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å¯„å­˜å™¨[4]ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SP(Stack Pointer)ï¼šå †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ŒæŒ‡å‘æ ˆé¡¶åœ°å€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FP(Frame Pointer, R29)ï¼šå¸§æŒ‡é’ˆå¯„å­˜å™¨ï¼Œé€šå¸¸æŒ‡å‘æ ˆåº•åœ°å€ï¼Œå³æŒ‡å‘æ¯å‡½æ•°ä¸è¢«è°ƒç”¨çš„å­å‡½æ•°åœ¨æ ˆä¸­çš„äº¤ç•Œ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LR(Link Register, R30)ï¼šé“¾æ¥å¯„å­˜å™¨ï¼Œä¿å­˜å­å‡½æ•°è¿”å›åæ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„å†…å­˜åœ°å€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æŒ‡ä»¤[5]ï¼š</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">B å‡½æ•°åœ°å€ï¼šè·³è½¬åˆ°å¯¹åº”å‡½æ•°ä¸­æ‰§è¡Œ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BL å‡½æ•°åœ°å€ï¼šå°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å­˜æ”¾åˆ° LR(R30) å¯„å­˜å™¨ä¸­ï¼Œå¹¶è·³è½¬åˆ°å¯¹åº”å‡½æ•°ä¸­æ‰§è¡Œ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV x0 x1ï¼šå¯„å­˜å™¨é—´ä¼ å€¼æˆ–è€…å¯„å­˜å™¨ä¸å¸¸é‡ä¹‹é—´ä¼ å€¼ï¼Œå³ R0 = R1ï¼Œå¯„å­˜å™¨ä¸å†…å­˜ä¹‹é—´ä¼ å€¼ç”¨ STR </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>å½“åŠ äº†__weakä¿®é¥°ç¬¦åï¼Œç¼–è¯‘å™¨åœ¨objc_autoreleaseReturnValueå’Œobjc_retainAutoreleasedReturnValueä¹‹é—´åŠ å…¥äº†å…¥æ ˆï¼Œè·³è½¬ï¼Œå‡ºæ ˆæ“ä½œï¼Œå¯¼è‡´callerAcceptsOptimizedReturn(__builtin_return_address(0))çš„å€¼ä¸º falseï¼Œä»è€Œæ‰§è¡Œäº†objc_autoreleaseï¼ŒåŠ åˆ°äº†è‡ªåŠ¨é‡Šæ”¾æ± ä¹‹ä¸­ã€‚</p>
<p>é€šè¿‡é…ç½®ç¼–è¯‘å™¨ä¼˜åŒ–çº§åˆ«å¯ä»¥å»æ‰è¿™å‡ æ¡æŒ‡ä»¤ï¼ŒBuild Settings -&gt; Apple Clang - Code Generation -&gt; Optimization Level[6] -&gt; Debug è®¾ç½®ä¸ºé™¤äº† None[-O0] ä»¥å¤–çš„é…ç½®å³å¯ã€‚è¿è¡Œä¹‹åï¼Œå¯ä»¥çœ‹åˆ° AutoreleasePool é‡Œä¸ä¼šå†åŠ å…¥å¯¹è±¡ï¼Œä½†ä¹Ÿå‡ºç°ä¸€æ¡ä¿¡æ¯ï¼š</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Project was compiled with optimization - stepping may behave oddly; variables may not be available.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ä¸€èˆ¬ Debug ä¸‹ï¼Œé…ç½®ä¸º None[-O0]ï¼ŒRelease ä¸‹é…ç½®ä¸º Fastestï¼ŒSmallest[-Os]ã€‚é‚£ä¹ˆå¯ä»¥ç¡®å®šåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæ­¤ä¼˜åŒ–æ­£å¸¸ã€‚</p>
<p>ç›¸åº”åœ°ï¼Œå¯¹äºå°¾è°ƒç”¨ä¼˜åŒ–åœ¨ Debug ä¸‹ä¸èµ·ä½œç”¨çš„æƒ…å†µï¼Œé…ç½®ä¸º Faster[-O2]å³å¯ç”Ÿæ•ˆã€‚</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="å°¾è°ƒç”¨ä¼˜åŒ–">å°¾è°ƒç”¨ä¼˜åŒ–<a href="#å°¾è°ƒç”¨ä¼˜åŒ–" class="hash-link" aria-label="Direct link to å°¾è°ƒç”¨ä¼˜åŒ–" title="Direct link to å°¾è°ƒç”¨ä¼˜åŒ–">â€‹</a></h3>
<p>å¯¹å°¾è°ƒç”¨ä¼˜åŒ–çš„ä»‹ç»ï¼Œè¿™é‡Œæœ‰ 2 ç¯‡ä¼˜ç§€çš„æ–‡ç« ï¼š</p>
<p>å°¾è°ƒç”¨ä¼˜åŒ– - <a href="https://www.ruanyifeng.com/blog/2015/04/tail-call.html" target="_blank" rel="noopener noreferrer">https://www.ruanyifeng.com/blog/2015/04/tail-call.html</a></p>
<p>iOS objc_msgSendå°¾è°ƒç”¨ä¼˜åŒ–æœºåˆ¶è¯¦è§£ - <a href="https://juejin.cn/post/6844903664050536455" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6844903664050536455</a></p>
<p>å…¶ä¸­ç¬¬äºŒç¯‡æ–‡ç« ä¸­ï¼Œå°¾è°ƒç”¨ä¼˜åŒ–åœ¨Releaseæ¨¡å¼ä¸‹æ‰ä¼šæœ‰ï¼ŒDebugæ¨¡å¼ä¸‹æ²¡æœ‰çš„æƒ…å†µï¼Œä¸Šä¸€èŠ‚æœ‰å†™åˆ°ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® Optimization Level è§£å†³ã€‚</p>
<p>LLVM ç¼–è¯‘ä¼˜åŒ–æ˜¯é€šè¿‡ Pass å®ç°çš„ï¼ŒæŸ¥çœ‹å½“å‰ Optimization Level å¯¹åº”çš„ Pass arguments[9]ï¼š</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// where X can be Os,O1,O2,O3 and O4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clang </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">OX </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">mllvm </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">debug</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">pass</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Arguments foo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<picture><source srcset="/growingio-sdk-docs/blog/autoreleasepool/autoreleasepool-3.avif" type="image/avif"><source srcset="/growingio-sdk-docs/blog/autoreleasepool/autoreleasepool-3.webp" type="image/webp"><img src="/growingio-sdk-docs/blog/autoreleasepool/autoreleasepool-3.png"></picture>
<p>ä¸Šå›¾æ˜¯Faster[-O2]å¯¹åº”çš„ Pass Argumentsï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ä¸€é¡¹æ˜¯-tailcallelim[10]ï¼Œè¿™ä¸ª Pass é’ˆå¯¹çš„å°±æ˜¯å°¾è°ƒç”¨ä¼˜åŒ–ã€‚</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">This file transforms calls of the current function (self recursion) followed by a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return instruction with a branch to the entry of the function, creating a loop.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This pass also implements the following extensions to the basic algorithm: 1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trivial instructions between the call and return do not prevent the transformation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from taking place, though currently the analysis cannot support moving any really</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">useful instructions (only dead ones). 2. This pass transforms functions that are</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prevented from being tail recursive by an associative expression to use an</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">accumulator variable, thus compiling the typical naive factorial or fib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">implementation into efficient code. 3. TRE is performed if the function returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void, if the return returns the result returned by the call, or if the function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">returns a run-time constant on all exits from the function. It is possible, though</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unlikely, that the return returns something else (like constant 0), and can still</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">be TREâ€™d. It can be TREâ€™d if all other return instructions in the function return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the exact same value. 4. If it can prove that callees do not access their caller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stack frame, they are marked as eligible for tail call elimination (by the code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generator).</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Xcode 13.0 å¯¹åº”çš„ clang ç‰ˆæœ¬ä¸ºï¼š Apple clang version 13.0.0 (clang-1300.0.29.3)ï¼Œç»è¿‡éªŒè¯ï¼Œæ­¤ç‰ˆæœ¬ä¸­Fast [-O, O1] ä¸­æ²¡æœ‰-tailcallelim</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">è¿™ä¸ª StackOverflow å›ç­”ä¸­</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">ç½—åˆ—äº†å„ä¸ªçº§åˆ«å¯¹åº”çš„ Passï¼Œåªæ›´æ–°åˆ°äº† version </span><span class="token number" style="color:#36acaa">6.0</span><span class="token plain">ï¼Œä»…ä½œä¸ºå‚è€ƒ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ç»“è¯­">ç»“è¯­<a href="#ç»“è¯­" class="hash-link" aria-label="Direct link to ç»“è¯­" title="Direct link to ç»“è¯­">â€‹</a></h3>
<p>æœ¬ç¯‡æŠ€æœ¯åˆ†äº«ä» iOS AutoreleasePool åˆ° TLS çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼Œè¿›è€ŒæŸ¥çœ‹æ±‡ç¼–ä»£ç ï¼Œäº†è§£ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œä»è€Œæ‰©å±•åˆ°å°¾è°ƒç”¨ä¼˜åŒ–ï¼Œè¯¦ç»†æè¿°äº†æ•´ä¸ªæŠ€æœ¯åŸç†çš„æ¢ç´¢å­¦ä¹ è¿‡ç¨‹ã€‚æŠ€æœ¯å­¦ä¹ æ— æ­¢å¢ƒï¼Œæ„¿ä½ æˆ‘å…±å‹‰ã€‚</p>
<p>æ¬¢è¿å…³æ³¨ Android å’Œ iOS æ— åŸ‹ç‚¹ SDK 3.0 å¼€æº GitHub ä»“åº“ï¼Œäº†è§£æœ€æ–°è¿›å±•ï¼š</p>
<p>Android:</p>
<p><a href="https://github.com/growingio/growingio-sdk-android-autotracker" target="_blank" rel="noopener noreferrer">https://github.com/growingio/growingio-sdk-android-autotracker</a></p>
<p>iOS:</p>
<p><a href="https://github.com/growingio/growingio-sdk-ios-autotracker" target="_blank" rel="noopener noreferrer">https://github.com/growingio/growingio-sdk-ios-autotracker</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™<a href="#å‚è€ƒèµ„æ–™" class="hash-link" aria-label="Direct link to å‚è€ƒèµ„æ–™" title="Direct link to å‚è€ƒèµ„æ–™">â€‹</a></h3>
<p>[1] å¦‚ä½•ç†è§£ Xcode 11 æ¨¡æ¿é¡¹ç›®ä¸­ main.m çš„å˜åŒ–?: <a href="https://www.jianshu.com/p/63426e6bf7aa" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/63426e6bf7aa</a></p>
<p>[2] é»‘å¹•èƒŒåçš„Autorelease: <a href="http://blog.sunnyxx.com/2014/10/15/behind-autorelease/" target="_blank" rel="noopener noreferrer">http://blog.sunnyxx.com/2014/10/15/behind-autorelease/</a></p>
<p>[3] How does objc_retainAutoreleasedReturnValue work?: <a href="https://www.galloway.me.uk/2012/02/how-does-objc_retainautoreleasedreturnvalue-work/" target="_blank" rel="noopener noreferrer">https://www.galloway.me.uk/2012/02/how-does-objc_retainautoreleasedreturnvalue-work/</a></p>
<p>[4] General-purpose Registers:  <a href="https://github.com/ARM-software/abi-aa/blob/master/aapcs64/aapcs64.rst#general-purpose-registers" target="_blank" rel="noopener noreferrer">https://github.com/ARM-software/abi-aa/blob/master/aapcs64/aapcs64.rst#general-purpose-registers</a></p>
<p>[5] A64 Data Transfer Instructions: <a href="https://developer.arm.com/documentation/dui0802/a/A64-Data-Transfer-Instructions?lang=en" target="_blank" rel="noopener noreferrer">https://developer.arm.com/documentation/dui0802/a/A64-Data-Transfer-Instructions?lang=en</a></p>
<p>[6] Compiler-Level Optimizations: <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/MOSXAppProgrammingGuide/Performance/Performance.html#//apple_ref/doc/uid/TP40010543-CH9-102307" target="_blank" rel="noopener noreferrer">https://developer.apple.com/library/archive/documentation/General/Conceptual/MOSXAppProgrammingGuide/Performance/Performance.html#//apple_ref/doc/uid/TP40010543-CH9-102307</a></p>
<p>[7] å°¾è°ƒç”¨ä¼˜åŒ–: <a href="https://www.ruanyifeng.com/blog/2015/04/tail-call.html" target="_blank" rel="noopener noreferrer">https://www.ruanyifeng.com/blog/2015/04/tail-call.html</a></p>
<p>[8] iOS objc_msgSendå°¾è°ƒç”¨ä¼˜åŒ–æœºåˆ¶è¯¦è§£: <a href="https://juejin.cn/post/6844903664050536455" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6844903664050536455</a></p>
<p>[9] List of optimizations available in clang and llvm opt: <a href="https://stackoverflow.com/questions/35920795/list-of-optimizations-available-in-clang-and-llvm-opt" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/35920795/list-of-optimizations-available-in-clang-and-llvm-opt</a></p>
<p>[10] -tailcallelim: Tail Call Elimination: <a href="https://llvm.org/docs/Passes.html#tailcallelim-tail-call-elimination" target="_blank" rel="noopener noreferrer">https://llvm.org/docs/Passes.html#tailcallelim-tail-call-elimination</a></p>
<p>[11] Clang optimization levels: <a href="https://stackoverflow.com/questions/15548023/clang-optimization-levels" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/15548023/clang-optimization-levels</a></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/growingio-sdk-docs/blog/tags/i-os">iOS</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/growingio-sdk-docs/blog/tags/autorelease-pool">AutoreleasePool</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/growingio-sdk-docs/blog/tags/ç¼–è¯‘å™¨ä¼˜åŒ–">ç¼–è¯‘å™¨ä¼˜åŒ–</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/growingio/growingio-sdk-docs/edit/master/blog/2022-02-22-autoreleasePool.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/growingio-sdk-docs/blog/custom android sdk"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">åŸºäº GrowingIO ç°æœ‰ SDK åŸºç¡€ä¸Šçš„äºŒæ¬¡å¼€å‘ - Android ç¯‡</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/growingio-sdk-docs/blog/JS Error"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">ä¸€æ–‡æå®šå‰ç«¯é”™è¯¯æ•è·å’Œä¸ŠæŠ¥</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#thread-local-storage" class="table-of-contents__link toc-highlight">Thread Local Storage</a></li><li><a href="#ç¼–è¯‘å™¨ä¼˜åŒ–" class="table-of-contents__link toc-highlight">ç¼–è¯‘å™¨ä¼˜åŒ–</a></li><li><a href="#å°¾è°ƒç”¨ä¼˜åŒ–" class="table-of-contents__link toc-highlight">å°¾è°ƒç”¨ä¼˜åŒ–</a></li><li><a href="#ç»“è¯­" class="table-of-contents__link toc-highlight">ç»“è¯­</a></li><li><a href="#å‚è€ƒèµ„æ–™" class="table-of-contents__link toc-highlight">å‚è€ƒèµ„æ–™</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/growingio-sdk-docs/docs">å®¢æˆ·ç«¯æ–‡æ¡£</a></li><li class="footer__item"><a class="footer__link-item" href="/growingio-sdk-docs/docs/server">æœåŠ¡ç«¯æ–‡æ¡£</a></li><li class="footer__item"><a class="footer__link-item" href="/growingio-sdk-docs/knowledge">æ•° æ®æŒ‡å—</a></li><li class="footer__item"><a class="footer__link-item" href="/growingio-sdk-docs/docs/question">å¸¸è§é—®é¢˜</a></li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/growingio/growingio-sdk-android-autotracker" target="_blank" rel="noopener noreferrer" class="footer__link-item">Android SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/growingio/growingio-sdk-ios-autotracker" target="_blank" rel="noopener noreferrer" class="footer__link-item">Apple SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/growingio/growingio-sdk-webjs-autotracker/tree/CDP" target="_blank" rel="noopener noreferrer" class="footer__link-item">Web SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.growingio.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">å®˜ç½‘<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.growingio.com/op-help/" target="_blank" rel="noopener noreferrer" class="footer__link-item">åˆ†æäº‘å¢é•¿å¹³å°<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://growingio.github.io/growingio-sdk-docs-v3/" target="_blank" rel="noopener noreferrer" class="footer__link-item">æ—§æ–‡æ¡£åœ°å€<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 åŒ—äº¬æ˜“æ•°ç§‘æŠ€æœ‰é™å…¬å¸ -- Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>
<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://growingio.github.io/growingio-sdk-docs/growingio-sdk-docs/blog</id>
    <title>一站式数据增长引擎 Blog</title>
    <updated>2021-07-21T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://growingio.github.io/growingio-sdk-docs/growingio-sdk-docs/blog"/>
    <subtitle>一站式数据增长引擎 Blog</subtitle>
    <icon>https://growingio.github.io/growingio-sdk-docs/growingio-sdk-docs/img/favicon.png</icon>
    <entry>
        <title type="html"><![CDATA[MavenCentral 迁移步骤]]></title>
        <id>MavenCentral</id>
        <link href="https://growingio.github.io/growingio-sdk-docs/growingio-sdk-docs/blog/MavenCentral"/>
        <updated>2021-07-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[随着 Jcenter 服务的即将过期，我们需要一个新的仓库来发行我们的SDK.于是我们找上了 MavenCentral，并针对如何在MavenCentral提交包写了这篇文章。]]></summary>
        <content type="html"><![CDATA[<p>随着 Jcenter 服务的即将过期，我们需要一个新的仓库来发行我们的SDK.于是我们找上了 MavenCentral，并针对如何在MavenCentral提交包写了这篇文章。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="注册账号">注册账号<a class="hash-link" href="#注册账号" title="Direct link to heading">​</a></h2><p>前往 <a href="https://issues.sonatype.org/" target="_blank" rel="noopener noreferrer">sonatype</a> 注册账号，账号注册完毕后需要提个issue来申请 groupid .</p><p>如 <a href="https://issues.sonatype.org/browse/OSSRH-66388" target="_blank" rel="noopener noreferrer">OSSRH-66388</a> 所示，如果是GitHub或gitlab下的项目，可以申请 <code>io.github.&lt;yourname&gt;</code>。
如果是域名，则需要在域名的dns解析下添加 TXT 记录，如 <a href="https://issues.sonatype.org/browse/OSSRH-66397" target="_blank" rel="noopener noreferrer">OSSRH-66397</a>举例，txt前缀为OSSRH-66397 值为网址<a href="https://issues.sonatype.org/browse/OSSRH-66397" target="_blank" rel="noopener noreferrer">https://issues.sonatype.org/browse/OSSRH-66397</a>.</p><blockquote><p>在2021年2月前申请的账号，maven仓库的地址为 <a href="https://oss.sonatype.org/" target="_blank" rel="noopener noreferrer">https://oss.sonatype.org/</a>，而在之后申请的的地址为 <a href="https://s01.oss.sonatype.org/" target="_blank" rel="noopener noreferrer">https://s01.oss.sonatype.org/</a>.不过也可以在<a href="https://issues.sonatype.org/" target="_blank" rel="noopener noreferrer">sonatype</a>上提 issue 来申请变更域名地址，如这个issue所示-&gt;<a href="https://issues.sonatype.org/browse/OSSRH-66964" target="_blank" rel="noopener noreferrer">OSSRH-66964</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="maven-central">Maven Central<a class="hash-link" href="#maven-central" title="Direct link to heading">​</a></h2><p>注册结束后，可以前往<a href="https://s01.oss.sonatype.org/" target="_blank" rel="noopener noreferrer">nexus repository</a>查看自己的仓库。在仓库中一般分为两种提交方式，一种是 SNAPSHOT 版本，一种是正式版本。
两者仓库地址不同，分别为：<a href="https://s01.oss.sonatype.org/content/repositories/snapshots" target="_blank" rel="noopener noreferrer">https://s01.oss.sonatype.org/content/repositories/snapshots</a> 和 <a href="https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/" target="_blank" rel="noopener noreferrer">https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="snapshot">SNAPSHOT<a class="hash-link" href="#snapshot" title="Direct link to heading">​</a></h3><p>SNAPSHOT 版本可以在同一版本号下多次提交，当其他人拉取该版本号时会取最后提交的包，如下图所示
<img loading="lazy" alt="SNAPSHOT" src="/growingio-sdk-docs/assets/images/SNAPSHOT-df589c8a731b619549f4b193393ae814.png" width="1280" height="1316">
在 SNAPSHOT 仓库中同一个版本下多个包会通过提交日期来区分，这样别人依赖某个版本时就能获得最新更新的包。
同时 SNAPSHOT 不会对提交的包进行 <code>close</code> 操作来对其进行审核，没有一定要有 <code>javadoc</code>、<code>sources</code>、<code>GPG加密</code>等要求。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="正式版">正式版<a class="hash-link" href="#正式版" title="Direct link to heading">​</a></h3><p>提交正式版后包会先进入 <code>Staging Repositories</code>,然后需要在这里依次执行 <code>close</code> 和 <code>release</code> 操作，<code>close</code>操作会验证本次的提交的包是否包含 <code>javadoc</code>、<code>sources</code>、<code>GPG加密文件</code> 和 <code>pom</code>文件的合法等，通过后才能执行 <code>release</code> 操作向官方仓库发布。</p><p><img loading="lazy" alt="Staging Repositories" src="/growingio-sdk-docs/assets/images/Repositories-47dce28bfb4733fb20a5b42150110bf2.png" width="2084" height="764"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="开始准备">开始准备<a class="hash-link" href="#开始准备" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="1-配置-gpg-私钥">1. 配置 GPG 私钥<a class="hash-link" href="#1-配置-gpg-私钥" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-cmd theme-code-block"><div class="codeBlockContent_wNvx cmd"><pre tabindex="0" class="prism-code language-cmd codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># 生成证书，里面会要求输入用户名和密码，有效期两年。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --gen-key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看公钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看私钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-secret-keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将证书上传 key server，恩，国内需要代理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --keyserver-options http-proxy=127.0.0.1:1087 --send-keys D81E8990E415EDE0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看8位短id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-keys --keyid-format short</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 生成私钥文件，配置到gradle使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --export-secret-keys -o secring.gpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 生成base64文件，后续放入github secrets 中使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">base64 secring.gpg &gt; secring.gpg.b64</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>具体可参考 <a href="https://central.sonatype.org/publish/requirements/gpg/" target="_blank" rel="noopener noreferrer">gpg配置</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="2-本地全局-gradle-配置">2. 本地全局 gradle 配置<a class="hash-link" href="#2-本地全局-gradle-配置" title="Direct link to heading">​</a></h3><p>找到 <code>.gradle</code>文件夹下gradle.properties文件，如下进行配置</p><div class="codeBlockContainer_I0IT language-gradle theme-code-block"><div class="codeBlockContent_wNvx gradle"><pre tabindex="0" class="prism-code language-gradle codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">## growingio's config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NEXUS_USERNAME=&lt;sonatype账号&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NEXUS_PASSWORD=&lt;sonatype密码&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signing.keyId=09B66CAF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signing.password=&lt;生成证书时的输入密码&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signing.secretKeyRingFile=&lt;生成私钥文件的文件路径&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>当然在项目下的gradle.properties也同样生效。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="3-配置-pom-文件">3. 配置 pom 文件<a class="hash-link" href="#3-配置-pom-文件" title="Direct link to heading">​</a></h3><p>在根项目下的 gradle.properties 添加以下配置说明，这些说明将会一一填入到 pom 文件中</p><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div class="codeBlockContent_wNvx xml"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">GROUP=com.growingio.android</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_DESCRIPTION=GrowingIO Android SDK Library.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_DEVELOPER_EMAIL=sdk-integration@growingio.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_URL=https://github.com/growingio/growingio-sdk-android-autotracker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_SCM_URL=https://github.com/growingio/growingio-sdk-android-autotracker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_SCM_CONNECTION=scm:git@github.com:growingio/growingio-sdk-android-autotracker.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_SCM_DEV_CONNECTION=scm:git@github.com:growingio/growingio-sdk-android-autotracker.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_LICENCE_NAME=The Apache Software License, Version 2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_LICENCE_URL=http://www.apache.org/licenses/LICENSE-2.0.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_LICENCE_DIST=repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_DEVELOPER_ID=GrowingIo Sdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_DEVELOPER_NAME=GrowingIo Sdk</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="4-编写gradle的maven上传代码">4. 编写gradle的maven上传代码<a class="hash-link" href="#4-编写gradle的maven上传代码" title="Direct link to heading">​</a></h3><p><a href="https://central.sonatype.org/publish/publish-gradle/" target="_blank" rel="noopener noreferrer">sonatype 的gradle教程</a> 已经过期好久了，这里推荐在 Github 上的<a href="https://github.com/chrisbanes/gradle-mvn-push" target="_blank" rel="noopener noreferrer">gradle-mvn-push</a>。后面的所有改动都基于在这个文件版本上得来的，具体如何改动在后续说明。
示例代码 <code>publishMaven.gradle</code>：</p><div class="codeBlockContainer_I0IT language-groovy theme-code-block"><div class="codeBlockContent_wNvx groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Copyright 2021 Cpacm</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Licensed under the Apache License, Version 2.0 (the "License");</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * you may not use this file except in compliance with the License.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * You may obtain a copy of the License at</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *     http://www.apache.org/licenses/LICENSE-2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Unless required by applicable law or agreed to in writing, software</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * distributed under the License is distributed on an "AS IS" BASIS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * See the License for the specific language governing permissions and</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * limitations under the License.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Based on: https://github.com/mcxiaoke/gradle-mvn-push/blob/master/gradle-mvn-push.gradle.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * To install in a local maven repo:</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 1. In the project you want to test, add mavenLocal() to the repositories list.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 2. In Project, run: ./gradlew publishToMavenLocal</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * For faster runs add: -x check when building.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apply plugin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'maven-publish'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apply plugin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'signing'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> releaseConfiguration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">releaseVersion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GROUP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@SuppressWarnings</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"GrMethodMayBeStatic"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isReleaseBuild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"SNAPSHOT"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReleaseRepositoryUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">hasProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'RELEASE_REPOSITORY_URL'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> RELEASE_REPOSITORY_URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getSnapshotRepositoryUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">hasProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'SNAPSHOT_REPOSITORY_URL'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> SNAPSHOT_REPOSITORY_URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'https://s01.oss.sonatype.org/content/repositories/snapshots/'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getRepositoryUsername</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">hasProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'USERNAME'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> USERNAME </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">hasProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'NEXUS_USERNAME'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> NEXUS_USERNAME </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getRepositoryPassword</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">hasProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'PASSWORD'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> PASSWORD </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">hasProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'NEXUS_PASSWORD'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> NEXUS_PASSWORD </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">configurePom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">packaging </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_PACKAGING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">description </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_DESCRIPTION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">scm </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_SCM_URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_SCM_CONNECTION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        developerConnection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_SCM_DEV_CONNECTION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">licenses </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        license </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_LICENCE_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_LICENCE_URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            distribution </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_LICENCE_DIST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">developers </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        developer </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_DEVELOPER_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_DEVELOPER_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            email </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POM_DEVELOPER_EMAIL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">afterEvaluate </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> project </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> isAndroidProject </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'com.android.application'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'com.android.library'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publishing </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        repositories </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            maven </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> releasesRepoUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReleaseRepositoryUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> snapshotsRepoUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getSnapshotRepositoryUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isReleaseBuild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> releasesRepoUrl </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> snapshotsRepoUrl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">credentials</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PasswordCredentials</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    username </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getRepositoryUsername</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getRepositoryPassword</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isAndroidProject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        task </span><span class="token function" style="color:#d73a49">androidJavadocs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Javadoc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dependsOn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> assembleDebug</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> android</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sourceSets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            classpath </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">android</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBootClasspath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">File</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pathSeparator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// include BuildConfig.java</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            classpath </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"build/generated/source/buildConfig/debug"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            excludes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'**/*.kt'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        task </span><span class="token function" style="color:#d73a49">androidJavadocsJar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Jar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dependsOn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> androidJavadocs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            classifier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'javadoc'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from androidJavadocs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">destinationDir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        task </span><span class="token function" style="color:#d73a49">androidSourcesJar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Jar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            classifier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'sources'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from android</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sourceSets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        android</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">libraryVariants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">all </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> variant </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">androidJavadocs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">doFirst </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                classpath </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">variant</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">javaCompileProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">classpath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">files</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">File</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pathSeparator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        task </span><span class="token function" style="color:#d73a49">sourcesJar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Jar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dependsOn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> classes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            classifier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'sources'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from sourceSets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">allSource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        task </span><span class="token function" style="color:#d73a49">javadocsJar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Jar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dependsOn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> javadoc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            classifier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'javadoc'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from javadoc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">destinationDir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        artifacts </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            archives sourcesJar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            archives javadocsJar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JavaVersion</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">current</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isJava8Compatible</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allprojects </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">withType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Javadoc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addStringOption</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Xdoclint:none'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'-quiet'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JavaVersion</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">current</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isJava9Compatible</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allprojects </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">withType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Javadoc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addBooleanOption</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'html5'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    artifacts </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isAndroidProject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            archives androidSourcesJar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            archives androidJavadocsJar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            archives project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bundleDebugAar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publishing </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        publications </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">mavenAgent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MavenPublication</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                groupId GROUP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                artifactId POM_ARTIFACT_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                version version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">configurePom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isAndroidProject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    artifact bundleReleaseAar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    artifact androidSourcesJar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">withXml </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> dependenciesNode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">asNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'dependencies'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">configurations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">all </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> configuration </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// api will duplicate with implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'releaseImplementation'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'implementation'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">allDependencies</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">each </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"unspecified"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"unspecified"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> groupId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> artifactId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">it </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">ProjectDependency</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> properties </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDependencyProject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getProperties</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            groupId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> properties</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"GROUP"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            artifactId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> properties</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"POM_ARTIFACT_ID"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        println </span><span class="token string" style="color:#e3116c">"dependencies:"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> groupId </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">":"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> artifactId </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">":"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> dependencyNode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dependenciesNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'dependency'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        dependencyNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'groupId'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> groupId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        dependencyNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'artifactId'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> artifactId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        dependencyNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'version'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        dependencyNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'scope'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'compile'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    from components</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    artifact sourcesJar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    artifact javadocsJar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'java-gradle-plugin'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">pluginMaven</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MavenPublication</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    groupId GROUP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    artifactId POM_ARTIFACT_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    version version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">configurePom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signing </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    required </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isReleaseBuild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> gradle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">taskGraph</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"publish"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publishing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publications</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">all </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> publication </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sign publication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>基本使用：在需要发布的项目下添加 <code>gradle.properties</code>文件，并注明 <code>ARTIFACT_ID</code>名，如下：</p><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div class="codeBlockContent_wNvx xml"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">POM_NAME=autotracker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_ARTIFACT_ID=autotracker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_PACKAGING=aar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POM_DESCRIPTION=GrowingIO Android SDK AutoTracker.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>同时在 <code>build.gradle</code> 中引入该文件</p><div class="codeBlockContainer_I0IT language-gradle theme-code-block"><div class="codeBlockContent_wNvx gradle"><pre tabindex="0" class="prism-code language-gradle codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">apply from: "${rootProject.projectDir}/gradle/publishMaven.gradle"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-cmd theme-code-block"><div class="codeBlockContent_wNvx cmd"><pre tabindex="0" class="prism-code language-cmd codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># 上传到本地仓库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew publishToMavenLocal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 上传到远程仓库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew publish</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="5-github-ci脚本">5. Github Ci脚本<a class="hash-link" href="#5-github-ci脚本" title="Direct link to heading">​</a></h3><p>GitHub上有提供 Action 这一工具，该工具可以在线上进行各种操作：比如编译，测试，校验等，所以打包上传也是可以的。</p><ol><li><p>配置 Github Secrets
<img loading="lazy" alt="Github Secrets" src="/growingio-sdk-docs/assets/images/Secrets-97c7b28c2cd437c3b4768d3bb6ae38ad.png" width="2400" height="748">
各个配置分别对应 <code>全局 gradle 配置</code> 步骤中的各个参数，其中 <code>SIGNING_SECRET_KEY_RING_FILE</code> 是秘钥文件经过 base64 后产生的字符串。</p></li><li><p>自动 close 和 release
这里直接使用 <a href="https://github.com/Codearte/gradle-nexus-staging-plugin" target="_blank" rel="noopener noreferrer">gradle-nexus-staging-plugin</a>的插件。它能通过 sonatype 的api来自动实现 <code>Staging Repositories</code>上的close和release操作</p></li><li><p>完整ci脚本</p></li></ol><div class="codeBlockContainer_I0IT language-yml theme-code-block"><div class="codeBlockContent_wNvx yml"><pre tabindex="0" class="prism-code language-yml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Publish Maven</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">types</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">published</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">publish</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set up JDK 1.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">java@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">java-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Gradle 缓存配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Cache Gradle packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/cache@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~/.gradle/caches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> runner.os </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gradle</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> hashFiles('</span><span class="token important">**/*.gradle')</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">restore-keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> runner.os </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gradle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 给 gradlew 文件授权</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Grant Permission to Execute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          chmod +x gradlew</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          chmod +x gradle/publishAllToMavenLocal.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 构建项目</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Build with Gradle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          bash ./gradle/publishAllToMavenLocal.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 解码秘钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Decode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          echo "${{secrets.SIGNING_SECRET_KEY_RING_FILE}}" &gt; ~/.gradle/secring.gpg.b64</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          base64 -d ~/.gradle/secring.gpg.b64 &gt; ~/.gradle/secring.gpg</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Publish to Sonatype</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">NEXUS_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.NEXUS_USERNAME </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">NEXUS_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.NEXUS_PASSWORD </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./gradlew publish </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">PNEXUS_USERNAME="$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">NEXUS_USERNAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">" </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">PNEXUS_PASSWORD="$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">NEXUS_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">" </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Psigning.keyId=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">secrets.SIGNING_KEY_ID</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Psigning.password=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">secrets.SIGNING_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Psigning.secretKeyRingFile=$(echo ~/.gradle/secring.gpg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Close And Release Package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">NEXUS_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.NEXUS_USERNAME </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">NEXUS_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.NEXUS_PASSWORD </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./gradlew tryCloseAndReleaseRepository </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">PNEXUS_USERNAME="$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">NEXUS_USERNAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">" </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">PNEXUS_PASSWORD="$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">NEXUS_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>至此，一套完整的自动打包系统就搭建完成了。</p><hr><p>参考资料：</p><ol><li><a href="https://docs.github.com/cn/actions/reference/events-that-trigger-workflows" target="_blank" rel="noopener noreferrer">github action</a></li><li><a href="https://docs.gradle.org/current/userguide/signing_plugin.html#sec:signatory_credentials" target="_blank" rel="noopener noreferrer">gradle 配置</a></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="附录关于在-growingio-各个仓库上遇到的几个问题">附录：关于在 GrowingIO 各个仓库上遇到的几个问题<a class="hash-link" href="#附录关于在-growingio-各个仓库上遇到的几个问题" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="gradle-plugin-插件打包">gradle plugin 插件打包<a class="hash-link" href="#gradle-plugin-插件打包" title="Direct link to heading">​</a></h3><p>plugin项目应该属于 java 项目，但在 <code>publications</code>下它会单独走 <code>pluginMaven</code>，所以需要对其做特别处理来规范其 ARTIFACT_ID</p><div class="codeBlockContainer_I0IT language-groovy theme-code-block"><div class="codeBlockContent_wNvx groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'java-gradle-plugin'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">pluginMaven</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MavenPublication</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        groupId GROUP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        artifactId POM_ARTIFACT_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        version version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">configurePom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="javadoc找不到buildconfig文件">javadoc找不到BuildConfig文件<a class="hash-link" href="#javadoc找不到buildconfig文件" title="Direct link to heading">​</a></h3><p>这里需要在生成 javadoc 包的时候添加 BuildConfig类的路径到 classpath 中。</p><div class="codeBlockContainer_I0IT language-groovy theme-code-block"><div class="codeBlockContent_wNvx groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">task </span><span class="token function" style="color:#d73a49">androidJavadocs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Javadoc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dependsOn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> assembleDebug</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> android</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sourceSets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    classpath </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">android</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBootClasspath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">File</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pathSeparator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// include BuildConfig.java</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    classpath </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"build/generated/source/buildConfig/debug"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    excludes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'**/*.kt'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>当然可能不同版本的gradle生成的地址不一样，请自己测试并添加</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="关于-uploadarchives">关于 uploadArchives<a class="hash-link" href="#关于-uploadarchives" title="Direct link to heading">​</a></h3><p>旧版本 Gradle 的task，依赖于插件 maven。现在一般都是</p><div class="codeBlockContainer_I0IT language-groovy theme-code-block"><div class="codeBlockContent_wNvx groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">apply plugin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'maven-publish'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">afterEvaluate </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> project </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publishing </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>且在 gradle 版本 5.0后，需要将 publishing 放置在 afterEvaluate 中。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="关于依赖">关于依赖<a class="hash-link" href="#关于依赖" title="Direct link to heading">​</a></h3><p>api依赖和implementation依赖会重复出现在 <code>project.configurations.all</code>循环中(api &gt; implementation)，所以只需要判断 <code>implementation</code>即可</p><div class="codeBlockContainer_I0IT language-groovy theme-code-block"><div class="codeBlockContent_wNvx groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">withXml </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> dependenciesNode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">asNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'dependencies'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">configurations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">all </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> configuration </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// api will duplicate with implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'releaseImplementation'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'implementation'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">allDependencies</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">each </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"unspecified"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"unspecified"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> groupId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> artifactId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">it </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">ProjectDependency</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> properties </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDependencyProject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getProperties</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        groupId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> properties</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"GROUP"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        artifactId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> properties</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"POM_ARTIFACT_ID"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    println </span><span class="token string" style="color:#e3116c">"dependencies:"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> groupId </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">":"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> artifactId </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">":"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> dependencyNode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dependenciesNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'dependency'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    dependencyNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'groupId'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> groupId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    dependencyNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'artifactId'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> artifactId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    dependencyNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'version'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    dependencyNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'scope'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'compile'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div>]]></content>
        <author>
            <name>cpacm</name>
            <uri>https://github.com/cpacm</uri>
        </author>
        <category label="scripts" term="scripts"/>
        <category label="gradle" term="gradle"/>
    </entry>
</feed>
"use strict";(self.webpackChunkgrowingio_sdk_doc=self.webpackChunkgrowingio_sdk_doc||[]).push([[7689],{1492:n=>{n.exports=JSON.parse('{"blogPosts":[{"id":"custom ios sdk","metadata":{"permalink":"/growingio-sdk-docs/blog/custom ios sdk","editUrl":"https://github.com/growingio/growingio-sdk-docs/edit/master/blog/2022-10-13-custom ios sdk.md","source":"@site/blog/2022-10-13-custom ios sdk.md","title":"\u57fa\u4e8e GrowingIO \u73b0\u6709 SDK \u57fa\u7840\u4e0a\u7684\u4e8c\u6b21\u5f00\u53d1 - iOS \u7bc7","description":"--------------","date":"2022-10-13T00:00:00.000Z","formattedDate":"October 13, 2022","tags":[{"label":"sdk","permalink":"/growingio-sdk-docs/blog/tags/sdk"},{"label":"iOS","permalink":"/growingio-sdk-docs/blog/tags/i-os"},{"label":"custom","permalink":"/growingio-sdk-docs/blog/tags/custom"}],"readingTime":11.515,"hasTruncateMarker":true,"authors":[{"name":"CaicaiNo","title":"GrowingIO SDK Team","url":"https://github.com/CaicaiNo","image_url":"https://avatars.githubusercontent.com/u/17329515?v=4","imageURL":"https://avatars.githubusercontent.com/u/17329515?v=4"},{"name":"YoloMao","title":"GrowingIO SDK Team","url":"https://github.com/YoloMao","image_url":"https://avatars.githubusercontent.com/u/16042670?v=4","imageURL":"https://avatars.githubusercontent.com/u/16042670?v=4"}],"frontMatter":{"slug":"custom ios sdk","title":"\u57fa\u4e8e GrowingIO \u73b0\u6709 SDK \u57fa\u7840\u4e0a\u7684\u4e8c\u6b21\u5f00\u53d1 - iOS \u7bc7","authors":[{"name":"CaicaiNo","title":"GrowingIO SDK Team","url":"https://github.com/CaicaiNo","image_url":"https://avatars.githubusercontent.com/u/17329515?v=4","imageURL":"https://avatars.githubusercontent.com/u/17329515?v=4"},{"name":"YoloMao","title":"GrowingIO SDK Team","url":"https://github.com/YoloMao","image_url":"https://avatars.githubusercontent.com/u/16042670?v=4","imageURL":"https://avatars.githubusercontent.com/u/16042670?v=4"}],"tags":["sdk","iOS","custom"]},"unlisted":false,"nextItem":{"title":"\u57fa\u4e8e GrowingIO \u73b0\u6709 SDK \u57fa\u7840\u4e0a\u7684\u4e8c\u6b21\u5f00\u53d1 - Android \u7bc7","permalink":"/growingio-sdk-docs/blog/custom android sdk"}},"content":"--------------\\n\\nimport Tabs from \'@theme/Tabs\';\\nimport TabItem from \'@theme/TabItem\';\\n\\n## SDK\u7ed3\u6784\u4ecb\u7ecd\\n\\nSDK \u53ef\u4ee5\u901a\u8fc7\u62c6\u5206\u6210\u6a21\u5757\u3001\u670d\u52a1\u5b9e\u73b0\u6a21\u5757\u5316\uff0c\u5728 GrowingIO \u7684 SDK \u4e2d\uff0c\u5df2\u7ecf\u6709\u591a\u4e2a\u6a21\u5757\u529f\u80fd\u5df2\u7ecf\u4ece\u4ee3\u7801\u4e2d\u5206\u79bb\u51fa\u6765\uff0c\u540e\u7eed\u5c06\u4f1a\u72ec\u7acb\u51fa\u66f4\u591a\u7684\u6a21\u5757\uff0c[GrowingAnalytics.podspec](https://github.com/growingio/growingio-sdk-ios-autotracker/blob/master/GrowingAnalytics.podspec) \u6587\u4ef6\u4e2d\u5305\u542b\u4e86\u6240\u6709\u7684\u76f8\u5173\u4fe1\u606f\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n### ** \u6a21\u5757 **\\n\\n\u5177\u6709\u5355\u72ec\u4e1a\u52a1\u529f\u80fd\u7684\u6a21\u5757\uff0c\u4f8b\u5982\u5708\u9009\uff0cMobile Debugger\u3002\u6a21\u5757\u9075\u5faa [\u6a21\u5757\u534f\u8bae](https://github.com/growingio/growingio-sdk-ios-autotracker/blob/master/GrowingTrackerCore/Public/GrowingModuleProtocol.h) \u4e14\u9700\u8981\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c\uff0c\u5e76\u53ef\u80fd\u4f7f\u7528\u670d\u52a1\u3002Module \u53ef\u4ee5\u53bb\u9664\u3002\\n\\n| \u540d\u79f0     | \u8bf4\u660e | \u662f\u5426\u53ef\u9009 |\\n| :------: | :------:   | :------:   |\\n| MobileDebugger | \u6570\u636e\u8c03\u8bd5 Mobile Debugger\uff0c\u9ed8\u8ba4\u96c6\u6210\u5728\u57cb\u70b9 SDK \u4e2d | \u662f |\\n| WebCircle | \u57fa\u4e8e\u65e0\u57cb\u70b9\u7684\u5708\u9009\u63d2\u4ef6\uff0c\u9ed8\u8ba4\u96c6\u6210\u5728\u65e0\u57cb\u70b9 SDK \u4e2d | \u662f |\\n| Hybrid | \u6df7\u5408\u5f00\u53d1\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u96c6\u6210\u5728\u65e0\u57cb\u70b9 SDK \u4e2d\uff08\u65e0\u57cb\u70b9\u4e2d\u81ea\u52a8\u6ce8\u5165\uff09\uff0c\u57cb\u70b9 SDK \u9700\u8981\u624b\u52a8\u5bfc\u5165 | \u662f |\\n| Protobuf |\u4f7f\u7528 protocol buffer \u683c\u5f0f\u4fdd\u5b58\u548c\u4e0a\u4f20\u4e8b\u4ef6\u6570\u636e\uff0c\u96c6\u6210\u5373\u751f\u6548\uff1b\u9ed8\u8ba4\u4e3a JSON \u683c\u5f0f\uff0c2 \u79cd\u683c\u5f0f\u4e92\u4e0d\u517c\u5bb9\uff0c\u8fc1\u79fb\u5c06\u5bfc\u81f4\u6570\u636e\u5e93\u5185\u672a\u4e0a\u4f20\u7684\u4e8b\u4ef6\u6570\u636e\u4e22\u5931|\u662f|\\n| DefaultServices |\u9ed8\u8ba4 Services \u96c6\u5408\uff0c\u9ed8\u8ba4\u96c6\u6210\u5728\u57cb\u70b9 SDK \u4e0e\u65e0\u57cb\u70b9 SDK \u4e2d|\u5426|\\n| Advert |\u5e7f\u544a SDK \u6a21\u5757\uff0c\u5305\u542b\u6fc0\u6d3b\u4e0e\u5524\u9192\u4e8b\u4ef6|\u662f|\\n| APM |APM SDK \u6a21\u5757\uff0c\u5305\u62ec\u5d29\u6e83\u76d1\u63a7\u3001\u542f\u52a8\u76d1\u63a7\u3001\u9875\u9762\u52a0\u8f7d\u76d1\u63a7\u7b49|\u662f|\\n| \u66f4\u591a\u5f00\u53d1\u4e2d... |||\\n\\n### ** \u670d\u52a1 **\\n\\n\u5177\u6709\u5355\u4e2a\u903b\u8f91\u5904\u7406\u7684\u5355\u5143\uff0c\u4f9b Module \u4f7f\u7528\uff0c\u53ef\u66ff\u6362\uff0c\u53ef\u53bb\u9664\u3002\u4f8b\u5982\u7f51\u7edc\u53d1\u9001\u670d\u52a1\u3001\u52a0\u5bc6\u670d\u52a1\u3002\u5bf9\u5e94\u7684 Service Protocol \u534f\u8bae\u53ef\u4ee5\u53bb [Services](https://github.com/growingio/growingio-sdk-ios-autotracker/tree/master/GrowingTrackerCore/Public) \u4e0b\u67e5\u770b\u3002\\n\\n> \u60a8\u53ef\u4ee5\u521b\u5efa\u81ea\u5df1\u7684 Service \u670d\u52a1\u5e76\u66ff\u6362\u539f\u6709 Service \u670d\u52a1\uff0c\u4f8b\u5982\u9009\u7528\u81ea\u5df1\u7684\u52a0\u5bc6\u670d\u52a1\u3002\u60a8\u4e0d\u5e94\u8be5\u53bb\u9664\u4efb\u610f Service\uff0c\u9664\u975e\u60a8\u7684\u6a21\u5757\u548c\u6838\u5fc3\u5e93\u90fd\u6ca1\u6709\u4f7f\u7528\u8be5 Service\u3002\\n\\n|     \u540d\u79f0      |                    \u8bf4\u660e                    | \u662f\u5426\u53ef\u66ff\u6362 | \u662f\u5426\u53ef\u9009 |\\n| :-----------: | :----------------------------------------: | :------: | :-----------: |\\n|   Database    |          \u6570\u636e\u5e93\u670d\u52a1\uff0c\u5904\u7406\u4e8b\u4ef6\u6570\u636e (Default)          |    \u662f    | \u5426 |\\n|    Network    |                \u7f51\u7edc\u53d1\u9001\u670d\u52a1 (Default)                |    \u662f    | \u5426 |\\n|  Compression  |     \u538b\u7f29\u670d\u52a1\uff0c\u7528\u4e8e\u7f51\u7edc\u53d1\u9001\u65f6\u7684\u6570\u636e\u538b\u7f29 (Default\uff0c\u4e0e Encryption \u4e00\u8d77\u4f7f\u7528)     |    \u662f   | \u5426 |\\n|  Encryption   |     \u52a0\u5bc6\u670d\u52a1\uff0c\u7528\u4e8e\u7f51\u7edc\u53d1\u9001\u65f6\u7684\u6570\u636e\u52a0\u5bc6 (Default\uff0c\u4e0e Compression \u4e00\u8d77\u4f7f\u7528)     |    \u662f    | \u5426 |\\n| WebSocket | websocket \u670d\u52a1\uff0c\u7528\u4e8e\u5708\u9009\u4ee5\u53ca Mobile Debugger | \u662f | \u662f |\\n| \u66f4\u591a\u5f00\u53d1\u4e2d... | | |  |\\n\\n\\n\\n### ** \u6838\u5fc3\u5e93 **\\n\\n| \u540d\u79f0     | \u8bf4\u660e | \u662f\u5426\u53ef\u9009 |\\n| :------- | :------:  | :------:  |\\n| TrackerCore | \u57cb\u70b9\u6838\u5fc3\u5e93\uff0c\u5305\u542b\u6700\u57fa\u672c\u7684\u57cb\u70b9\u903b\u8f91\uff0c\u4ee5\u53ca Service \u534f\u8bae\uff0c\u662f\u6700\u57fa\u7840\u7684\u6a21\u5757 | \u5426 |\\n| AutotrackerCore | \u65e0\u57cb\u70b9\u6838\u5fc3\u5e93\uff0c\u4f9d\u8d56\u4e8e\u57cb\u70b9\u6838\u5fc3\u5e93\uff0c\u5305\u542b\u65e0\u57cb\u70b9\u7684\u6ce8\u5165\u903b\u8f91 | \u5426\uff08\u57cb\u70b9 SDK \u65e0\u9700\u96c6\u6210\u6b64\u5e93\uff09 |\\n\\n### ** \u5916\u58f3 **\\n\\n`GrowingTracker` \u548c `GrowingAutotracker` \u5c5e\u4e8e\u5916\u58f3\u90e8\u5206\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u83dc\u7bee\uff0c\u91cc\u9762\u88c5\u4e86\u4ece\u5e02\u573a\u4e2d\u9009\u8d2d\u7684 `Module`\u4ee5\u53ca `Service` \uff0c\u5916\u58f3\u4e00\u822c\u53ea\u8981\u4e00\u4e2a\u5bf9\u5916\u63a5\u53e3\u7c7b\uff0c\u53ef\u4ee5\u81ea\u884c\u5b9a\u4e49\u63a5\u53e3\u5f00\u653e\u7a0b\u5ea6\u3002\\n\\n> \u5982\u679c\u9700\u8981\u9ad8\u5ea6\u5b9a\u5236\u5316 SDK\uff0c\u53ef\u4ee5\u521b\u5efa\u81ea\u5df1\u7684\u5916\u58f3\u7c7b\uff0c\u5e76\u5728 spec \u914d\u7f6e\u4e2d\u9009\u62e9\u60a8\u9700\u8981\u4f9d\u8d56\u7684 Module \u4ee5\u53ca Service\u3002\\n\\n| \u540d\u79f0        |    \u8bf4\u660e    |                             \u4f9d\u8d56                             |\\n| :---------- | :--------: | :----------------------------------------------------------: |\\n| Tracker     |  \u57cb\u70b9 SDK  | TrackerCore\u3001MobileDebugger\u3001DefaultServices (Database\u3001Network\u3001Encryption\u3001Compression) |\\n| Autotracker | \u65e0\u57cb\u70b9 SDK | AutotrackerCore\u3001Hybrid\u3001MobileDebugger\u3001WebCircle\u3001DefaultServices (Database\u3001Network\u3001Encryption\u3001Compression) |\\n\\n### ** \u914d\u7f6e\u9879 **\\n\\n\u5bf9\u4e8e\u5e38\u7528\u7684\u53ef\u9009\u914d\u7f6e\uff0c\u589e\u52a0\u4e86\u914d\u7f6e\u9879\uff0c\u901a\u8fc7 Pod \u5f15\u5165\u53ef\u4ee5\u5b9e\u73b0\\n\\n| \u540d\u79f0        |   \u8bf4\u660e    | \u7248\u672c |\\n| :---------- | :-------: | :---------: |\\n| DISABLE_IDFA     |  \u7981\u7528 IDFA\uff0c\u4e14 SDK \u4e2d\u4e0d\u4f1a\u518d\u6709\u76f8\u5173\u83b7\u53d6 IDFA \u4ee3\u7801\u903b\u8f91  | <font color=\'red\'>>=3.2.0</font> |\\n\\n:::info\\n\u4f7f\u7528\u8bf7\u53c2\u8003 [**\u7981\u7528 IDFA**](/docs/ios/Configuration#\u5176\u4ed6)\\n:::\\n\\n## \u4e8c\u6b21\u5f00\u53d1\\n\\n### 1. \u521b\u5efa\u4e00\u4e2a\u5916\u58f3\\n\\n\u56e0\u4e3a\u5916\u58f3\u56fa\u5b9a\u914d\u7f6e\u4e86 Module \u4ee5\u53ca Service\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49\u6211\u4eec\u7684\u5916\u58f3\uff0c\u624d\u80fd\u81ea\u5b9a\u4e49\u914d\u7f6e Module \u4ee5\u53ca Service ,\u4f7f\u7528 Cocoapods \u914d\u7f6e\u6700\u4e3a\u65b9\u4fbf\uff0c\u8fd9\u91cc\u4ee5\u4fee\u6539 SDK \u7684 Autotracker \u914d\u7f6e\u4e3a\u4f8b\uff1a\\n\\n1. \u9996\u5148\u81ea\u5b9a\u4e49\u5f00\u53d1\u5c31\u4e0d\u80fd\u4f7f\u7528 Cocoapods \u5e93\u4e0a\u7684 Autotracker \u7248\u672c\uff0c\u53ef\u4ee5\u4ece [Github\u4ed3\u5e93](https://github.com/growingio/growingio-sdk-ios-autotracker) \u4e0a\u4e0b\u8f7d\u6700\u65b0\u7684 Release\u5305\\n\\n2. \u89e3\u538b\u5230\u672c\u5730\uff0c\u7136\u540e\u5728\u539f\u5de5\u7a0b\u7684 Podfile \u6587\u4ef6\u4e2d\u4fee\u6539\u4f9d\u8d56\u5173\u7cfb\u4e3a\u8def\u5f84\u4f9d\u8d56\uff1a\\n\\n```bash\\n# \u539f\u6765\uff1a\\npod \'GrowingAnalytics/Autotracker\'\\n# \u4fee\u6539\u540e\uff1a\\npod \'GrowingAnalytics/Autotracker\', :path => \'./../growingio-sdk-ios-autotracker\'\\n```\\n\\n> \u8def\u5f84\u8bf7\u8bbe\u7f6e\u4e3a\u76f8\u5bf9\u8def\u5f84\uff0c\u4f8b\u5982 ./../growingio-sdk-ios-autotracker\\n\\n3. \u4fee\u6539 GrowingAnalytics.podspec \u6587\u4ef6\u4e2d Autotracker \u7684\u914d\u7f6e\uff1a\\n\\n```bash\\ns.subspec \'Autotracker\' do |autotracker|\\n  autotracker.source_files = \'GrowingAutotracker/**/*{.h,.m,.c,.cpp,.mm}\'\\n  autotracker.public_header_files = \'GrowingAutotracker/*.h\'\\n  autotracker.dependency \'GrowingAnalytics/AutotrackerCore\'\\n\\n  # Modules\\n  autotracker.dependency \'GrowingAnalytics/Hybrid\'\\n  autotracker.dependency \'GrowingAnalytics/MobileDebugger\'\\n  autotracker.dependency \'GrowingAnalytics/WebCircle\'\\n  autotracker.dependency \'GrowingAnalytics/DefaultServices\'\\nend\\n```\\n\\n\u4f8b\u5982\u9700\u8981\u53bb\u6389 WebCirle \u548c MobileDebugger \uff0c\u5219\u4fee\u6539\u4e3a\uff1a\\n\\n```bash\\ns.subspec \'Autotracker\' do |autotracker|\\n  autotracker.source_files = \'GrowingAutotracker/**/*{.h,.m,.c,.cpp,.mm}\'\\n  autotracker.public_header_files = \'GrowingAutotracker/*.h\'\\n  autotracker.dependency \'GrowingAnalytics/AutotrackerCore\'\\n\\n  # Modules\\n  autotracker.dependency \'GrowingAnalytics/Hybrid\'\\n  autotracker.dependency \'GrowingAnalytics/DefaultServices\'\\nend\\n```\\n\\n\u5bf9\u4e8e AutoTracker \u4e2d\u7684 Service \uff0c\u4e0d\u5efa\u8bae\u53bb\u9664\uff0c\u5efa\u8bae\u66ff\u6362\uff0c\u4f8b\u5982 Network \u8d1f\u8d23\u7f51\u7edc\uff0c\u5982\u679c\u53bb\u9664\u5c06\u65e0\u6cd5\u8fdb\u884c\u7f51\u7edc\u6570\u636e\u53d1\u9001\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u7f51\u7edc Service \u6765\u8fdb\u884c\u66ff\u6362\u539f\u6765\u56fa\u6709\u7684 Network\uff0c\u8fd9\u70b9\u540e\u7eed\u4f1a\u8fdb\u884c\u8bf4\u660e\u3002\\n\\n4. \u6267\u884c pod install \uff0c\u6240\u4fee\u6539\u7684 Autotracker \u914d\u7f6e\u5373\u53ef\u751f\u6548\u3002\\n\\n> Autotracker \u4e2d\u53ea\u5305\u542b\u4e86\u4e00\u4e2a GrowingAutotracker \u7c7b\uff08Tracker \u540c\u7406\uff09\uff0c\u5982\u679c\u7528\u6237\u60f3\u5728\u5176\u57fa\u7840\u4e0a\u4fee\u6539\u6269\u5c55\uff0c\u8bf7\u53c2\u8003\u6216\u4f7f\u7528\u8fd9\u4e2a\u7c7b\\n\\n### 2. \u66ff\u6362 Service\\n\\n\u66ff\u6362 Service \u9002\u7528\u4e8e\u60f3\u66ff\u6362\u67d0\u4e2a\u903b\u8f91\u5355\u5143\u7684\u4ee3\u7801\uff0c\u4f8b\u5982 \u7f51\u7edc\u670d\u52a1\uff0c\u52a0\u5bc6 \u60f3\u4f7f\u7528\u81ea\u5df1\u7684\u3002\\n\\n#### 2.1 \u5236\u4f5c Service\\n\\nService \u5fc5\u5b9a\u7ee7\u627f\u5176\u5bf9\u5e94\u7684 Protocol\uff0c\u4f8b\u5982\u52a0\u5bc6 Service \u5bf9\u5e94\u534f\u8bae\u4e3a GrowingEncryptionService\uff1a\\n\\n```objectivec\\n@protocol GrowingEncryptionService <GrowingBaseService>\\n\\n@optional\\n\\n/// event\u76f8\u5173\u6570\u636e\u5728\u4e0a\u4f20\u4e4b\u524d\u7684\u52a0\u5bc6\u5904\u7406\\n/// @param data \u5c06\u8981\u52a0\u5bc6\u7684NSData\u5bf9\u8c61\\n/// @param hint \u76d0\u503c\\n- (NSData *_Nonnull)encryptEventData:(NSData *_Nonnull)data factor:(unsigned char)hint;\\n\\n/// \u672c\u5730\u6570\u636e\u5b58\u50a8\u52a0\u5bc6\uff08\u5982\u5f53\u5929\u5df2\u4f7f\u7528\u6570\u636e\u7f51\u7edc\u4e0a\u4f20\u7684\u6570\u636e\u91cf\u7b49\uff09\\n/// @param data \u5c06\u8981\u52a0\u5bc6\u7684NSData\u5bf9\u8c61\\n- (NSData *_Nonnull)encryptLocalData:(NSData *_Nonnull)data;\\n\\n/// \u672c\u5730\u6570\u636e\u5b58\u50a8\u89e3\u5bc6\uff08\u5982\u5f53\u5929\u5df2\u4f7f\u7528\u6570\u636e\u7f51\u7edc\u4e0a\u4f20\u7684\u6570\u636e\u91cf\u7b49\uff09\\n/// @param data \u5c06\u8981\u89e3\u5bc6\u7684NSData\u5bf9\u8c61\\n- (NSData *_Nonnull)decryptLocalData:(NSData *_Nonnull)data;\\n\\n@end\\n```\\n\\n\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u7c7b\uff0c\u9075\u5faa GrowingEncryptionService \u534f\u8bae\uff0c\u5728\u5bf9\u5e94\u7684\u65b9\u6cd5\u4e2d\u5199\u60a8\u81ea\u5df1\u7684\u903b\u8f91\uff0c\u4f8b\u5982\u8fd9\u91cc\u5728CustomEncryptionClass \u4e2d\u5b9e\u73b0\uff1a\\n\\n```objectivec\\n- (NSData *_Nonnull)encryptEventData:(NSData *_Nonnull)data factor:(unsigned char)hint {\\n    NSMutableData *dataM = [[NSMutableData alloc] initWithLength:data.length];\\n    // \u52a0\u5bc6\u903b\u8f91\u5904\u7406\u60a8\u7684\u6570\u636e\\n    return dataM;\\n}\\n```\\n\\n\u7136\u540e\u9700\u8981\u5c06 GrowingEncryptionService \u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b implclass \u4fee\u6539\u4e3a\u60a8\u81ea\u5df1\u521b\u5efa\u7684\u7c7b\uff0c\u4f8b\u5982\u4e0a\u8ff0\u7684 CustomEncryptionClass\uff0c\u66ff\u6362\u65b9\u6848\u6709\uff1a\\n\\n1. \u6ce8\u89e3 (\u63a8\u8350)\\n\\n```objectivec\\nGrowingService(GrowingEncryptionService, CustomEncryptionClass)\\n```\\n\\n2. \u4ee3\u7801\\n\\n\u521d\u59cb\u5316SDK\u524d\u8c03\u7528\\n\\n```objectivec\\n[[GrowingServiceManager sharedInstance] registerService:NSProtocolFromString(GrowingEncryptionService)\\n                                              implClass:NSClassFromString(@\\"CustomEncryptionClass\\")];\\n```\\n\\n\u8fd9\u6837\uff0c\u52a0\u5bc6\u670d\u52a1\u5c31\u4f7f\u7528\u7684\u60a8\u81ea\u5df1\u7684\u4e86\uff0c\u4e0b\u9762\u6211\u4eec\u9700\u8981\u5c06\u4ee3\u7801\u5bfc\u5165\u3002\\n\\n#### 2.2 \u66ff\u6362 Service\\n\\n\u53c2\u8003 Encryption \u7684\u914d\u7f6e\uff0c\u65b0\u589e\u4e00\u4e2a\\n\\n```bash\\ns.subspec \'Encryption\' do |service|\\n  service.source_files = \'Services/Encryption/**/*{.h,.m,.c,.cpp,.mm}\'\\n  service.public_header_files = \'Services/Encryption/Public/*.h\'\\n  service.dependency \'GrowingAnalytics/TrackerCore\'\\nend\\n```\\n\\n\u5e76\u5c06 2.1 \u521b\u5efa\u7684\u4ee3\u7801\u653e\u7f6e\u5bf9\u5e94\u7684 CustomEncryption \u76ee\u5f55\u4e0b\\n\\n```bash\\ns.subspec \'CustomEncryption\' do |service|\\n  service.source_files = \'Services/CustomEncryption/**/*{.h,.m,.c,.cpp,.mm}\'\\n  service.public_header_files = \'Services/CustomEncryption/Public/*.h\'\\n  service.dependency \'GrowingAnalytics/TrackerCore\'\\nend\\n```\\n\\n\u4fee\u6539 spec \u6587\u4ef6\u8fdb\u884c\u914d\u7f6e\uff1a\\n\\n```bash\\ns.subspec \'DefaultServices\' do |services|\\n  services.source_files = \'Modules/DefaultServices/**/*{.h,.m,.c,.cpp,.mm}\'\\n  services.public_header_files = \'Modules/DefaultServices/Public/*.h\'\\n  services.dependency \'GrowingAnalytics/TrackerCore\'\\n\\n  # Default Services\\n  services.dependency \'GrowingAnalytics/Database\'\\n  services.dependency \'GrowingAnalytics/Network\'\\n  services.dependency \'GrowingAnalytics/CustomEncryption\'\\n  services.dependency \'GrowingAnalytics/Compression\'\\nend\\n```\\n\\n\u8fd9\u6837 Autotracker \u5c31\u66ff\u6362\u4e86 Encryption \u7684\u670d\u52a1\u3002\\n\\n### 3. \u6269\u5c55 Module \\n\\n\u6269\u5c55 Module \u9002\u7528\u4e8e \u7528\u6237\u6709\u989d\u5916\u7684\u4e1a\u52a1\u9700\u6c42\u7684\u573a\u666f\uff0c\u8fd9\u91cc\u4e3e\u4f8b\u4e86\u51e0\u79cd\uff0c\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u6269\u5c55 Module \u8fdb\u884c\uff0c\u4f8b\u5982\uff1a\\n\\n1. SDK \u8fd0\u884c\u7684\u540c\u65f6\uff0c\u8fd8\u60f3\u5c06\u4e8b\u4ef6\u5199\u5165\u81ea\u5df1\u7684\u6570\u636e\u5e93\u4e2d\u505a\u989d\u5916\u64cd\u4f5c\\n2. SDK \u4e2d\u4e8b\u4ef6\u5c11\u4e86\uff0c\u60f3\u6dfb\u52a0\u81ea\u5df1\u7684\u989d\u5916\u4e8b\u4ef6\\n\\n\u4f46\u9700\u8981\u6ce8\u610f\u662f\u5355\u72ec\u7684\u4e1a\u52a1\u573a\u666f\uff0c\u60a8\u9700\u8981\u5c06\u903b\u8f91\u5168\u90e8\u5c01\u88c5\u5728 Module \u4e2d\uff0cModule \u53ef\u662f\u4f7f\u7528 TrackerCore \u4e2d\u7684\u7c7b\uff0c\u4f46 TrackerCore \u4e0d\u5e94\u8be5\u4f9d\u8d56 Module \u4e2d\u7684\u7c7b\u3002\\n\\n#### 3.1 \u793a\u4f8b 1\\n\\nSDK \u8fd0\u884c\u7684\u540c\u65f6\uff0c\u8fd8\u60f3\u5c06\u4e8b\u4ef6\u5199\u5165\u81ea\u5df1\u7684\u6570\u636e\u5e93\u4e2d\u505a\u989d\u5916\u64cd\u4f5c\\n\\n1. \u627e\u5230 GrowingEventManager \u4e8b\u4ef6\u53d1\u9001\u7684\u5165\u53e3 postEventBuidler:\uff0c\u53ef\u4ee5\u6dfb\u52a0\u62e6\u622a\u8005\u6765\u5904\u7406\u4e8b\u4ef6\u4fe1\u606f\\n\\n```objectivec\\n//\u62e6\u622a\u8005\u505a\u989d\u5916\u5904\u7406\\n@protocol GrowingEventInterceptor <NSObject>\\n\\n@optional\\n\\n/// \u53ef\u914d\u7f6e\u4e8b\u4ef6\u53d1\u9001\u901a\u9053\\n/// @param channels \u9ed8\u8ba4\u7684\u4e8b\u4ef6\u53d1\u9001\u901a\u9053\\n- (void)growingEventManagerChannels:(NSMutableArray<GrowingEventChannel *> *_Nullable)channels;\\n\\n/// \u4e8b\u4ef6\u88ab\u89e6\u53d1\\n/// @param eventType \u5f53\u524d\u4e8b\u4ef6\u7c7b\u578b\\n- (void)growingEventManagerEventTriggered:(NSString *_Nullable)eventType;\\n\\n/// \u5373\u5c06\u6784\u9020\u4e8b\u4ef6\\n/// @param builder \u4e8b\u4ef6\u6784\u9020\u5668\\n- (void)growingEventManagerEventWillBuild:(GrowingBaseBuilder *_Nullable)builder;\\n\\n/// \u4e8b\u4ef6\u6784\u9020\u5b8c\u6bd5\\n/// @param event \u5f53\u524d\u4e8b\u4ef6\\n- (void)growingEventManagerEventDidBuild:(GrowingBaseEvent *_Nullable)event;\\n\\n/// \u4e8b\u4ef6\u5165\u5e93\u5b8c\u6bd5\\n/// @param event \u5f53\u524d\u4e8b\u4ef6\\n- (void)growingEventManagerEventDidWrite:(GrowingBaseEvent *_Nullable)event;\\n\\n/// \u81ea\u5b9a\u4e49event\u53d1\u9001\u8bf7\u6c42\\n/// @param channel \u4e8b\u4ef6\u53d1\u9001\u901a\u9053\\n- (id<GrowingRequestProtocol> _Nullable)growingEventManagerRequestWithChannel:(GrowingEventChannel *_Nullable)channel;\\n\\n/// \u5373\u5c06\u53d1\u9001\u4e8b\u4ef6\\n/// @param events \u53d1\u9001\u7684\u4e8b\u4ef6\\n- (NSArray *_Nonnull)growingEventManagerEventsWillSend:(NSArray<id<GrowingEventPersistenceProtocol>> *_Nonnull)events\\n                                               channel:(GrowingEventChannel *_Nonnull)channel;\\n\\n/// \u4e8b\u4ef6\u53d1\u9001\u5b8c\u6bd5\\n/// @param events \u53d1\u9001\u7684\u4e8b\u4ef6\\n- (void)growingEventManagerEventsDidSend:(NSArray<id<GrowingEventPersistenceProtocol>> *_Nonnull)events\\n                                 channel:(GrowingEventChannel *_Nonnull)channel;\\n\\n@end\\n```\\n\\n\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7c7b\uff0c\u6dfb\u52a0\u5230 GrowingEventManager \u62e6\u622a\u8005\u4e2d\\n\\n```objectivec\\n/// \u6dfb\u52a0\u62e6\u622a\u8005 - \u6267\u884c\u987a\u5e8f\u4e0d\u4fdd\u8bc1\u6709\u5e8f\\n/// @param interceptor \u62e6\u622a\u8005\\n- (void)addInterceptor:(NSObject<GrowingEventInterceptor>* _Nonnull)interceptor;\\n```\\n\\n\u5373\u53ef\u4ee5\u901a\u8fc7\u4ee3\u7406\u56de\u8c03\u83b7\u5f97\u4e8b\u4ef6\u4fe1\u606f\uff0c\u7136\u540e\u505a\u81ea\u5df1\u7684\u903b\u8f91\u5904\u7406\u3002\\n\\n2. Module \u7684\u5904\u7406\\n\\nmodule \u9700\u8981\u7ee7\u627f GrowingModuleProtocol \u534f\u8bae\\n\\n```objectivec\\n#import <Foundation/Foundation.h>\\n#import \\"GrowingModuleProtocol.h\\"\\n\\nNS_ASSUME_NONNULL_BEGIN\\n\\n@interface CustomEventModule : NSObject <GrowingModuleProtocol>\\n\\n@end\\n\\nNS_ASSUME_NONNULL_END\\n```\\n\\n\u540c\u65f6\u4f7f\u7528 GrowingMod \u6ce8\u518c Module \u5230 SDK \u4e2d\uff0c\u5e76\u5b9e\u73b0 growingModInit \u65b9\u6cd5\uff0c\u5728\u65b9\u6cd5\u4e2d\u5c06\u81ea\u5df1\u6dfb\u52a0\u5230 GrowingEventManager \u62e6\u622a\u8005\u4e2d \\n\\n```objectivec\\n#import \\"CustomEventModule.h\\"\\n#import \\"GrowingEventManager.h\\"\\n\\n\\nGrowingMod(CustomEventModule)\\n\\n@implementation CustomEventModule\\n\\n- (void)growingModInit:(GrowingContext *)context {\\n    [[GrowingEventManager sharedInstance] addInterceptor:self];\\n}\\n\\n- (void)growingEventManagerEventDidBuild:(GrowingBaseEvent* _Nullable)event {\\n    // do your work\\n}\\n\\n@end\\n```\\n\\n\u8fd9\u6837 Module \u5c31\u5b9e\u73b0\u4e86\u529f\u80fd\u3002\\n\\n#### 3.2 \u793a\u4f8b 2\\n\\nSDK \u4e2d\u4e8b\u4ef6\u5c11\u4e86\uff0c\u60f3\u6dfb\u52a0\u81ea\u5df1\u7684\u989d\u5916\u4e8b\u4ef6\uff0c\u8fd9\u90e8\u5206\u53ef\u4ee5\u53c2\u8003 https://github.com/growingio/growingio-sdk-ios-autotracker/blob/master/Modules/Advert\\n\\n1. \u9996\u5148 SDK \u4e2d\u7684\u4e8b\u4ef6\u5747\u7ee7\u627f\u81ea GrowingBaseEvent , \u60a8\u53ef\u4ee5\u7ee7\u627f\u8be5\u7c7b\u6216\u8005\u5176\u5b50\u7c7b\uff0c\u4f8b\u5982 GrowingActivateEvent\\n\\n```objectivec\\n#import \\"GrowingTrackerCore/Event/GrowingBaseAttributesEvent.h\\"\\n\\nNS_ASSUME_NONNULL_BEGIN\\n\\n@class GrowingActivateBuilder;\\n\\n@interface GrowingActivateEvent : GrowingBaseAttributesEvent\\n\\n@property (nonatomic, copy, readonly) NSString *idfa;\\n@property (nonatomic, copy, readonly) NSString *idfv;\\n\\n- (instancetype)init NS_UNAVAILABLE;\\n+ (instancetype)new NS_UNAVAILABLE;\\n\\n+ (GrowingActivateBuilder *)builder;\\n\\n@end\\n\\n@interface GrowingActivateBuilder : GrowingBaseAttributesBuilder\\n\\n@property (nonatomic, copy, readonly) NSString *idfa;\\n@property (nonatomic, copy, readonly) NSString *idfv;\\n\\n- (GrowingActivateBuilder *(^)(NSDictionary<NSString *, NSObject *> *value))setAttributes;\\n\\n@end\\n\\nNS_ASSUME_NONNULL_END\\n```\\n\\n2. \u53d1\u9001\u65f6\u673a\u7531\u7528\u6237\u81ea\u5b9a\uff0c\u518d\u8005\u5c31\u662f\u4e8b\u4ef6\u5982\u4f55\u53d1\u9001\uff0c\u5747\u4f7f\u7528 Builder \u65b9\u5f0f\u4f20\u5165\\n\\n```objectivec\\nGrowingActivateBuilder *builder = GrowingActivateEvent.builder;\\nif (userAgent.length > 0) {\\n    builder.setAttributes(@{@\\"userAgent\\" : userAgent.copy});\\n}\\n[[GrowingEventManager sharedInstance] postEventBuilder:builder];\\n```"},{"id":"custom android sdk","metadata":{"permalink":"/growingio-sdk-docs/blog/custom android sdk","editUrl":"https://github.com/growingio/growingio-sdk-docs/edit/master/blog/2022-10-09-custom android sdk.md","source":"@site/blog/2022-10-09-custom android sdk.md","title":"\u57fa\u4e8e GrowingIO \u73b0\u6709 SDK \u57fa\u7840\u4e0a\u7684\u4e8c\u6b21\u5f00\u53d1 - Android \u7bc7","description":"\u4e3a\u4e86\u6ee1\u8db3\u4e0d\u540c\u5ba2\u6237\u7684\u4f7f\u7528\u9700\u6c42\uff0c\u6211\u4eec\u7684SDK\u53ef\u4ee5\u901a\u8fc7\u96c6\u6210\u4e0d\u540c\u7684\u6a21\u5757\u5b9e\u73b0\u529f\u80fd\u7684\u81ea\u5b9a\u4e49\u3002\u6bd4\u5982\u8bf4\u4ee5\u4e0b\u573a\u666f\uff1a","date":"2022-10-09T00:00:00.000Z","formattedDate":"October 9, 2022","tags":[{"label":"sdk","permalink":"/growingio-sdk-docs/blog/tags/sdk"},{"label":"android","permalink":"/growingio-sdk-docs/blog/tags/android"},{"label":"custom","permalink":"/growingio-sdk-docs/blog/tags/custom"}],"readingTime":15.555,"hasTruncateMarker":true,"authors":[{"name":"cpacm","title":"GrowingIO SDK Team","url":"https://github.com/cpacm","imageURL":"https://avatars.githubusercontent.com/u/7134104?v=4"}],"frontMatter":{"slug":"custom android sdk","title":"\u57fa\u4e8e GrowingIO \u73b0\u6709 SDK \u57fa\u7840\u4e0a\u7684\u4e8c\u6b21\u5f00\u53d1 - Android \u7bc7","author":"cpacm","author_title":"GrowingIO SDK Team","author_url":"https://github.com/cpacm","author_image_url":"https://avatars.githubusercontent.com/u/7134104?v=4","tags":["sdk","android","custom"]},"unlisted":false,"prevItem":{"title":"\u57fa\u4e8e GrowingIO \u73b0\u6709 SDK \u57fa\u7840\u4e0a\u7684\u4e8c\u6b21\u5f00\u53d1 - iOS \u7bc7","permalink":"/growingio-sdk-docs/blog/custom ios sdk"},"nextItem":{"title":"\u4ece iOS AutoreleasePool \u5230\u7f16\u8bd1\u5668\u4f18\u5316","permalink":"/growingio-sdk-docs/blog/AutoreleasePool"}},"content":"\u4e3a\u4e86\u6ee1\u8db3\u4e0d\u540c\u5ba2\u6237\u7684\u4f7f\u7528\u9700\u6c42\uff0c\u6211\u4eec\u7684SDK\u53ef\u4ee5\u901a\u8fc7\u96c6\u6210\u4e0d\u540c\u7684\u6a21\u5757\u5b9e\u73b0\u529f\u80fd\u7684\u81ea\u5b9a\u4e49\u3002\u6bd4\u5982\u8bf4\u4ee5\u4e0b\u573a\u666f\uff1a\\n\\n1. \u4e0d\u719f\u6089Android\u5f00\u53d1\u6216\u53ea\u60f3\u5feb\u901f\u96c6\u6210\\n> \u90a3\u4e48\u76f4\u63a5\u53c2\u8003 [\u5982\u4f55\u96c6\u6210](/docs/android)\uff0c\u4f7f\u7528\u6211\u4eec\u63d0\u4f9b\u9ed8\u8ba4\u7684SDK\u96c6\u6210\u5373\u53ef\u3002\\n\\n2. \u60f3\u8981\u96c6\u6210\u4e00\u4e9b\u989d\u5916\u7684\u529f\u80fd\uff0c\u5982\u6570\u636e\u52a0\u5bc6\\n> \u53ef\u4ee5\u901a\u8fc7API\u63a5\u53e3\u624b\u52a8\u6ce8\u518c\u5df2\u6709\u7684\u529f\u80fd\u6a21\u5757\u3002\\n\\n3. \u60f3\u8981\u81ea\u5df1\u8c03\u6574SDK\u7684\u529f\u80fd\u6a21\u5757\uff0c\u5982\u53bb\u9664\u7ebf\u4e0a\u8c03\u8bd5\u529f\u80fd\\n> \u53c2\u8003 [\u81ea\u5b9a\u4e49SDK](#\u81ea\u5b9a\u4e49SDK)\uff0c\u6839\u636e\u9700\u8981\u96c6\u6210SDK\u3002\\n\\n4. \u4e0d\u60f3\u8981\u67d0\u4e9b\u529f\u80fd\u6a21\u5757\uff0c\u60f3\u8981\u63a5\u5165\u81ea\u5df1\u7684\u5c01\u88c5\u7684\u529f\u80fd\uff0c\u5982\u7f51\u7edc\u6846\u67b6\\n> \u53c2\u8003 [\u81ea\u5b9a\u4e49\u6a21\u5757](#\u81ea\u5b9a\u4e49\u6a21\u5757)\uff0c\u91cd\u65b0\u5b9a\u4e49\u4e00\u4e2a\u6a21\u5757\u6765\u5b8c\u6210\u81ea\u5df1\u7684\u529f\u80fd\u5c01\u88c5\u3002\\n\\n5. \u5728\u4e00\u4e9b\u7b2c\u4e09\u65b9\u8de8\u5e94\u7528\u5e73\u53f0\u4e0a\u4f7f\u7528\\n> \u4e00\u822c\u6211\u4eec\u4f1a\u5c3d\u91cf\u63d0\u4f9b\u5e38\u89c1\u7684\u7b2c\u4e09\u65b9\u5e73\u53f0\u7684\u96c6\u6210\u65b9\u6848\uff0c\u82e5\u6ca1\u6709\u5219\u53ef\u4ee5\u53c2\u8003 [\u81ea\u5b9a\u4e49SDK](#\u81ea\u5b9a\u4e49SDK) \u6765\u5c01\u88c5\u81ea\u5df1\u9700\u8981\u7684SDK\u529f\u80fd\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nimport Tabs from \'@theme/Tabs\';\\nimport TabItem from \'@theme/TabItem\';\\n\\n## \u81ea\u5b9a\u4e49SDK\\n\\n\u5728 GrowingIO \u7684 SDK \u4e2d\uff0c\u5df2\u7ecf\u6709\u591a\u4e2a\u6a21\u5757\u529f\u80fd\u5df2\u7ecf\u4ece\u4ee3\u7801\u4e2d\u5206\u79bb\u51fa\u6765\u540e\u7eed\u5c06\u4f1a\u72ec\u7acb\u51fa\u66f4\u591a\u7684\u6a21\u5757\u3002\u5177\u4f53\u53ef\u4ee5\u5230[\u6a21\u5757\u529f\u80fd](/docs/android/modules)\u67e5\u770b\u5df2\u6709\u7684\u529f\u80fd\u6a21\u5757\u3002\\n\\n\u8fd9\u91cc\u4ee5\u65b0\u5efa\u4e00\u4e2a\u9879\u76ee\u5e76\u96c6\u6210\u4e00\u4e2a\u81ea\u5b9a\u4e49 GrowingIO SDK \u4f5c\u4e3a\u4e00\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\uff0c\u8981\u6c42\u662fSDK\u5177\u5907\u65e0\u57cb\u70b9\uff0c\u4f7f\u7528okhttp\u8bf7\u6c42\u6570\u636e\uff0c\u5e76\u4e0d\u9700\u8981\u5708\u9009\u548cdebugger\u8c03\u8bd5\u5de5\u5177\u3002\\n\\n### 1. \u9996\u5148\u96c6\u6210\u65e0\u57cb\u70b9\\n\u96c6\u6210\u65e0\u57cb\u70b9\u9700\u8981\u4e00\u4e2a gradle \u63d2\u4ef6\u548c `growingio-autotracker-core` \u57fa\u7840\u5e93\u3002\\n\u5728 project \u7ea7\u522b\u7684 build.gradle \u4e0b\u6dfb\u52a0\u4f9d\u8d56\\n```groovy\\nbuildscript {\\n    //...\\n    repositories {\\n        //...\\n        mavenCentral()\\n    }\\n    dependencies {\\n        //\u65e0\u57cb\u70b9\u6ce8\u5165\u63d2\u4ef6\\n        classpath \\"com.growingio.android:autotracker-gradle-plugin:4.0.0\\"\\n    }\\n}\\n```\\n\\n\u5728 app \u7684 build.gradle \u4e0b\u6dfb\u52a0\u63d2\u4ef6\u548c\u4f9d\u8d56\\n\\n```groovy\\nplugins {\\n\\t//...\\n    id \'com.growingio.android.autotracker\'\\n}\\n\\n//...\\n\\ndependencies {\\n\\t//\u65e0\u57cb\u70b9\u57fa\u7840\u5e93\\n\\timplementation \'com.growingio.android:autotracker-core:4.0.0\'\\n}\\n\\n```\\n\\n### 2. \u96c6\u6210\u7f51\u7edc\u8bf7\u6c42\u548c\u6570\u636e\u8bf7\u6c42\u683c\u5f0fjson\\n\\n\u540c\u6837\u5728 app \u7684 build.gradle \u4e0b\u6dfb\u52a0\u4f9d\u8d56\\n\\n```groovy\\ndependencies {\\n\\t//\u65e0\u57cb\u70b9\u57fa\u7840\u5e93\\n\\timplementation \'com.growingio.android:autotracker-core:4.0.0\'\\n\\n\\t//\u6240\u9700\u7684\u6a21\u5757\\n\\timplementation \'com.growingio.android:okhttp3:4.0.0\'\\n\\timplementation \'com.growingio.android:database:4.0.0\'\\n\\timplementation \'com.growingio.android:protobuf:4.0.0\'\\n}\\n```\\n\\n### 3. \u6dfb\u52a0\u6ce8\u89e3\u89e3\u91ca\u5668\\n\\n\u5728 app \u7684 build.gradle \u4e0b\u6dfb\u52a0\u6ce8\u89e3\u5e93\u548c\u6ce8\u89e3\u89e3\u91ca\u5668.\\n\\n```groovy\\ndependencies {\\n\\t//\u65e0\u57cb\u70b9\u57fa\u7840\u5e93\\n\\timplementation \'com.growingio.android:autotracker-core:4.0.0\'\\n\\n\\t//\u6240\u9700\u7684\u6a21\u5757\\n\\timplementation \'com.growingio.android:okhttp3:4.0.0\'\\n\\timplementation \'com.growingio.android:database:4.0.0\'\\n\\timplementation \'com.growingio.android:json:4.0.0\'\\n\\n\\t//\u6ce8\u89e3\u89e3\u6790\\n\\timplementation \'com.growingio.android:annotation:4.0.0\'\\n\\tannotationProcessor \'com.growingio.android:compiler:4.0.0\'\\n}\\n```\\n\\n:::tip kapt\\n\u82e5\u4f7f\u7528kotlin\uff0c\u53ef\u4ee5\u901a\u8fc7 kapt \u6765\u4f9d\u8d56\u6ce8\u89e3\u5668\\n\\n`kapt \'com.growingio.android:compiler:4.0.0\'`\\n:::\\n\\n### 4. \u4f7f\u7528\u6ce8\u89e3\u81ea\u5b9a\u4e49SDK\u7684\u5c5e\u6027\\n\u5728\u4ee3\u7801\u4e2d\u65b0\u5efa\u4e00\u4e2a\u7c7b `GrowingIODemoAppModule`\uff0c\u8be5\u7c7b\u7ee7\u627f\u81ea `AppGioModule`\uff0c\u53ef\u4ee5\u7528\u6765\u6307\u5b9a\u81ea\u52a8\u751f\u6210\u4ee3\u7801\u7684\u540d\u79f0\u3002\\n\\n<Tabs\\n  groupId=\\"code-language\\"\\n  defaultValue=\\"kotlin\\"\\n  values={[\\n    {label: \'java\', value: \'java\'},\\n    {label: \'kotlin\', value: \'kotlin\'},\\n  ]\\n}>\\n\\n<TabItem value=\\"java\\">\\n\\n```java\\n@GIOAppModule(name = \\"DemoAutotracker\\", configName = \\"DemoTackerConfiguration\\")\\npublic class GrowingIODemoAppModule extends AppGioModule {\\n\\n}\\n```\\n\\n</TabItem>\\n<TabItem value=\\"kotlin\\">\\n\\n```kotlin\\n@GIOAppModule(name = \\"DemoAutotracker\\", configName = \\"DemoTackerConfiguration\\")\\nclass GrowingIODemoAppModule : AppGioModule(){\\n    \\n}\\n```\\n    \\n</TabItem>\\n</Tabs>\\n\\n`GIOAppModule` \u6ce8\u89e3\u4f1a\u6839\u636e\u8bbe\u7f6e\u7684\u540d\u79f0\u751f\u6210\u4e24\u4e2a\u7c7b\u4f5c\u4e3a\u5916\u90e8API\u8c03\u7528\u7c7b `DemoTackerConfiguration` \u914d\u7f6e\u7c7b\u548c `DemoAutotracker` \u8c03\u7528\u7c7b\u3002\\n\\n1. DemoTackerConfiguration \u7c7b\\n\u8be5\u7c7b\u540d\u79f0\u7531 `@GIOAppModule#configName` \u51b3\u5b9a\u3002\\n\u8be5\u7c7b\u4f1a\u83b7\u53d6\u6240\u6709\u6a21\u5757\u4e0b\u6240\u6709\u914d\u7f6e\u7c7b\u4fe1\u606f\uff08\u82e5\u6709\uff09\uff0c\u5e76\u5c06\u5b83\u4eec\u91cc\u9762\u7684\u6240\u6709\u65b9\u6cd5\u90fd\u6c47\u96c6\u5230\u672c\u8eab\u3002\\n\\n2. DemoAutotracker \u7c7b\\n\u8be5\u7c7b\u540d\u79f0\u7531 `@GIOAppModule#name` \u51b3\u5b9a\u3002\\n\u8be5\u7c7b\u4e3b\u8981\u7528\u6765\u63d0\u4f9bSDK\u521d\u59cb\u5316\u63a5\u53e3\uff0c\u603b\u5171\u63d0\u4f9b\u4e86\u4e24\u4e2a\u521d\u59cb\u5316\u65b9\u6cd5\uff0c \u4e00\u4e2a\u4e3a `startWithConfiguration(Coontext,DemoTackerConfiguration)`,\u8be5\u65b9\u6cd5\u8981\u6c42\u4f20\u5165\u7528\u6237\u5df2\u7ecf\u914d\u7f6e\u5b8c\u6210\u7684config\u5bf9\u8c61\uff1b\u53e6\u4e00\u4e3a `start(Context)`,\u8be5\u65b9\u6cd5\u9700\u8981\u914d\u5408 `@GIOTracker` \u6ce8\u89e3\u4f7f\u7528\uff0c\u4f1a\u5728\u4e0b\u9762\u4ecb\u7ecd\uff0c\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6config\u8fdb\u884c\u4ee3\u7801\u914d\u7f6e\uff1b\u4e24\u8005\u65b9\u6cd5\u6548\u679c\u4e00\u6837\uff0c\u90fd\u662f\u6574\u4e2a SDK \u521d\u59cb\u5316\u7684\u5165\u53e3\u3002\\n\\n\u540c\u65f6\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 `DemoAutotracker.get()` \u6765\u83b7\u53d6\u6574\u4e2a SDK \u5bf9\u5916\u7684\u5f00\u653e\u63a5\u53e3\u3002\\n\\n### 5. \u5229\u7528 `@GIOTracker` \u5b9e\u73b0\u6ce8\u518c\u914d\u7f6e\u63a5\u53e3\\n\\n`@GIOTracker` \u5404\u53c2\u6570\\n\\n| \u540d\u79f0      | \u53c2\u6570     | \u4f5c\u7528                 |\\n| --------- | -------- | -------------------- |\\n| path      | Class{\'<\'}?{\'>\'} | Tracker\u63a5\u53e3\u7c7b\u8def\u5f84    |\\n| accountId | String   | SDK\u521d\u59cb\u5316\u7684\u9879\u76eeid    |\\n| urlScheme | String   | SDK\u521d\u59cb\u5316\u7684urlScheme |\\n\\n`@GIOTracker` \u5177\u5907\u4e24\u90e8\u5206\u529f\u80fd\uff1a\\n1. **\u6307\u5b9a\u81ea\u5b9a\u4e49\u5f00\u653e\u63a5\u53e3**  \\nSDK \u9ed8\u8ba4\u63a5\u53e3\u7c7b\u4e3a `Tracker.class` \uff08\u65e0\u57cb\u70b9\u9700\u8981\u6307\u5b9a\u4e3a `Autotracker.class`\uff09,\u82e5\u5f00\u53d1\u8005\u4e8c\u6b21\u5f00\u53d1\u65f6\u9700\u8981\u66f4\u591a\u5f00\u653e\u7684\u63a5\u53e3\u6765\u6ee1\u8db3\u9700\u6c42\uff0c\u5219\u53ef\u4ee5\u81ea\u5df1\u6dfb\u52a0\u7c7b\u5982 `Customtracker` \u5e76\u7ee7\u627f `Autotracker` \u6216 `Tracker`,\u7136\u540e\u5c06\u65b0\u6dfb\u52a0\u7684\u7c7b\u914d\u7f6e\u5230 `@GIOTracker`\u7684path\u4e2d\u3002\\n\u6700\u540e\u7684\u7ed3\u679c\u5c31\u662f `DemoAutotracker.get()`\u8fd4\u56de `Autotracker` \u5b9e\u4f8b\u3002\\n\\n2. **\u7b80\u5316\u914d\u7f6e**  \\n\u4e0a\u9762\u6709\u8bf4\u8fc7\uff0c`DemoAutotracker.start(Application)` \u65b9\u6cd5\u4f7f\u7528\u7684\u524d\u63d0\u5c31\u662f `@GIOTracker` \u5df2\u7ecf\u914d\u7f6e accountId \u548c urlScheme \u8fd9\u4e24\u4e2a\u521d\u59cb\u5316\u53c2\u6570\u3002\\n\\n<Tabs\\n  groupId=\\"code-language\\"\\n  defaultValue=\\"kotlin\\"\\n  values={[\\n    {label: \'java\', value: \'java\'},\\n    {label: \'kotlin\', value: \'kotlin\'},\\n  ]\\n}>\\n\\n<TabItem value=\\"java\\">\\n\\n```java\\n@GIOAppModule(name = \\"DemoAutotracker\\", configName = \\"DemoTackerConfiguration\\")\\npublic class GrowingIODemoAppModule extends AppGioModule {\\n    @GIOTracker(path = Autotracker.class, projectId = \\"<your accountId>\\", urlScheme = \\"<your urlscheme>\\")\\n    public void config(DemoTackerConfiguration config) {\\n        config.setChannel(\\"demo\\")\\n                .setProject(\\"<your accountId>\\",\\"<your urlscheme>\\")//\u82e5\u5728\u6ce8\u89e3\u4e0a\u58f0\u660e\u53ef\u4ee5\u7701\u7565\\n                .setDataCollectionEnabled(true)\\n                .setDebugEnabled(true);\\n    }\\n}\\n```\\n\\n</TabItem>\\n<TabItem value=\\"kotlin\\">\\n\\n```kotlin\\n@GIOAppModule(name = \\"DemoAutotracker\\", configName = \\"DemoTackerConfiguration\\")\\nclass GrowingIODemoAppModule : AppGioModule() {\\n    @GIOTracker(\\n        path = Autotracker::class,\\n        projectId = \\"<your accountId>\\",\\n        urlScheme = \\"<your urlscheme>\\"\\n    )\\n    fun config(config: DemoTackerConfiguration) {\\n        config.setChannel(\\"demo\\")\\n            .setProject(\\"<your accountId>\\", \\"<your urlscheme>\\") //\u82e5\u5728\u6ce8\u89e3\u4e0a\u58f0\u660e\u53ef\u4ee5\u7701\u7565\\n            .setDataCollectionEnabled(true)\\n            .setDebugEnabled(true)\\n    }\\n}\\n```\\n    \\n</TabItem>\\n</Tabs>\\n\\n### 6.\u521d\u59cb\u5316\u5e76\u8fd0\u884c\\n\\n\u5728\u4e0a\u8ff0\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u53ea\u8981\u5f88\u7b80\u5355\u7684\u5728 `Application` \u4e2d\u7684 `onCreate` \u65b9\u6cd5\u4e2d\u521d\u59cb\u5316\u5c31\u53ef\u4ee5\u4e86\u3002\\n\\n```java\\nDemoAutotracker.start(this)\\n```\\n\\n\u8fd0\u884c\u540e\uff0c\u6709\u8f93\u51fa SDK \u521d\u59cb\u5316\u6210\u529f\u7684log\u4fe1\u606f\\n\\n```txt\\n!!! Thank you very much for using GrowingIO. We will do our best to provide you with the best service. !!!\\n!!! GrowingIO Tracker version: 4.0.0 !!!\\n```\\n\u548c\u70b9\u51fb\u540e\u51fa\u73b0 click \u4e8b\u4ef6\u65e5\u5fd7\\n\\n```txt\\n    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\\n    \u2551 {\\n    \u2551   \\"eventType\\": \\"VIEW_CLICK\\",\\n    \u2551   \\"timestamp\\": 1626847839398,\\n    \u2551   ...\\n    \u2551   \\"sdkVersion\\": \\"4.0.0\\",\\n    \u2551   \\"path\\": \\"/MainActivity\\",\\n    \u2551   \\"pageShowTimestamp\\": 1626839380613,\\n    \u2551   \\"xpath\\": \\"/MainActivity/LinearLayout/FrameLayout/ActionBarOverlayLayout/ContentFrameLayout/CoordinatorLayout/FloatingActionButton\\",\\n    \u2551   \\"xcontent\\": \\"/0/0/0/decor_content_parent/0/0/fab\\",\\n    \u2551   \\"index\\": -1\\n    \u2551 }\\n    \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\\n```\\n\\n\u81f3\u6b64\uff0c\u81ea\u5b9a\u4e49SDK\u96c6\u6210\u6210\u529f\u3002\\n\\n\\n## \u81ea\u5b9a\u4e49\u6a21\u5757\\n\u81ea\u5b9a\u4e49\u6a21\u5757\u53ef\u4ee5\u8ba9\u60a8\u4f7f\u7528\u81ea\u5df1\u7684\u4ee3\u7801\u5b9e\u73b0\u7684\u529f\u80fd\u6765\u66ff\u6362\u73b0\u6709\u7684\u6a21\u5757\u529f\u80fd\u3002\\n\\n\u5728 GrowingIO SDK \u4e2d\uff0c\u6a21\u5757\u52a0\u8f7d\u5177\u6709\u552f\u4e00\u6027\u2014\u2014\u6bcf\u4e00\u4e2a\u8f93\u5165\u6e90\u4ec5\u80fd\u6ce8\u518c\u4e00\u4e2a\u6a21\u5757\uff0c\u4e14\u8be5\u6a21\u5757\u4f1a\u88ab\u540e\u6ce8\u518c\u7684\u6a21\u5757\u8986\u76d6\u3002\\n\\n<ImageLoader path=\\"blog/custom_android_sdk/custom_module\\" />\\n\\n### \u5982\u4f55\u81ea\u5b9a\u4e49\u4e00\u4e2a\u6a21\u5757\\n\\n\u4f5c\u4e3a\u4e00\u4e2a\u53ef\u6269\u5c55\u7684SDK, \u8981\u6dfb\u52a0\u6216\u66ff\u6362\u4e00\u79cd\u65b0\u7684\u6a21\u5757\u652f\u6301, \u60a8\u9700\u8981\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u6765\u6267\u884c(\u4ee5\u66ff\u6362\u7f51\u7edc\u5e93\u4e3a\u4f8b)\\n\\n1. \u5b9e\u73b0\u4e00\u4e2a ModelLoader\\n2. \u5b9e\u73b0\u4e00\u4e2a DataFetcher , \u53ef\u4ee5\u88ab\u5b9a\u4e49\u7684 ModelLoader \u8fd4\u56de\\n3. \u5b9e\u73b0\u4e00\u4e2a ModelLoaderFactory\\n4. \u5c06\u60a8\u7684\u65b0 ModelLoader \u6ce8\u518c\u5230sdk, \u4f7f\u7528 `@GIOLibraryModule`\\n\\n\u63a5\u4e0b\u6765\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a okhttp3 \u7684\u7f51\u7edc\u8bf7\u6c42\u81ea\u5b9a\u4e49\u6a21\u5757\u6765\u4e3e\u4e2a\u4f8b\u3002\\n\\n### \u6dfb\u52a0\u5fc5\u8981\u7684\u4f9d\u8d56\\n\\n\u5728 app/module \u7684 build.gradle \u4e0b\u6dfb\u52a0\u57fa\u7840\u5e93\u6838\u5fc3\uff08\u65e0\u57cb\u70b9\u548c\u57cb\u70b9\u90fd\u53ef\uff09\uff0c\u6ce8\u89e3\u5e93\u548c\u6ce8\u89e3\u89e3\u91ca\u5668.\\n\\n```groovy\\ndependencies {\\n\\t//\u57cb\u70b9\u57fa\u7840\u5e93\\n\\timplementation \'com.growingio.android:tracker-core:4.0.0\'\\n\\n\\t//\u6ce8\u89e3\u89e3\u6790\\n\\timplementation \'com.growingio.android:annotation:4.0.0\'\\n\\tannotationProcessor \'com.growingio.android:compiler:4.0.0\'\\n}\\n```\\n\\n### \u7f16\u5199\u4e00\u4e2aModelLoader\\n\u7b2c\u4e00\u6b65\u662f\u5b9e\u73b0\u4e00\u4e2a `ModelLoader` \u63a5\u53e3. \u5728\u5f00\u59cb\u4e4b\u524d, \u6211\u4eec\u9700\u8981\u51b3\u5b9a\u4e24\u4ef6\u4e8b\u60c5\uff1a\\n1. \u6211\u4eec\u8981\u5904\u7406\u4ec0\u4e48\u7c7b\u578b\u7684\u6a21\u578b( Model )?\\n2. \u5bf9\u4e8e\u90a3\u79cd\u6a21\u578b\u6211\u4eec\u5e94\u8be5\u4ea7\u51fa\u4ec0\u4e48\u7c7b\u578b\u7684\u6570\u636e( Data )?\\n\\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d, \u6211\u4eec\u5e0c\u671b\u5904\u7406\u7f51\u7edc\u8bf7\u6c42, \u56e0\u4e3a\u66ff\u6362\u5185\u7f6e\u6846\u67b6, \u6240\u4ee5 Model \u662f\u5df2\u7ecf\u9650\u5236\u4e86\u7684\u7c7b\u578b `EventUrl`.\\n\u800c\u4ece `EventUrl` \u4e2d\u4ea7\u51fa\u7684 `EventResponse` \u6570\u636e\u662f\u6a21\u5757\u9700\u8981\u8fd4\u56de\u7ed9SDK\u7684\u6570\u636e\u3002\\n\\n\u5728\u5df2\u7ecf\u77e5\u9053 `Model` \u548c `Data` \u7c7b\u578b\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5c31\u80fd\u5efa\u7acb\u4e00\u4e2a `DataLoader` \u7c7b\u63a5\u53d7\u6b63\u786e\u7684\u53c2\u6570\u7c7b\u578b\u5e76\u8fd4\u56de\u9ed8\u8ba4\u503c\u3002\\n\\n```java\\npublic class OkHttpDataLoader implements ModelLoader<EventUrl, EventResponse> {\\n\\n    private final Call.Factory client;\\n\\n    public OkHttpDataLoader(Call.Factory client) {\\n        this.client = client;\\n    }\\n\\n    @Override\\n    public LoadData<EventResponse> buildLoadData(EventUrl eventUrl) {\\n        return new LoadData<>(new OkHttpDataFetcher(client, eventUrl));\\n    }\\n\\n    public static class Factory implements ModelLoaderFactory<EventUrl, EventResponse> {\\n        private static volatile Call.Factory sInternalClient;\\n        private final Call.Factory client;\\n\\n        private static final int DEFAULT_CONNECT_TIMEOUT = 5;\\n        private static final int DEFAULT_READ_TIMEOUT = 10;\\n\\n        private static Call.Factory getsInternalClient() {\\n            if (sInternalClient == null) {\\n                synchronized (Factory.class) {\\n                    if (sInternalClient == null) {\\n                        sInternalClient = new OkHttpClient.Builder()\\n                                .connectTimeout(DEFAULT_CONNECT_TIMEOUT, TimeUnit.SECONDS)\\n                                .readTimeout(DEFAULT_READ_TIMEOUT, TimeUnit.SECONDS)\\n                                .addInterceptor(new SecurityExceptionInterceptor())\\n                                .build();\\n                    }\\n                }\\n            }\\n            return sInternalClient;\\n        }\\n\\n        public Factory() {\\n            this(getsInternalClient());\\n        }\\n\\n        public Factory(Call.Factory client) {\\n            this.client = client;\\n        }\\n\\n        @Override\\n        public ModelLoader<EventUrl, EventResponse> build() {\\n            return new OkHttpDataLoader(client);\\n        }\\n    }\\n}\\n```\\n\\n\u5176\u4e2d `Factory` \u4f5c\u7528\uff1a  \\n1. \u63d0\u4f9b\u4e86\u4e00\u4e2a\u9759\u6001\u7684 `OkHttpClient`\uff0c\u53ef\u4ee5\u907f\u514d\u6bcf\u6b21\u8bf7\u6c42\u90fd\u9700\u8981\u91cd\u65b0\u521b\u5efa\u3002\\n2. \u6a21\u5757\u6ce8\u518c\u65f6\u63d0\u4f9b\u6a21\u5757\u7684\u5177\u4f53\u5b9e\u73b0\u7c7b\uff0c\u5373\u63d0\u4f9b `ModelLoader`.\\n\\n### \u7f16\u5199DataFetcher\\n\u548c `ModelLoader` \u7c7b\u4f3c, `DataFetcher` \u63a5\u53e3\u662f\u6cdb\u578b\u7684, \u5b83\u8981\u6c42\u6211\u4eec\u6307\u5b9a\u6240\u671f\u5f85\u7684\u8fd4\u56de\u7c7b\u578b\uff0c\u5728\u7f51\u7edc\u8bf7\u6c42\u6a21\u5757\u91cc\u9762\u5373\u4e3a `EventResponse`\\n\u8fd9\u6837\u5b50\u53ef\u4ee5\u7acb\u9a6c\u5f97\u5230\u4e00\u4e2a\u6a21\u677f:\\n```java\\npublic class OkHttpDataFetcher implements HttpDataFetcher<EventResponse> {\\n    @Override\\n    public void loadData(DataCallback<? super EventResponse> callback) {}\\n\\n    @Override\\n    public EventResponse executeData() {\\n        return null;\\n    }\\n\\n    @Override\\n    public void cleanup() {}\\n\\n    @Override\\n    public void cancel() {}\\n\\n    @Override\\n    public Class<EventResponse> getDataClass() {\\n        return null;\\n    }\\n}\\n```\\n\u867d\u7136\u8fd9\u91cc\u6709\u5f88\u591a\u4e2a\u65b9\u6cd5, \u4f46\u5b83\u4eec\u4e2d\u7684\u5927\u90e8\u5206\u90fd\u5f88\u5bb9\u6613\u5b9e\u73b0\\n\\n#### getDataClass\\n\\n`getDataClass` \u6ca1\u4ec0\u4e48\u597d\u8ba8\u8bba\u7684, \u6211\u4eec\u8981\u8fd4\u56de `EventResponse`\\n\\n```java\\n@Override\\npublic Class<EventResponse> getDataClass() {\\n  return EventResponse.class;\\n}\\n```\\n\\n#### cancel\\n\u5bf9\u4e8e\u53ef\u4ee5\u53d6\u6d88\u7684\u7f51\u7edc\u8fde\u63a5\u5e93\u6216\u957f\u65f6\u95f4\u52a0\u8f7d, \u53ef\u4ee5\u901a\u8fc7 cancel() \u65b9\u6cd5\u5b9e\u73b0. \u8fd9\u5c06\u5e2e\u52a9\u52a0\u901f\u5176\u4ed6\u961f\u5217\u91cc\u7684\u52a0\u8f7d, \u5e76\u8282\u7ea6\u4e00\u4e9b CPU, \u5185\u5b58\u6216\u5176\u4ed6\u8d44\u6e90, \u5982\u679c\u6ca1\u6709\u9700\u8981\u53d6\u6d88\u7684\u64cd\u4f5c, \u53ef\u4ee5\u7559\u7a7a\u3002\\n\\n```java\\n@Override\\npublic void cancel() {\\n  // \u6267\u884ccancel\u64cd\u4f5c, \u6216\u6761\u4ef6\u8d4b\u503c\\n  isCancelled = true;\\n}\\n```\\n\\n#### cleanup\\n\u5982\u679c\u60a8\u6b63\u5728\u52a0\u8f7d\u4e00\u4e2a `InputStream` \u6216\u6253\u5f00\u4efb\u4f55 I/O \u7c7b\u7684\u8d44\u6e90, \u60a8\u9700\u8981\u8981\u5728 `cleanup()` \u65b9\u6cd5\u4e2d\u5173\u95ed\u5e76\u6e05\u7406\u8fd9\u4e9b `InputStream` \u6216\u8d44\u6e90, \u5982\u679c\u5bf9\u5e94\u6a21\u5757\u6ca1\u6709\u8d44\u6e90\u9700\u8981\u6e05\u7406, \u53ef\u4ee5\u7559\u7a7a\\n\\n```java\\n@Override\\npublic void cleanup() {\\n    if (stream != null) {\\n        try {\\n            stream.close();\\n        } catch (IOException e) {\\n            // Ignore\\n        }\\n    }\\n    if (urlConnection != null) {\\n        urlConnection.disconnect();\\n    }\\n    urlConnection = null;\\n}\\n```\\n\\n#### executeData\\n`executeData` \u662f\u6a21\u5757\u4e2d\u6240\u671f\u5f85\u60a8\u505a\u90a3\u4e9b\u7e41\u91cd\u5de5\u4f5c\u7684\u5730\u65b9, \u60a8\u53ef\u4ee5\u5f00\u542f\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42, \u4ece\u78c1\u76d8\u52a0\u8f7d\u6570\u636e, \u6216\u505a\u4efb\u4f55\u60a8\u60f3\u505a\u7684\u4e8b\u60c5. \u5728\u5f53\u524d\u5b9a\u5236\u7684\u6a21\u5757\u4e2d\u4e3b\u8981\u6267\u884c\u7f51\u7edc\u8bf7\u6c42\u5e76\u8fd4\u56de\u5bf9\u5e94\u6570\u636e.\\n```java\\n@Override\\npublic EventResponse executeData() {\\n    long startTime = LogTime.getLogTime();\\n    try {\\n        return loadDataWithRedirects(new URL(eventUrl.toUrl()), 0, null, eventUrl.getHeaders());\\n    } catch (IOException e) {\\n        if (Log.isLoggable(TAG, Log.DEBUG)) {\\n            Log.d(TAG, \\"Failed to load data for url\\", e);\\n        }\\n    } finally {\\n        if (Log.isLoggable(TAG, Log.VERBOSE)) {\\n            Log.v(TAG, \\"Finished http url fetcher fetch in \\" + LogTime.getElapsedMillis(startTime));\\n        }\\n    }\\n    return new EventResponse(false);\\n}\\n```\\n\\n#### loadData\\n`loadData` \u4e0e `executeData` \u7684\u533a\u522b\u5728\u4e8e\u63d0\u4f9b\u4e86\u4e00\u4e2a `DataCallback` \u53c2\u6570, \u60a8\u53ef\u4ee5\u5b89\u6392\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1,\u6216\u5728\u91cc\u9762\u5b9e\u73b0\u7ebf\u7a0b\u5207\u6362\u3002\\n\\n```java\\n@Override\\npublic void loadData(DataCallback<? super EventResponse> callback) {\\n    long startTime = LogTime.getLogTime();\\n    try {\\n        EventResponse result = loadDataWithRedirects(new URL(eventUrl.toUrl()), 0, null, eventUrl.getHeaders());\\n        callback.onDataReady(result);\\n    } catch (IOException e) {\\n        if (Log.isLoggable(TAG, Log.DEBUG)) {\\n            Log.d(TAG, \\"Failed to load data for url\\", e);\\n        }\\n        \\n        callback.onLoadFailed(e);\\n    } finally {\\n        if (Log.isLoggable(TAG, Log.VERBOSE)) {\\n            Log.v(TAG, \\"Finished http url fetcher fetch in \\" + LogTime.getElapsedMillis(startTime));\\n        }\\n    }\\n}\\n```\\n\\n\u5b8c\u6574\u7684 `DataFetcher` \u53ef\u4ee5\u53c2\u8003 [Github \u4e0a\u7684\u4ee3\u7801](https://github.com/growingio/growingio-sdk-android-autotracker/blob/master/growingio-network/okhttp3/src/main/java/com/growingio/android/okhttp3/OkHttpDataFetcher.java)\\n\\n### \u6dfb\u52a0\u6a21\u5757\u914d\u7f6e\\n\u5982\u679c\u6a21\u5757\u91cc\u9762\u6709\u4e9b\u914d\u7f6e\u662f\u9700\u8981\u5bf9\u5916\u5f00\u653e\u63a5\u53e3\u7684\uff0c\u90a3\u5c31\u9700\u8981\u901a\u8fc7\u81ea\u5b9a\u4e49\u4e00\u4e2a\u914d\u7f6e\u7c7b\u5f00\u653e\u51fa\u53bb\u3002\u5982 `OkhttpConfig`\uff0c\u7ee7\u627f `Configurable` \u63a5\u53e3:\\n\\n```java\\npublic class OkhttpConfig implements Configurable {\\n\\n    private int connectTimeout = 5;\\n    private int readTimeout = 10;\\n\\n    public OkhttpConfig setConnectTimeout(int connectTimeout) {\\n        this.connectTimeout = connectTimeout;\\n        return this;\\n    }\\n\\n    public OkhttpConfig setReadTimeout(int readTimeout) {\\n        this.readTimeout = readTimeout;\\n        return this;\\n    }\\n\\n    public int getConnectTimeout() {\\n        return connectTimeout;\\n    }\\n\\n    public int getReadTimeout() {\\n        return readTimeout;\\n    }\\n}\\n```\\n\u540e\u7eed\u9700\u8981\u5c06\u8be5\u914d\u7f6e\u7c7b\u914d\u7f6e\u5230\u6a21\u5757\u6ce8\u89e3\u4e2d\uff0c\u81ea\u52a8\u6ce8\u518c\u5b8c\u6210\u540e\u751f\u6210\u7684 `<Custom>TackerConfiguration` \u7c7b\u4e2d\u4f1a\u81ea\u52a8\u5305\u542b `OkhttpConfig` \u4e2d\u7684\u914d\u7f6e\u65b9\u6cd5\u4ee5\u4fbf SDK \u521d\u59cb\u5316\u65f6\u540c\u65f6\u914d\u7f6e\u3002\\n\\n### \u6dfb\u52a0\u6a21\u5757\u6ce8\u89e3\\n\u6700\u540e\u4e00\u6b65\u662f\u5c06\u6a21\u5757\u7684 `Factory` \u4e0e\u8f93\u5165\u8f93\u51fa\u6570\u636e\u7ed1\u5b9a\u4e00\u8d77\uff0c\u63d0\u4f9b\u7ed9 `TrackerRegistry` \u6ce8\u518c\u3002\u8fd9\u65f6\u5019\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\u901a\u8fc7\u6ce8\u89e3\u6ce8\u518c\u6216\u8005\u901a\u8fc7\u4ee3\u7801\u8c03\u7528\\n\\n#### \u5728Library\u6a21\u5757\u4e2d\\n\u4f7f\u7528 `@GIOLibraryModule` \u6ce8\u89e3\u548c `LibraryGioModule` \u914d\u5408\uff0c\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```java\\n@GIOLibraryModule(config = OkhttpConfig.class)\\npublic class OkhttpLibraryGioModule extends LibraryGioModule {\\n    @Override\\n    public void registerComponents(TrackerContext context) {\\n        context.getRegistry().register(EventUrl.class, EventResponse.class, new OkHttpDataLoader.Factory());\\n    }\\n}\\n\\n```\\n> `@GIOLibraryModule` \u5728\u9879\u76ee\u4e2d\u7684 Project Module \u4e2d\u4f7f\u7528\uff0c\u7ecf\u8fc7 APT \u7f16\u8bd1\u540e\u6bcf\u4e00\u4e2a Project Module \u4e2d\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u6709\u7740 `@Index` \u6ce8\u89e3\u7684\u7c7b\uff0c\u8be5\u7c7b\u4f1a\u8bb0\u5f55\u5176 Module \u4e0b\u7684\u6240\u6709`@GIOLibraryModule`\u4fe1\u606f\u3002\\n\\n#### \u5728App\u4e3b\u6a21\u5757\u4e2d\\n\u6216\u8005\u624b\u52a8\u5c06\u6a21\u5757\u653e\u5165\u5230\u4e3b\u6a21\u5757\u7684\u6ce8\u89e3\u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```java\\n@GIOAppModule(name = \\"DemoAutotracker\\", configName = \\"DemoTackerConfiguration\\",config = OkhttpConfig.class)\\npublic class GrowingIODemoAppModule extends AppGioModule {\\n    @GIOTracker(path = Autotracker.class, projectId = \\"<your accountId>\\", urlScheme = \\"<your urlscheme>\\")\\n    public void config(DemoTackerConfiguration config) {\\n        config.setChannel(\\"demo\\")\\n                .setProject(\\"<your accountId>\\",\\"<your urlscheme>\\")//\u82e5\u5728\u6ce8\u89e3\u4e0a\u58f0\u660e\u53ef\u4ee5\u7701\u7565\\n                .setDataCollectionEnabled(true)\\n                .setDebugEnabled(true);\\n    }\\n\\n    @Override\\n    public void registerComponents(TrackerContext context) {\\n        context.getRegistry().register(EventUrl.class, EventResponse.class, new OkHttpDataLoader.Factory());\\n    }\\n}\\n```\\n\\n#### \u521d\u59cb\u5316\u624b\u52a8\u6dfb\u52a0\\n\u521d\u59cb\u5316\u624b\u52a8\u6dfb\u52a0\u662f\u5728 SDK \u521d\u59cb\u5316\u65f6\u6dfb\u52a0\u529f\u80fd\u6a21\u5757\uff0c\u8f83\u4e3a\u63a8\u8350\\n\\n```java\\nGrowingTracker.startWithConfiguration(this,\\n                new CdpTrackConfiguration(\\"accountId\\", \\"urlScheme\\")\\n                ...\\n                .addPreloadComponent(new OkhttpLibraryGioModule(),new OkhttpConfig()));\\n```\\n\\n#### \u8fd0\u884c\u65f6\u624b\u52a8\u8c03\u7528\\n\u8fd0\u884c\u65f6\u624b\u52a8\u6ce8\u518c\u662f\u5728 SDK \u521d\u59cb\u5316\u5b8c\u6210\u540e\u901a\u8fc7\u8c03\u7528 `registerComponent()` \u5b9e\u73b0\\n\\n```java\\nDemoAutotracker.start(this);\\n//\u624b\u52a8\u6ce8\u518c\u6a21\u5757\u548c\u914d\u7f6e\u7c7b\\nDemoAutotracker.get().registerComponent(new OkhttpLibraryGioModule(), new OkhttpConfig());\\n```\\n\\n## \u7ed3\u675f\u8bed\\n\\n\u81f3\u6b64\uff0cGrowingIO \u7684\u4e8c\u6b21\u5f00\u53d1\u6559\u7a0b\u5168\u90e8\u8bf4\u660e\u5b8c\u6bd5\uff0c\u82e5\u662f\u8fd8\u6709\u4ec0\u4e48\u7591\u95ee\u6216\u8005\u4e0d\u61c2\u7684\u5730\u65b9\uff0c\u6b22\u8fce\u5230 [Github Discussions](https://github.com/growingio/growingio-sdk-android-autotracker/discussions) \u63d0\u51fa\u7591\u95ee\u3002"},{"id":"AutoreleasePool","metadata":{"permalink":"/growingio-sdk-docs/blog/AutoreleasePool","editUrl":"https://github.com/growingio/growingio-sdk-docs/edit/master/blog/2022-02-22-autoreleasePool.md","source":"@site/blog/2022-02-22-autoreleasePool.md","title":"\u4ece iOS AutoreleasePool \u5230\u7f16\u8bd1\u5668\u4f18\u5316","description":"main.m \u4e2d\u7684 AutoreleasePool","date":"2022-02-22T00:00:00.000Z","formattedDate":"February 22, 2022","tags":[{"label":"iOS","permalink":"/growingio-sdk-docs/blog/tags/i-os"},{"label":"AutoreleasePool","permalink":"/growingio-sdk-docs/blog/tags/autorelease-pool"},{"label":"\u7f16\u8bd1\u5668\u4f18\u5316","permalink":"/growingio-sdk-docs/blog/tags/\u7f16\u8bd1\u5668\u4f18\u5316"}],"readingTime":11.91,"hasTruncateMarker":true,"authors":[{"name":"YoloMao","title":"GrowingIO SDK Team","url":"https://github.com/YoloMao","imageURL":"https://avatars.githubusercontent.com/u/16042670?v=4"}],"frontMatter":{"slug":"AutoreleasePool","title":"\u4ece iOS AutoreleasePool \u5230\u7f16\u8bd1\u5668\u4f18\u5316","author":"YoloMao","author_title":"GrowingIO SDK Team","author_url":"https://github.com/YoloMao","author_image_url":"https://avatars.githubusercontent.com/u/16042670?v=4","tags":["iOS","AutoreleasePool","\u7f16\u8bd1\u5668\u4f18\u5316"]},"unlisted":false,"prevItem":{"title":"\u57fa\u4e8e GrowingIO \u73b0\u6709 SDK \u57fa\u7840\u4e0a\u7684\u4e8c\u6b21\u5f00\u53d1 - Android \u7bc7","permalink":"/growingio-sdk-docs/blog/custom android sdk"},"nextItem":{"title":"\u4e00\u6587\u641e\u5b9a\u524d\u7aef\u9519\u8bef\u6355\u83b7\u548c\u4e0a\u62a5","permalink":"/growingio-sdk-docs/blog/JS Error"}},"content":"main.m \u4e2d\u7684 AutoreleasePool\\n\u67d0\u6b21\u5076\u7136\u53d1\u73b0main.m\u91cc\u7684 main \u51fd\u6570\u6709\u6240\u53d8\u5316\uff0c\u7ecf\u8fc7\u4e00\u756a\u67e5\u8be2[1]\uff0c\u53d1\u73b0\u662f\u4ece Xcode 11 \u5f00\u59cb\u3002\\n<ImageLoader path=\\"blog/autoreleasepool/autoreleasepool-1\\" />\\n\u800c\u5728\u6b64\u4e4b\u524d\uff0c main \u51fd\u6570\u7684\u5b9e\u73b0\u4e3a\uff1a\\n<ImageLoader path=\\"blog/autoreleasepool/autoreleasepool-2\\" />\\n\\n\x3c!--truncate--\x3e\\n\\n\u719f\u6089 AutoreleasePool \u5e95\u5c42\u539f\u7406\u7684\u540c\u5b66\u5e94\u8be5\u90fd\u77e5\u9053\uff0c\u5728@autoreleasepool\u4f5c\u7528\u8303\u56f4\u5185\u751f\u6210\u7684\u5bf9\u8c61\uff0c\u5728 ARC \u7684\u4f5c\u7528\u4e0b\uff0c\u5c06\u52a0\u5165\u81ea\u52a8\u91ca\u653e\u6c60\u3002\u5982 Xcode 11 \u4e4b\u524d\u7684 main \u51fd\u6570\uff0c\u5b9e\u9645\u5185\u5b58\u7ba1\u7406\u5c06\u5927\u6982\u4f1a\u5c55\u5f00\u4e3a\u4ee5\u4e0b\u5b9e\u73b0\uff1a\\n```c\\nint main(int argc, char *argv[]) {\\n  void *pool = objc_autoreleasePoolPush();\\n  NSString *appDelegateClassName = NSStringFromClass([AppDelegate class]);\\n\\n\xa0\xa0// objc_autorelease(appDelegateClassName);\\n  name = objc_autoreleaseReturnValue(appDelegateClassName); \\n\\n\xa0\xa0// objc_retain(appDelegateClassName);\\n  name = objc_retainAutoreleasedReturnValue(appDelegateClassName);\\n\\n  int tmp = UIApplicationMain(argc, argv, nil, appDelegateClassName);\\n  objc_release(appDelegateClassName);\\n\\n  // \u5bf9push\u548cpop\u4e4b\u95f4\u52a0\u5165\u81ea\u52a8\u91ca\u653e\u6c60\u7684\u5bf9\u8c61\u8fdb\u884crelease\u64cd\u4f5c\uff0c\u5373[appDelegateClassName release];\\n  objc_autoreleasePoolPop(pool);\\n\\n  return tmp;\\n}\\n```\\n\u4f46\u5b9e\u9645\u4e0a\uff1a\\n\\nUIApplicationMain\u51fd\u6570\u5728\u7a0b\u5e8f\u8fd0\u884c\u671f\u95f4\u4e0d\u4f1a\u8fd4\u56de\uff0c\u56e0\u6b64\u8fd9\u91cc\u751f\u6210\u7684 appDelegateClassName \u5bf9\u8c61\u4e00\u76f4\u4f1a\u5904\u5728\u5806\u4e0a\u65e0\u6cd5\u91ca\u653e\u9020\u6210\u5185\u5b58\u6cc4\u6f0f\uff1b\\n\\n\u5e76\u4e14\u7a0b\u5e8f\u7ec8\u6b62\u4e4b\u540e\uff0c\u6240\u4f7f\u7528\u7684\u7684\u5185\u5b58\u7a7a\u95f4\u5c06\u4f1a\u7531\u7cfb\u7edf\u56de\u6536\uff0c\u81ea\u52a8\u91ca\u653e\u6c60\u7684 drain \u5728\u8fd9\u91cc\u6ca1\u6709\u610f\u4e49\u3002\\n\\n\u65b0\u7684\u6a21\u677f\u4ee3\u7801\u4e2d\uff0c\u5c06 appDelegateClassName \u5bf9\u8c61\u7684\u521d\u59cb\u5316\u64cd\u4f5c\u4e0eUIApplicationMain\u5206\u79bb\u5f00\uff0c\u5c55\u5f00\u540e\u5982\u4e0b\uff1a\\n```c\\nint main(int argc, char *argv[]) {\\n  NSString *appDelegateClassName;\\n  void *pool = objc_autoreleasePoolPush();\\n  appDelegateClassName = NSStringFromClass([AppDelegate class]);\\n\\n  // objc_autorelease(appDelegateClassName);\\n  appDelegateClassName = objc_autoreleaseReturnValue(appDelegateClassName);\\n\\n  // objc_retain(appDelegateClassName);\\n  appDelegateClassName = objc_retainAutoreleasedReturnValue(appDelegateClassName);\\n\\n  // \u672a\u77e5\u4f5c\u7528\uff0c\u5728\u6c47\u7f16\u4e2d\uff0c\u5bc4\u5b58\u5668r0\u7684\u503c\u4e3a0x0\\n  objc_release(nil);\\n\\n  // \u5bf9\u81ea\u52a8\u91ca\u653e\u6c60\u5185\u6240\u6709\u5bf9\u8c61\u8fdb\u884crelease\u64cd\u4f5c\uff0c\u5373[appDelegateClassName release];\\n  objc_autoreleasePoolPop(pool);\\n\\n  int tmp = UIApplicationMain(argc, argv, nil, appDelegateClassName);\\n  objc_storeStrong(&appDelegateClassName, nil);\\n  return tmp;\\n}\\n```\\n\\nappDelegateClassName \u5bf9\u8c61\u8fd8\u662f\u5f97\u4e0d\u5230\u91ca\u653e\uff0c\u7a0b\u5e8f\u5728\u7ec8\u6b62\u524d\u4e0d\u4f1a\u6267\u884c\u5230objc_storeStrong(&appDelegateClassName, nil);\u3002\\n\\n\u90a3\u4e48\u4fee\u6539\u7684\u610f\u4e49\u4f55\u5728\u5462\uff1f\\n\\n// Setup code that might create autoreleased objects goes here.\\n\\n\u5982\u679c\u9700\u8981\u521b\u5efa\u81ea\u52a8\u91ca\u653e\u7684\u5bf9\u8c61\uff0c\u90a3\u4e48\u73b0\u5728\uff0c\u5728@autoreleasepool\u4f5c\u7528\u57df\u5185\u521b\u5efa\u5373\u53ef\u6b63\u5e38\u91ca\u653e\u3002\\n\\n**\u6ce8\u610f\uff1a\u4ee5\u4e0a\u793a\u4f8b\u4ee3\u7801\u4e2d**\uff0cobjc_autoreleaseReturnValue(appDelegateClassName) \u5176\u5b9e\u662f\u5728 NSStringFromClass([AppDelegate class])\u4e2d\u8c03\u7528\uff0c\u8fd9\u91cc\u5c06\u5b83\u63d0\u53d6\u51fa\u6765\u65b9\u4fbf\u7406\u89e3\u3002\\n\\n### Thread Local Storage\\n\u5176\u5b9e\u5728\u4e0a\u6587\u7684\u4f2a\u5b9e\u73b0\u4e2d\uff0cobjc_autoreleaseReturnValue(appDelegateClassName)\u548cobjc_retainAutoreleasedReturnValue(appDelegateClassName)\u53ef\u4ee5\u53bb\u6389\uff0c\u8fd9\u4e00\u5207\u90fd\u5f52\u529f\u4e8e AutoreleasePool \u4e0e\u7ebf\u7a0b\u5c40\u90e8\u5b58\u50a8\uff08Thread Local Storage, TLS\uff09[2]\u7684\u914d\u5408\u3002\\n\\n\u5728 arm64 \u67b6\u6784\u4e0b\uff0cobjc_autoreleaseReturnValue\u6267\u884c\u65f6\uff0c\u4f1a\u901a\u8fc7__builtin_return_address(0)\u5224\u65ad\u5f53\u524d\u51fd\u6570\u8fd4\u56de\u5730\u5740\u5bf9\u5e94\u7684\u6c47\u7f16\u6307\u4ee4\uff0c\u662f\u5426\u662fmov fp, fp\uff0c\u5982\u679c\u662f\u7684\u8bdd\uff0c\u5c06 0x1 \u4f5c\u4e3a value\uff0cRETURN_DISPOSITION_KEY \u4f5c\u4e3a key\uff0c\u5b58\u50a8\u5728 TLS \u4e2d\uff0c\u5e76\u76f4\u63a5\u8fd4\u56de obj\uff0c\u4e0d\u6267\u884cobjc_autorelease(obj)\uff1b\\n\\n\u76f8\u5173\u6e90\u7801\u5982\u4e0b\uff1a\\n```c\\n// NSObject.mm\\n// Prepare a value at +1 for return through a +0 autoreleasing convention.\\nid \\nobjc_autoreleaseReturnValue(id obj)\\n{\\n    if (prepareOptimizedReturn(ReturnAtPlus1)) return obj;\\n\\n    return objc_autorelease(obj);\\n}\\n\\n// objc-object.h\\nenum ReturnDisposition : bool {\\n    ReturnAtPlus0 = false, ReturnAtPlus1 = true\\n};\\n\\n// Try to prepare for optimized return with the given disposition (+0 or +1).\\n// Returns true if the optimized path is successful.\\n// Otherwise the return value must be retained and/or autoreleased as usual.\\nstatic ALWAYS_INLINE bool \\nprepareOptimizedReturn(ReturnDisposition disposition)\\n{\\n    ASSERT(getReturnDisposition() == ReturnAtPlus0);\\n\\n    if (callerAcceptsOptimizedReturn(__builtin_return_address(0))) {\\n        if (disposition) setReturnDisposition(disposition);\\n        return true;\\n    }\\n\\n    return false;\\n}\\n\\n//arm64\\nstatic ALWAYS_INLINE bool \\ncallerAcceptsOptimizedReturn(const void *ra)\\n{\\n    // fd 03 1d aa    mov fp, fp\\n    // arm64 instructions are well-aligned\\n    if (*(uint32_t *)ra == 0xaa1d03fd) {\\n        return true;\\n    }\\n    return false;\\n}\\n```\\nobjc_retainAutoreleasedReturnValue\u6267\u884c\u65f6\uff0c\u5224\u65adRETURN_DISPOSITION_KEY \u5bf9\u5e94 value \u662f\u5426\u4e3a 0x1 \u5e76\u91cd\u7f6e\u4e3a 0x0\uff0c\u662f\u7684\u8bdd\uff0c\u5219\u76f4\u63a5\u8fd4\u56de obj\uff0c\u4e0d\u6267\u884cobjc_retain(obj)\uff1b\\n```c\\n// NSObject.mm\\n// Accept a value returned through a +0 autoreleasing convention for use at +1.\\nid\\nobjc_retainAutoreleasedReturnValue(id obj)\\n{\\n    if (acceptOptimizedReturn() == ReturnAtPlus1) return obj;\\n\\n    return objc_retain(obj);\\n}\\n\\n// objc-object.h\\n// Try to accept an optimized return.\\n// Returns the disposition of the returned object (+0 or +1).\\n// An un-optimized return is +0.\\nstatic ALWAYS_INLINE ReturnDisposition \\nacceptOptimizedReturn()\\n{\\n    ReturnDisposition disposition = getReturnDisposition();\\n    setReturnDisposition(ReturnAtPlus0);  // reset to the unoptimized state\\n    return disposition;\\n}\\n```\\n\u57fa\u4e8e\u4ee5\u4e0a\u4f18\u5316\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u7531\u5de5\u5382\u65b9\u6cd5\u751f\u6210\u7684\u5bf9\u8c61\u4e0d\u518d\u9700\u8981\u8fdb\u5165\u81ea\u52a8\u91ca\u653e\u6c60\uff0c\u52a0\u5feb\u4e86\u91ca\u653e\u8fc7\u7a0b\u3002\\n\\n\u53e6\u5916\uff0cmov fp, fp\u662f\u7f16\u8bd1\u5668\u5bf9\u4e8eobjc_autoreleaseReturnValue\u548cobjc_retainAutoreleasedReturnValue\u8fde\u7eed\u8c03\u7528\u6240\u505a\u7684\u4e00\u4e2a\u6807\u8bb0[3]\u3002\\n```txt\\nWell take a look at that. It\u2019s added in a mov r7, r7 in each case which is a\\nnoop (i.e. does nothing as it moves r7 back into itself). If you examine the\\nbinary values for these instructions then you\u2019ll see they match the values that\\nwe were told to compare against. The compiler has added this as a marker to\\ntell the objc_autoreleaseReturnValue that the caller is about to call\\nobjc_retainAutoreleasedReturnValue.\\n```\\n\u6309\u7167\u4ee5\u4e0a\u5206\u6790\uff0c\u65b0\u7684 main \u51fd\u6570\u6a21\u677f\u4ee3\u7801\u4e2d\uff0cappDelegateClassName \u4e0d\u4f1a\u8fdb\u5165\u81ea\u52a8\u91ca\u653e\u6c60\uff0c\u800c\u4e8b\u5b9e\u4e0a\u786e\u5b9e\u5982\u6b64\uff0c\u6267\u884c\u4ee5\u4e0b\u4ee3\u7801\uff1a\\n```c\\n#import <UIKit/UIKit.h>\\n#import \\"AppDelegate.h\\"\\n\\nextern void _objc_autoreleasePoolPrint(void);\\n\\nint main(int argc, char * argv[]) {\\n//    __weak NSString *a;\\n    NSString *appDelegateClassName;\\n    @autoreleasepool {\\n        // Setup code that might create autoreleased objects goes here.\\n        appDelegateClassName = NSStringFromClass([AppDelegate class]);\\n        _objc_autoreleasePoolPrint();\\n    }\\n\\n    return UIApplicationMain(argc, argv, nil, appDelegateClassName);\\n}\\n```\\nlldb \u6253\u5370\u7ed3\u679c\u4e3a\uff1a\\n```c\\nobjc[32590]: ##############\\nobjc[32590]: AUTORELEASE POOLS for thread 0x102493880\\nobjc[32590]: 0 releases pending.\\nobjc[32590]: [0x1]  ................  PAGE (placeholder)\\nobjc[32590]: [0x1]  ################  POOL (placeholder)\\nobjc[32590]: ##############\\n```\\n\u53ef\u4ee5\u770b\u5230\u81ea\u52a8\u91ca\u653e\u6c60\u4e2d\u6ca1\u6709 appDelegateClassName \u5bf9\u8c61\u3002\\n\\n\u7ec6\u5fc3\u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u6ce8\u610f\u5230\uff0c\u4ee5\u4e0a\u4ee3\u7801\u4e2d\u6709\u4e2a__weak\u4fee\u9970\u7684 a \u53d8\u91cf\uff0c\u5f53\u6211\u4eec\u628a\u5b83\u4e5f\u52a0\u5165\u8fd0\u884c\u4ee3\u7801\u4e2d\u65f6\uff0clldb \u6253\u5370\u7ed3\u679c\u4e3a\uff1a\\n```c\\nobjc[32676]: ##############\\nobjc[32676]: AUTORELEASE POOLS for thread 0x1025ab880\\nobjc[32676]: 2 releases pending.\\nobjc[32676]: [0x14c811000]  ................  PAGE  (hot) (cold)\\nobjc[32676]: [0x14c811038]  ################  POOL 0x14c811038\\nobjc[32676]: [0x14c811040]       0x283f9c3e0  __NSCFString\\nobjc[32676]: ##############\\n```\\nTLS \u9ed1\u9b54\u6cd5\u5931\u7075\u4e86\uff01\\n\\n### \u7f16\u8bd1\u5668\u4f18\u5316\\n\u65e2\u7136 AutoreleasePool \u4f9d\u636e\u6c47\u7f16\u5c42\u9762\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u90a3\u4e48\u6211\u4eec\u4fbf\u4ece\u6c47\u7f16\u4e2d\u4e00\u63a2\u7a76\u7adf\u3002\\n```c\\n//\u6ca1\u6709\u52a0__weak\uff1a \\n0x100072148 <+72>:  bl 0x100072478 ; symbol stub for: NSStringFromClass\\n0x10007214c <+76>:  mov x29, x29 //mov fp, fp\\n0x100072150 <+80>:  bl 0x1000724e4 ; symbol stub for: objc_retainAutoreleasedReturnValue\\n\\n\\n//\u52a0\u4e86__weak\uff1a\\n0x1001da0b8 <+76>:  bl 0x1001da418 ; symbol stub for: NSStringFromClass\\n0x1001da0bc <+80>:  str x0, [sp, #0x8] //\u5165\u6808\\n0x1001da0c0 <+84>:  b 0x1001da0c4 ; <+88> at main.m:68:30 //\u8df3\u8f6c\u5230 main.m 68:30 \u7ee7\u7eed\u6267\u884c\uff0c\u5176\u5b9e\u5c31\u662f\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740\\n0x1001da0c4 <+88>:  mov x29, x29 //mov fp, fp\\n0x1001da0c8 <+92>:  ldr x0, [sp, #0x8] //\u51fa\u6808\\n0x1001da0cc <+96>:  bl 0x1001da49c ; symbol stub for: objc_retainAutoreleasedReturnValue\\n```\\n\\n\u63cf\u8ff0\u51e0\u4e2a\u57fa\u672c\u6982\u5ff5\uff1a\\n```txt\\n\u7236\u51fd\u6570\u6267\u884c\u5b50\u51fd\u6570\u524d\uff0c\u4f1a\u5c06\u5bc4\u5b58\u5668\u4e2d\u7684\u539f\u59cb\u503c\u5b58\u50a8\u5728\u6808\u4e2d\uff0c\u5373\u5165\u6808\uff1b\\n\u5b50\u51fd\u6570\u6267\u884c\u540e\uff0c\u518d\u4ece\u6808\u4e2d\u5c06\u5185\u5bb9\u8bfb\u53d6\u5230\u5bc4\u5b58\u5668\uff0c\u5373\u51fa\u6808\uff0c\u63a5\u7740\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u6307\u4ee4\u3002\\n\u5bc4\u5b58\u5668[4]\uff1a\\nSP(Stack Pointer)\uff1a\u5806\u6808\u6307\u9488\u5bc4\u5b58\u5668\uff0c\u6307\u5411\u6808\u9876\u5730\u5740\\nFP(Frame Pointer, R29)\uff1a\u5e27\u6307\u9488\u5bc4\u5b58\u5668\uff0c\u901a\u5e38\u6307\u5411\u6808\u5e95\u5730\u5740\uff0c\u5373\u6307\u5411\u6bcd\u51fd\u6570\u4e0e\u88ab\u8c03\u7528\u7684\u5b50\u51fd\u6570\u5728\u6808\u4e2d\u7684\u4ea4\u754c\\nLR(Link Register, R30)\uff1a\u94fe\u63a5\u5bc4\u5b58\u5668\uff0c\u4fdd\u5b58\u5b50\u51fd\u6570\u8fd4\u56de\u540e\u6267\u884c\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u5185\u5b58\u5730\u5740\\n\u6307\u4ee4[5]\uff1a\\nB \u51fd\u6570\u5730\u5740\uff1a\u8df3\u8f6c\u5230\u5bf9\u5e94\u51fd\u6570\u4e2d\u6267\u884c\\nBL \u51fd\u6570\u5730\u5740\uff1a\u5c06\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740\u5b58\u653e\u5230 LR(R30) \u5bc4\u5b58\u5668\u4e2d\uff0c\u5e76\u8df3\u8f6c\u5230\u5bf9\u5e94\u51fd\u6570\u4e2d\u6267\u884c\\nMOV x0 x1\uff1a\u5bc4\u5b58\u5668\u95f4\u4f20\u503c\u6216\u8005\u5bc4\u5b58\u5668\u4e0e\u5e38\u91cf\u4e4b\u95f4\u4f20\u503c\uff0c\u5373 R0 = R1\uff0c\u5bc4\u5b58\u5668\u4e0e\u5185\u5b58\u4e4b\u95f4\u4f20\u503c\u7528 STR \\n```\\n\u5f53\u52a0\u4e86__weak\u4fee\u9970\u7b26\u540e\uff0c\u7f16\u8bd1\u5668\u5728objc_autoreleaseReturnValue\u548cobjc_retainAutoreleasedReturnValue\u4e4b\u95f4\u52a0\u5165\u4e86\u5165\u6808\uff0c\u8df3\u8f6c\uff0c\u51fa\u6808\u64cd\u4f5c\uff0c\u5bfc\u81f4callerAcceptsOptimizedReturn(__builtin_return_address(0))\u7684\u503c\u4e3a false\uff0c\u4ece\u800c\u6267\u884c\u4e86objc_autorelease\uff0c\u52a0\u5230\u4e86\u81ea\u52a8\u91ca\u653e\u6c60\u4e4b\u4e2d\u3002\\n\\n\u901a\u8fc7\u914d\u7f6e\u7f16\u8bd1\u5668\u4f18\u5316\u7ea7\u522b\u53ef\u4ee5\u53bb\u6389\u8fd9\u51e0\u6761\u6307\u4ee4\uff0cBuild Settings -> Apple Clang - Code Generation -> Optimization Level[6] -> Debug \u8bbe\u7f6e\u4e3a\u9664\u4e86 None[-O0] \u4ee5\u5916\u7684\u914d\u7f6e\u5373\u53ef\u3002\u8fd0\u884c\u4e4b\u540e\uff0c\u53ef\u4ee5\u770b\u5230 AutoreleasePool \u91cc\u4e0d\u4f1a\u518d\u52a0\u5165\u5bf9\u8c61\uff0c\u4f46\u4e5f\u51fa\u73b0\u4e00\u6761\u4fe1\u606f\uff1a\\n```txt\\nProject was compiled with optimization - stepping may behave oddly; variables may not be available.\\n```\\n\u4e00\u822c Debug \u4e0b\uff0c\u914d\u7f6e\u4e3a None[-O0]\uff0cRelease \u4e0b\u914d\u7f6e\u4e3a Fastest\uff0cSmallest[-Os]\u3002\u90a3\u4e48\u53ef\u4ee5\u786e\u5b9a\u5728\u751f\u4ea7\u73af\u5883\u4e0b\uff0c\u6b64\u4f18\u5316\u6b63\u5e38\u3002\\n\\n\u76f8\u5e94\u5730\uff0c\u5bf9\u4e8e\u5c3e\u8c03\u7528\u4f18\u5316\u5728 Debug \u4e0b\u4e0d\u8d77\u4f5c\u7528\u7684\u60c5\u51b5\uff0c\u914d\u7f6e\u4e3a Faster[-O2]\u5373\u53ef\u751f\u6548\u3002\\n\\n### \u5c3e\u8c03\u7528\u4f18\u5316\\n\u5bf9\u5c3e\u8c03\u7528\u4f18\u5316\u7684\u4ecb\u7ecd\uff0c\u8fd9\u91cc\u6709 2 \u7bc7\u4f18\u79c0\u7684\u6587\u7ae0\uff1a\\n\\n\u5c3e\u8c03\u7528\u4f18\u5316 - https://www.ruanyifeng.com/blog/2015/04/tail-call.html\\n\\niOS objc_msgSend\u5c3e\u8c03\u7528\u4f18\u5316\u673a\u5236\u8be6\u89e3 - https://juejin.cn/post/6844903664050536455\\n\\n\u5176\u4e2d\u7b2c\u4e8c\u7bc7\u6587\u7ae0\u4e2d\uff0c\u5c3e\u8c03\u7528\u4f18\u5316\u5728Release\u6a21\u5f0f\u4e0b\u624d\u4f1a\u6709\uff0cDebug\u6a21\u5f0f\u4e0b\u6ca1\u6709\u7684\u60c5\u51b5\uff0c\u4e0a\u4e00\u8282\u6709\u5199\u5230\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e Optimization Level \u89e3\u51b3\u3002\\n\\nLLVM \u7f16\u8bd1\u4f18\u5316\u662f\u901a\u8fc7 Pass \u5b9e\u73b0\u7684\uff0c\u67e5\u770b\u5f53\u524d Optimization Level \u5bf9\u5e94\u7684 Pass arguments[9]\uff1a\\n```c\\n// where X can be Os,O1,O2,O3 and O4\\nclang -OX -mllvm -debug-pass=Arguments foo.c\\n```\\n<ImageLoader path=\\"blog/autoreleasepool/autoreleasepool-3\\" />\\n\u4e0a\u56fe\u662fFaster[-O2]\u5bf9\u5e94\u7684 Pass Arguments\uff0c\u53ef\u4ee5\u770b\u5230\u5176\u4e2d\u6709\u4e00\u9879\u662f-tailcallelim[10]\uff0c\u8fd9\u4e2a Pass \u9488\u5bf9\u7684\u5c31\u662f\u5c3e\u8c03\u7528\u4f18\u5316\u3002\\n\\n```txt\\nThis file transforms calls of the current function (self recursion) followed by a\\nreturn instruction with a branch to the entry of the function, creating a loop.\\nThis pass also implements the following extensions to the basic algorithm: 1.\\nTrivial instructions between the call and return do not prevent the transformation\\nfrom taking place, though currently the analysis cannot support moving any really\\nuseful instructions (only dead ones). 2. This pass transforms functions that are\\nprevented from being tail recursive by an associative expression to use an\\naccumulator variable, thus compiling the typical naive factorial or fib\\nimplementation into efficient code. 3. TRE is performed if the function returns\\nvoid, if the return returns the result returned by the call, or if the function\\nreturns a run-time constant on all exits from the function. It is possible, though\\nunlikely, that the return returns something else (like constant 0), and can still\\nbe TRE\u2019d. It can be TRE\u2019d if all other return instructions in the function return\\nthe exact same value. 4. If it can prove that callees do not access their caller\\nstack frame, they are marked as eligible for tail call elimination (by the code\\ngenerator).\\n```\\nXcode 13.0 \u5bf9\u5e94\u7684 clang \u7248\u672c\u4e3a\uff1a Apple clang version 13.0.0 (clang-1300.0.29.3)\uff0c\u7ecf\u8fc7\u9a8c\u8bc1\uff0c\u6b64\u7248\u672c\u4e2dFast [-O, O1] \u4e2d\u6ca1\u6709-tailcallelim\\n```c\\n\u8fd9\u4e2a StackOverflow \u56de\u7b54\u4e2d[11]\u7f57\u5217\u4e86\u5404\u4e2a\u7ea7\u522b\u5bf9\u5e94\u7684 Pass\uff0c\u53ea\u66f4\u65b0\u5230\u4e86 version 6.0\uff0c\u4ec5\u4f5c\u4e3a\u53c2\u8003\\n```\\n### \u7ed3\u8bed\\n\u672c\u7bc7\u6280\u672f\u5206\u4eab\u4ece iOS AutoreleasePool \u5230 TLS \u7ebf\u7a0b\u5c40\u90e8\u5b58\u50a8\uff0c\u8fdb\u800c\u67e5\u770b\u6c47\u7f16\u4ee3\u7801\uff0c\u4e86\u89e3\u7f16\u8bd1\u5668\u4f18\u5316\uff0c\u4ece\u800c\u6269\u5c55\u5230\u5c3e\u8c03\u7528\u4f18\u5316\uff0c\u8be6\u7ec6\u63cf\u8ff0\u4e86\u6574\u4e2a\u6280\u672f\u539f\u7406\u7684\u63a2\u7d22\u5b66\u4e60\u8fc7\u7a0b\u3002\u6280\u672f\u5b66\u4e60\u65e0\u6b62\u5883\uff0c\u613f\u4f60\u6211\u5171\u52c9\u3002\\n\\n\u6b22\u8fce\u5173\u6ce8 Android \u548c iOS \u65e0\u57cb\u70b9 SDK 3.0 \u5f00\u6e90 GitHub \u4ed3\u5e93\uff0c\u4e86\u89e3\u6700\u65b0\u8fdb\u5c55\uff1a\\n\\nAndroid:\\n\\nhttps://github.com/growingio/growingio-sdk-android-autotracker \\n\\niOS:\\n\\nhttps://github.com/growingio/growingio-sdk-ios-autotracker \\n\\n### \u53c2\u8003\u8d44\u6599\\n[1] \u5982\u4f55\u7406\u89e3 Xcode 11 \u6a21\u677f\u9879\u76ee\u4e2d main.m \u7684\u53d8\u5316?: https://www.jianshu.com/p/63426e6bf7aa\\n\\n[2] \u9ed1\u5e55\u80cc\u540e\u7684Autorelease: http://blog.sunnyxx.com/2014/10/15/behind-autorelease/\\n\\n[3] How does objc_retainAutoreleasedReturnValue work?: https://www.galloway.me.uk/2012/02/how-does-objc_retainautoreleasedreturnvalue-work/\\n\\n[4] General-purpose Registers:  https://github.com/ARM-software/abi-aa/blob/master/aapcs64/aapcs64.rst#general-purpose-registers\\n\\n[5] A64 Data Transfer Instructions: https://developer.arm.com/documentation/dui0802/a/A64-Data-Transfer-Instructions?lang=en\\n\\n[6] Compiler-Level Optimizations: https://developer.apple.com/library/archive/documentation/General/Conceptual/MOSXAppProgrammingGuide/Performance/Performance.html#//apple_ref/doc/uid/TP40010543-CH9-102307\\n\\n[7] \u5c3e\u8c03\u7528\u4f18\u5316: https://www.ruanyifeng.com/blog/2015/04/tail-call.html\\n\\n[8] iOS objc_msgSend\u5c3e\u8c03\u7528\u4f18\u5316\u673a\u5236\u8be6\u89e3: https://juejin.cn/post/6844903664050536455\\n\\n[9] List of optimizations available in clang and llvm opt: https://stackoverflow.com/questions/35920795/list-of-optimizations-available-in-clang-and-llvm-opt\\n\\n[10] -tailcallelim: Tail Call Elimination: https://llvm.org/docs/Passes.html#tailcallelim-tail-call-elimination\\n\\n[11] Clang optimization levels: https://stackoverflow.com/questions/15548023/clang-optimization-levels"},{"id":"JS Error","metadata":{"permalink":"/growingio-sdk-docs/blog/JS Error","editUrl":"https://github.com/growingio/growingio-sdk-docs/edit/master/blog/2021-11-18-js error catch.md","source":"@site/blog/2021-11-18-js error catch.md","title":"\u4e00\u6587\u641e\u5b9a\u524d\u7aef\u9519\u8bef\u6355\u83b7\u548c\u4e0a\u62a5","description":"\u4f17\u6240\u5468\u77e5\uff0c\u51e0\u4e4e\u6ca1\u6709\u4e00\u4e2a\u5f00\u53d1\u8005\u80fd\u591f\u505a\u5230\u5f00\u53d1\u65f6100%\u6ca1\u6709Bug\uff0c\u90a3\u4e48\u4e00\u65e6\u6211\u4eec\u7684\u4ea7\u54c1\u51fa\u4e86\u95ee\u9898\uff0c\u5feb\u901f\u5b9a\u4f4d\u95ee\u9898\u662f\u8feb\u5207\u9700\u8981\u505a\u7684\u4e8b\u3002\u597d\u5728\u6211\u4eec\u5728Web\u573a\u666f\u4e2dJs\u8fd0\u884c\u51fa\u73b0\u5f02\u5e38\u4e0d\u4f1a\u5bfc\u81f4JS\u5f15\u64ce\u5d29\u6e83\uff0c\u6700\u591a\u53ea\u4f1a\u7ec8\u6b62\u5f53\u524d\u6267\u884c\u7684\u4efb\u52a1\u3002\u7136\u540e\u9010\u7ea7\u4e0a\u629b\u9519\u8bef\uff0c\u7c7b\u4f3c\u5192\u6ce1\u4e8b\u4ef6\uff0c\u5728\u9047\u5230\u6700\u8fd1\u7684\u4e00\u5c42catch\u65f6\u505c\u6b62\u4e0a\u629b\uff0c\u5982\u679c\u4e2d\u95f4\u90fd\u6ca1\u6709\u9519\u8bef\u5904\u7406\u7684catch\u65f6\uff0c\u76f4\u81f3window\u5bf9\u8c61\u7ed3\u675f\u3002\u90a3\u4e48\u4eca\u5929\u5c31\u4e0e\u5927\u5bb6\u4e00\u8d77\u63a2\u8ba8\u4e00\u4e0b\u6211\u4eec\u5728Web\u573a\u666f\u4e2d\u7684\u5f02\u5e38\u9519\u8bef\u6570\u636e\u5982\u4f55\u6536\u96c6\u4ee5\u53ca\u5982\u4f55\u4e0a\u62a5\u3002","date":"2021-11-18T00:00:00.000Z","formattedDate":"November 18, 2021","tags":[{"label":"JS\uff0c Error\uff0cCatch","permalink":"/growingio-sdk-docs/blog/tags/js\uff0c-error\uff0c-catch"}],"readingTime":10.205,"hasTruncateMarker":true,"authors":[{"name":"Shen Xiaowei","title":"GrowingIO SDK Team","url":"https://github.com/Anoiing","imageURL":"https://avatars.githubusercontent.com/u/23634208?v=4"}],"frontMatter":{"slug":"JS Error","title":"\u4e00\u6587\u641e\u5b9a\u524d\u7aef\u9519\u8bef\u6355\u83b7\u548c\u4e0a\u62a5","author":"Shen Xiaowei","author_title":"GrowingIO SDK Team","author_url":"https://github.com/Anoiing","author_image_url":"https://avatars.githubusercontent.com/u/23634208?v=4","tags":["JS\uff0c Error\uff0cCatch"]},"unlisted":false,"prevItem":{"title":"\u4ece iOS AutoreleasePool \u5230\u7f16\u8bd1\u5668\u4f18\u5316","permalink":"/growingio-sdk-docs/blog/AutoreleasePool"},"nextItem":{"title":"MavenCentral \u8fc1\u79fb\u6b65\u9aa4","permalink":"/growingio-sdk-docs/blog/MavenCentral"}},"content":"\u4f17\u6240\u5468\u77e5\uff0c\u51e0\u4e4e\u6ca1\u6709\u4e00\u4e2a\u5f00\u53d1\u8005\u80fd\u591f\u505a\u5230\u5f00\u53d1\u65f6100%\u6ca1\u6709Bug\uff0c\u90a3\u4e48\u4e00\u65e6\u6211\u4eec\u7684\u4ea7\u54c1\u51fa\u4e86\u95ee\u9898\uff0c\u5feb\u901f\u5b9a\u4f4d\u95ee\u9898\u662f\u8feb\u5207\u9700\u8981\u505a\u7684\u4e8b\u3002\u597d\u5728\u6211\u4eec\u5728Web\u573a\u666f\u4e2dJs\u8fd0\u884c\u51fa\u73b0\u5f02\u5e38\u4e0d\u4f1a\u5bfc\u81f4JS\u5f15\u64ce\u5d29\u6e83\uff0c\u6700\u591a\u53ea\u4f1a\u7ec8\u6b62\u5f53\u524d\u6267\u884c\u7684\u4efb\u52a1\u3002\u7136\u540e\u9010\u7ea7\u4e0a\u629b\u9519\u8bef\uff0c\u7c7b\u4f3c\u5192\u6ce1\u4e8b\u4ef6\uff0c\u5728\u9047\u5230\u6700\u8fd1\u7684\u4e00\u5c42catch\u65f6\u505c\u6b62\u4e0a\u629b\uff0c\u5982\u679c\u4e2d\u95f4\u90fd\u6ca1\u6709\u9519\u8bef\u5904\u7406\u7684catch\u65f6\uff0c\u76f4\u81f3window\u5bf9\u8c61\u7ed3\u675f\u3002\u90a3\u4e48\u4eca\u5929\u5c31\u4e0e\u5927\u5bb6\u4e00\u8d77\u63a2\u8ba8\u4e00\u4e0b\u6211\u4eec\u5728Web\u573a\u666f\u4e2d\u7684\u5f02\u5e38\u9519\u8bef\u6570\u636e\u5982\u4f55\u6536\u96c6\u4ee5\u53ca\u5982\u4f55\u4e0a\u62a5\u3002\\n\x3c!--truncate--\x3e\\n### \u9519\u8bef\u7c7b\u578b\\n\u60f3\u8981\u83b7\u53d6\u5230\u76f8\u5bf9\u5b8c\u6574\u7684\u5f02\u5e38\u9519\u8bef\u6570\u636e\uff0c\u5148\u8981\u4e86\u89e3\u5728Web\u4e2d\u5e38\u89c1\u7684\u5f02\u5e38\u9519\u8bef\u90fd\u6709\u54ea\u4e9b\u3002\\n\\n### Js\u6267\u884c\u9519\u8bef\\n\u65e5\u5e38\u6267\u884c\u4e2d\u4e3b\u8981\u6709\u540c\u6b65\u9519\u8bef\u3001\u8bed\u6cd5\u9519\u8bef\u3001\u666e\u901a\u5f02\u6b65\u4efb\u52a1\u9519\u8bef\u3001Promise\u4efb\u52a1\u9519\u8bef\u3001async\u4efb\u52a1\u9519\u8bef5\u79cd\u5e38\u89c1\u7684\u5f02\u5e38\u9519\u8bef\u3002\\n\\n### \u8d44\u6e90\u52a0\u8f7d\u9519\u8bef\\n\u4e3b\u8981\u6709\u56fe\u7247\u3001script\u3001css\u3001font\u7b49\u8d44\u6e90\u7684\u52a0\u8f7d\u9519\u8bef\u95ee\u9898\u3002\\n### \u9519\u8bef\u6355\u83b7\\ntry\u2026catch\\n\u4f5c\u4e3a\u4e00\u4e2a\u4f18\u79c0\u7684\u7a0b\u5e8f\u5458\uff0c\u9996\u5148\u6211\u4eec\u80fd\u60f3\u5230\u7684\u4e00\u5b9a\u662f try\u2026catch\uff0c\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u4e0a\u4ee3\u7801\uff1a\\n<ImageLoader path=\\"blog/JSErrorCatch/trycatch-1\\" />\\n<ImageLoader path=\\"blog/JSErrorCatch/trycatch-2\\" />\\n\\n\u56e0\u4e3a\u8d44\u6e90\u52a0\u8f7d\u6807\u7b7e\u80af\u5b9a\u4e0d\u80fd\u5728\u4ee3\u7801\u5757\u4e2d\u6267\u884c\uff0c\u56e0\u6b64\u8d44\u6e90\u52a0\u8f7d\u9519\u8bef\u80af\u5b9a\u65e0\u6cd5\u6355\u83b7\u3002\\n\\n\u57fa\u4e8e\u4e0a\u56fe\u7ed3\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u5c0f\u7ed3\u4e00\u4e0btry\u2026catch\u7684\u5904\u7406\u80fd\u529b\uff1a\\n\\n\u80fd\u6355\u83b7\u5305\u88f9\u4f53\u5185\u7684\u540c\u6b65\u6267\u884c\u9519\u8bef\u3002\\n\\n\u4e0d\u80fd\u6355\u83b7\u8bed\u6cd5\u9519\u8bef\u3002\\n\\n\u4e0d\u80fd\u6355\u83b7\u5f02\u6b65\u4efb\u52a1\u9519\u8bef\u3002\\n\\n\u4e0d\u80fd\u6355\u83b7Promise\u4efb\u52a1\u9519\u8bef\u3002\\n\\n\u4e0d\u80fd\u6355\u83b7\u8d44\u6e90\u52a0\u8f7d\u9519\u8bef\u3002\\n\\n### window.onerror\\n\u6211\u4eec\u6d4f\u89c8\u5668\u5728window\u5bf9\u8c61\u4e0a\u8fd8\u81ea\u5e26\u4e86\u4e00\u4e2aonerror\u7684\u65b9\u6cd5\uff1a\\n<ImageLoader path=\\"blog/JSErrorCatch/trycatch-3\\" />\\n\u9700\u8981\u989d\u5916\u6ce8\u610f\uff1a\u8de8\u57df\u811a\u672c\u52a0\u8f7d\u9519\u8bef\u53ea\u6709\u4e00\u4e2a\u201cScript error\u201d\uff0c\u5e76\u4e0d\u80fd\u83b7\u53d6\u5230\u9519\u8bef\u4fe1\u606f\u3002\u53ef\u4ee5\u901a\u8fc7\u5728 script \u6807\u7b7e\u4e0a\u6dfb\u52a0\u201ccrossorigin\u201d\u5c5e\u6027\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\\n\\n\u57fa\u4e8e\u4e0a\u56fe\u7ed3\u679c\uff0c\u6211\u4eec\u518d\u5c0f\u7ed3\u4e00\u4e0bwindow.onerror\u7684\u5904\u7406\u80fd\u529b\uff1a\\n\\n\u80fd\u6355\u83b7\u6240\u6709\u540c\u6b65\u6267\u884c\u9519\u8bef\u3002\\n\\n\u4e0d\u80fd\u6355\u83b7\u8bed\u6cd5\u9519\u8bef\u3002\\n\\n\u80fd\u6355\u83b7\u666e\u901a\u5f02\u6b65\u4efb\u52a1\u9519\u8bef\u3002\\n\\n\u4e0d\u80fd\u6355\u83b7Promise\u4efb\u52a1\u9519\u8bef\u3002\\n\\n\u4e0d\u80fd\u6355\u83b7async\u4efb\u52a1\u9519\u8bef\u3002\\n\\n\u4e0d\u80fd\u6355\u83b7\u8d44\u6e90\u52a0\u8f7d\u9519\u8bef\u3002\\n\\n### window.addEventListener(\u2018error\u2019)\\n\u5728Web\u9875\u9762\u4e0a\u6211\u4eec\u53ef\u4ee5\u76d1\u542c\u7edd\u5927\u591a\u6570\u4e8b\u4ef6\uff0c\u5f53\u7136\u4e5f\u5305\u62ec\u9519\u8bef\u4e8b\u4ef6\uff0c\u6211\u4eec\u4ece\u5b57\u9762\u610f\u601d\u4e0a\u6d45\u7406\u89e3\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u4e0eonerror\u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5b83\u4eec\u4fe9\u7684\u8868\u73b0\u8fd8\u662f\u6709\u4e00\u70b9\u533a\u522b\uff0c\u8fd9\u91cc\u6211\u4eec\u7ed9\u51faaddEventListener\u989d\u5916\u80fd\u6355\u83b7\u7684\u9519\u8bef\uff0c\u5176\u4ed6\u4e0eonerror\u57fa\u672c\u4e00\u81f4\uff1a\\n<ImageLoader path=\\"blog/JSErrorCatch/trycatch-4\\" />\\n\u8fd9\u91cc\u8981\u989d\u5916\u6ce8\u610f\u7684\u662f\uff1a\u5982\u679c\u662f\u5728js\u4ee3\u7801\u4e2dnew Image() \u540e\u52a0\u8f7d\u51fa\u73b0\u7684\u9519\u8bef\u662f\u65e0\u6cd5\u6355\u83b7\u7684\u3002\\n\\n\u76f8\u6bd4window.onerror\uff0c\u901a\u8fc7window.addEventListener\u7684\u65b9\u5f0f\u6211\u4eec\u53ef\u4ee5\u6355\u83b7\u8d44\u6e90\u52a0\u8f7d\u7684\u9519\u8bef\u3002\\n\\n### window.addEventListener(\u2018unhandledrejection\u2019)\\n\u521a\u624d\u6211\u4eec\u4ecb\u7ecd\u4e863\u79cd\u5e38\u89c1\u7684\u9519\u8bef\u6355\u83b7\u65b9\u5f0f\uff0c\u4f46\u90fd\u4e0d\u80fd\u6355\u83b7Promise\u4efb\u52a1\u7684\u9519\u8bef\uff0c\u8fd9\u91cc\u6709\u4eba\u4f1a\u8bf4\u4e86\uff0cPromise\u4e0d\u662f\u53ef\u4ee5\u81ea\u5df1catch\u5417\uff1f\u662f\u7684\uff0c\u4f46\u662f\u6211\u76f8\u4fe1\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u6211\u4eec\u7684\u5f00\u53d1\u540c\u5b66\u53ef\u80fd\u5e76\u4e0d\u4f1a\u4e3a\u6bcf\u4e00\u4e2aPromise\u5199\u4e00\u4e2acatch\uff0c\u6216\u8005\u53ef\u80fd\u51fa\u73b0\u6f0f\u5199\u7684\u60c5\u51b5\u3002Js\u4e3a\u6211\u4eec\u51c6\u5907\u4e86\u4e00\u4e2a\u201c\u515c\u5e95\u65b9\u6848\u201d: unhandledrejection\u4e8b\u4ef6\u76d1\u542c\u3002\u5b83\u4f1a\u5728Promise \u88abreject\uff08\u629b\u9519\uff09\u4e14\u6ca1\u6709\u88abcatch\u7684\u65f6\u5019\u89e6\u53d1\u3002\u4e0b\u9762\u4e0a\u4f8b\u5b50\uff1a\\n<ImageLoader path=\\"blog/JSErrorCatch/trycatch-5\\" />\\n\u5f53\u7136\u5982\u679c\u6211\u4eec\u5c06\u6ca1\u6709catch\u7684Promise\u653e\u5728async\u4e2d\u53bb\u6267\u884c\uff0cunhandledrejection\u4e8b\u4ef6\u76d1\u542c\u4e5f\u80fd\u6355\u83b7\u5230\u3002\u6240\u4ee5async\u4efb\u52a1\u9519\u8befunhandledrejection\u4e8b\u4ef6\u76d1\u542c\u4e5f\u662f\u53ef\u4ee5\u652f\u6301\u6355\u83b7\u7684\u3002\\n\\n**\u9898\u5916\u8bdd\uff1a**\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u4e8b\u4ef6\u7684\u540d\u79f0\u53eb\u505aunhandledrejection\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u82f1\u8bed\u8bcd\u6cd5\u654f\u9510\u7684\u7a0b\u5e8f\u5458\uff0c\u77ac\u95f4\u60f3\u5230\uff0c\u6709\u6ca1\u6709\u53ebhandledrejection\u7684\u4e8b\u4ef6\u5462\uff0c\u5982\u679c\u6709\uff0c\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u731c\u6d4b\u4f5c\u7528\u521a\u597d\u662f\u76f8\u53cd\u5462\uff1f\u8fd8\u771f\u6709\uff01\u5e76\u4e14\u6b63\u5982\u6211\u4eec\u6240\u731c\u6d4b\u7684\uff0c\u5b83\u662f\u5728Promise\u7684reject\u505a\u4e86\u5904\u7406\uff08catch\uff09\u540e\u89e6\u53d1\uff01\u8fd9\u91cc\u6211\u4eec\u5c31\u4e0d\u5c55\u5f00\u8c08\u8bba\uff0c\u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u7814\u7a76\u4e00\u4e0b\u3002\\n\\n\u56de\u5f52\u6b63\u9898\uff0c\u6211\u4eec\u901a\u8fc7\u8fd9\u4e48\u591a\u4f8b\u5b50\u6d4b\u8bd5\u4e864\u79cd\u6355\u83b7\u9519\u8bef\u7684\u65b9\u5f0f\uff0c\u603b\u7ed3\u5f97\u5230\u4e0b\u8868\uff1a\\n<ImageLoader path=\\"blog/JSErrorCatch/trycatch-6\\" />\\n\u90a3\u4e48\u6211\u4eec\u89c2\u5bdf\u8fd9\u4e2a\u8868\u683c\uff0c\u9996\u5148\u53ef\u4ee5\u770b\u5230\u8bed\u6cd5\u9519\u8bef\uff0c4\u79cd\u65b9\u5f0f\u90fd\u4e0d\u80fd\u6355\u83b7\uff0c\u4f46\u662f\u6211\u4eec\u4e00\u822c\u8ba4\u4e3a\u8bed\u6cd5\u9519\u8bef\u4e0d\u5e94\u8be5\u5728\u6267\u884c\u9636\u6bb5\u624d\u53d1\u73b0\uff0c\u5728\u6211\u4eec\u7684\u7f16\u8bd1\u4ee5\u53ca\u6d4b\u8bd5\u73af\u8282\u5c31\u53ef\u4ee5\u68c0\u67e5\u51fa\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u8003\u8651\u5c06\u5176\u6355\u83b7\u3002\u90a3\u4e48\u5176\u4ed6\u7684\u5f02\u5e38\u9519\u8bef\u6211\u4eec\u53d1\u73b0\u901a\u8fc7 addEventListener(\'onerror\') + addEventListener(\'unhandledrejection\') \u7684\u65b9\u5f0f\u6070\u597d\u80fd\u591f\u8986\u76d65\u79cd\u5f02\u5e38\u9519\u8bef\u7684\u6355\u83b7\uff0c\u4e00\u8d77\u6765\u5b9e\u73b0\u4e00\u4e0b\uff1a\\n<ImageLoader path=\\"blog/JSErrorCatch/trycatch-7\\" />\\n\u628aPromise\u53caasync\u4efb\u52a1\u4e2d\u7684\u9519\u8bef\u6355\u83b7\u540e\u7528\u540c\u6b65\u7684\u903b\u8f91\u629b\u51fa\u5373\u53ef\u8ba9onerror\u51c6\u786e\u6355\u83b7\u5230\u3002\\n\\n\u5982\u6b64\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u6211\u4eecWeb\u4e2d\u5927\u90e8\u5206\u7684\u5f02\u5e38\u95ee\u9898\u8fdb\u884c\u51c6\u786e\u6355\u83b7\u3002\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u770b\u5982\u4f55\u5c06\u9519\u8bef\u95ee\u9898\u4e0a\u62a5\u81f3\u6211\u4eec\u7684\u670d\u52a1\u5668\u8fdb\u884c\u6c47\u603b\u3002\\n\\n## \u6570\u636e\u4e0a\u62a5\\n### XMLHttpRequest\\n\u6211\u4eec\u60f3\u8981\u5c06\u6570\u636e\u4f20\u56de\u670d\u52a1\u5668\uff0c\u6700\u901a\u7528\u7684\u65b9\u5f0f\u5f53\u7136\u5c31\u662fajax\u8bf7\u6c42\uff0c\u901a\u8fc7\u6d4f\u89c8\u5668\u7684XMLHttpRequest\uff08\u8fd9\u91cc\u6211\u4eec\u4e0d\u8ba8\u8bbaIE\uff09\u7684send\u65b9\u6cd5\uff0c\u53d1\u9001post\u8bf7\u6c42\u6570\u636e\u7ed9\u670d\u52a1\u7aef\uff0c\u8fd9\u91cc\u6211\u4eec\u4e0d\u518d\u7ed9\u51fa\u5b9e\u73b0\u3002\\n\\n\u5176\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff1a\\n\\n\u6709\u4e25\u683c\u7684\u8de8\u57df\u9650\u5236\u3001\u643a\u5e26cookie\u95ee\u9898\u3002\\n\\n\u4e0a\u62a5\u8bf7\u6c42\u53ef\u80fd\u4f1a\u963b\u585e\u4e1a\u52a1\u3002\\n\\n\u8bf7\u6c42\u5bb9\u6613\u4e22\u5931\uff08\u88ab\u6d4f\u89c8\u5668\u5f3a\u5236cancel\uff09\u3002\\n\\n### Image\\n\u7531\u4e8e\u6d4f\u89c8\u5668\u5bf9\u8d44\u6e90\u6587\u4ef6\u7684\u533a\u522b\u5bf9\u5f85\uff0c\u4e3a\u4e86\u89e3\u51b3\u4e0a\u9762\u7684\u51e0\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a1x1\u5927\u5c0f\u7684\u56fe\u7247\u8fdb\u884c\u5f02\u6b65\u52a0\u8f7d\u7684\u65b9\u5f0f\u6765\u4e0a\u62a5\u3002\u56fe\u7247\u5929\u7136\u53ef\u8de8\u57df\uff0c\u53c8\u80fd\u517c\u5bb9\u6240\u6709\u7684\u6d4f\u89c8\u5668\uff0c\u800cjs\u548ccss\u7b49\u5176\u4ed6\u8d44\u6e90\u6587\u4ef6\u5219\u53ef\u80fd\u51fa\u73b0\u5b89\u5168\u62e6\u622a\u548c\u8de8\u57df\u52a0\u8f7d\u95ee\u9898\u3002\\n<ImageLoader path=\\"blog/JSErrorCatch/trycatch-8\\" />\\n\u4f46\u7531\u4e8e\u662f\u4e00\u4e2aget\u8bf7\u6c42\uff0c\u4e0a\u62a5\u7684\u6570\u636e\u91cf\u5728\u4e0d\u540c\u7684\u6d4f\u89c8\u5668\u4e0b\u4e0a\u9650\u4e0d\u4e00\u81f4\uff082kb-8kb\uff09\uff0c\u8fd9\u5c31\u53ef\u80fd\u51fa\u73b0\u8d85\u51fa\u957f\u5ea6\u9650\u5236\u800c\u65e0\u6cd5\u4e0a\u62a5\u5b8c\u6574\u6570\u636e\u7684\u60c5\u51b5\u3002\u56e0\u6b64\uff0c\u56fe\u7247\u4e0a\u62a5\u4e5f\u662f\u4e00\u4e2a\u201c\u4e0d\u5b89\u5168\u201d\u7684\u65b9\u5f0f\u3002\\n\\n### SendBeacon\\n\u8fd9\u4e2a\u65b9\u6cd5\u5929\u751f\u5c31\u662f\u4e3a\u4e86\u6570\u636e\u7edf\u8ba1\u800c\u8bbe\u8ba1\u7684\uff0c\u5b83\u89e3\u51b3\u4e86XMLHttpRequest\u548c\u56fe\u7247\u4e0a\u62a5\u7684\u7edd\u5927\u90e8\u5206\u5f0a\u7aef\uff1a\u6ca1\u6709\u8de8\u57df\u95ee\u9898\u3001\u4e0d\u963b\u585e\u4e1a\u52a1\uff0c\u751a\u81f3\u80fd\u5728\u9875\u9762unload\u9636\u6bb5\u7ee7\u7eed\u53d1\u9001\u6570\u636e\uff0c\u5b8c\u7f8e\u5730\u89e3\u51b3\u4e86\u666e\u901a\u8bf7\u6c42\u5728unload\u9636\u6bb5\u88abcancel\u5bfc\u81f4\u4e22\u6570\u636e\u7684\u95ee\u9898\uff0c\u552f\u4e00\u7684\u95ee\u9898\u5c31\u662fIE\u5e76\u4e0d\u652f\u6301\u3002\\n<ImageLoader path=\\"blog/JSErrorCatch/trycatch-9\\" />\\n\u8c03\u7528\u65b9\u5f0f\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u7c7b\u4f3c\u6211\u4eec\u53d1\u9001post\u8bf7\u6c42\uff1a\\n<ImageLoader path=\\"blog/JSErrorCatch/trycatch-10\\" />\\n\\n\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0csendBeacon\u5e76\u4e0d\u50cfXMLHttpRequest\u4e00\u6837\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9aContent-Type\uff0c\u4e14\u4e0d\u652f\u6301application/json\u7b49\u5e38\u89c1\u683c\u5f0f\u3002data\u7684\u6570\u636e\u7c7b\u578b\u5fc5\u987b\u662f ArrayBufferView \u6216 Blob, DOMString \u6216\u8005 FormData \u7c7b\u578b\u7684\u3002\u8fd9\u91cc\u7ed9\u51faBlob\u7c7b\u578b\u7684\u793a\u4f8b\u3002\\n\\n### \u5c0f\u7ed3\\n\u57fa\u4e8e\u4ee5\u4e0a3\u79cd\u4e0a\u62a5\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u57fa\u672c\u603b\u7ed3\u51fa\uff0c\u4e0a\u62a5\u6570\u636e\u5efa\u8bae\u4f18\u5148\u4f7f\u7528sendBeacon\u7684\u65b9\u5f0f\uff0c\u4e0d\u652f\u6301\u7684\u6d4f\u89c8\u5668\uff08\u4f8b\u5982IE\uff09\u5219\u964d\u7ea7\u4f7f\u7528\u56fe\u7247\u4e0a\u62a5\uff0c\u5c3d\u91cf\u907f\u514d\u76f4\u63a5\u4f7f\u7528XMLHttpRequest\u8fdb\u884c\u4e0a\u62a5\u3002\\n\\n## \u7ed3\u8bed\\n\u76ee\u524d\u4f60\u867d\u7136GrowingIO Web SDK\u73b0\u5728\u5e76\u6ca1\u6709\u5bf9\u8fd9\u4e9b\u5f02\u5e38\u9519\u8bef\u505a\u5b8c\u6574\u7684\u6536\u96c6\uff08\u56e0\u4e3a\u6211\u4eec\u7684\u4ea7\u54c1\u91cd\u70b9\u4e0d\u5728\u8fd9\uff09\uff0c\u4f46\u662f\u6211\u4eec\u6709\u9700\u8981\u7684\u7528\u6237\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u9519\u8bef\u6355\u83b7\u7684\u903b\u8f91\u5e76\u4f7f\u7528SDK\u7684\u57cb\u70b9\u65b9\u6cd5\u8fdb\u884c\u4e0a\u62a5\u3002\\n\\n\u53e6\u5916\uff0c\u6211\u4eec\u6b63\u5728Web SDK\u4e0a\u8fdb\u884c\u67b6\u6784\u6f14\u8fdb\u4e14\u5373\u5c06\u5b8c\u6210\uff0c\u521b\u65b0\u6027\u5730\u63d0\u4f9b\u4e86\u5ba2\u6237\u81ea\u5b9a\u4e49\u63d2\u4ef6\u7684\u80fd\u529b\uff01\u540e\u7eed\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u901a\u8fc7SDK\u63d0\u4f9b\u7684\u63d2\u4ef6\u80fd\u529b\uff0c\u81ea\u884c\u5f00\u53d1\u4e00\u4e2a\u9519\u8bef\u6536\u96c6\u7684\u63d2\u4ef6\uff08\u751a\u81f3\u662f\u6027\u80fd\u91c7\u96c6\u63d2\u4ef6\uff09\uff0c\u914d\u5408SDK\u539f\u6709\u529f\u80fd\u5c31\u80fd\u5b8c\u6210\u4e1a\u52a1\u8fd0\u8425\u6570\u636e\u548c\u5f00\u53d1\u6240\u9700\u7684\u9519\u8bef\u3001\u6027\u80fd\u6570\u636e\u7684\u91c7\u96c6\uff01\u656c\u8bf7\u671f\u5f85\uff01\\n\\n\u4ee5\u4e0a\u5c31\u662f\u6211\u4eec\u4eca\u5929\u4e3a\u5927\u5bb6\u5206\u4eab\u7684Web\u5e94\u7528Js\u5f02\u5e38\u9519\u8bef\u6536\u96c6\u7684\u5185\u5bb9\u3002\\n### \u53c2\u8003\u6587\u732e\uff1a\\n\\nhttps://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/try...catch\\n\\nhttps://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror\\n\\nhttps://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener\\n\\nhttps://developer.mozilla.org/zh-CN/docs/Web/API/Window/unhandledrejection_event\\n\\nhttps://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/sendBeacon"},{"id":"MavenCentral","metadata":{"permalink":"/growingio-sdk-docs/blog/MavenCentral","editUrl":"https://github.com/growingio/growingio-sdk-docs/edit/master/blog/2021-07-21-maven publish.md","source":"@site/blog/2021-07-21-maven publish.md","title":"MavenCentral \u8fc1\u79fb\u6b65\u9aa4","description":"\u968f\u7740 Jcenter \u670d\u52a1\u7684\u5373\u5c06\u8fc7\u671f\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u65b0\u7684\u4ed3\u5e93\u6765\u53d1\u884c\u6211\u4eec\u7684SDK.\u4e8e\u662f\u6211\u4eec\u627e\u4e0a\u4e86 MavenCentral\uff0c\u5e76\u9488\u5bf9\u5982\u4f55\u5728MavenCentral\u63d0\u4ea4\u5305\u5199\u4e86\u8fd9\u7bc7\u6587\u7ae0\u3002","date":"2021-07-21T00:00:00.000Z","formattedDate":"July 21, 2021","tags":[{"label":"scripts","permalink":"/growingio-sdk-docs/blog/tags/scripts"},{"label":"gradle","permalink":"/growingio-sdk-docs/blog/tags/gradle"}],"readingTime":10.575,"hasTruncateMarker":true,"authors":[{"name":"cpacm","title":"GrowingIO SDK Team","url":"https://github.com/cpacm","imageURL":"https://avatars.githubusercontent.com/u/7134104?v=4"}],"frontMatter":{"slug":"MavenCentral","title":"MavenCentral \u8fc1\u79fb\u6b65\u9aa4","author":"cpacm","author_title":"GrowingIO SDK Team","author_url":"https://github.com/cpacm","author_image_url":"https://avatars.githubusercontent.com/u/7134104?v=4","tags":["scripts","gradle"]},"unlisted":false,"prevItem":{"title":"\u4e00\u6587\u641e\u5b9a\u524d\u7aef\u9519\u8bef\u6355\u83b7\u548c\u4e0a\u62a5","permalink":"/growingio-sdk-docs/blog/JS Error"}},"content":"\u968f\u7740 Jcenter \u670d\u52a1\u7684\u5373\u5c06\u8fc7\u671f\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u65b0\u7684\u4ed3\u5e93\u6765\u53d1\u884c\u6211\u4eec\u7684SDK.\u4e8e\u662f\u6211\u4eec\u627e\u4e0a\u4e86 MavenCentral\uff0c\u5e76\u9488\u5bf9\u5982\u4f55\u5728MavenCentral\u63d0\u4ea4\u5305\u5199\u4e86\u8fd9\u7bc7\u6587\u7ae0\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u6ce8\u518c\u8d26\u53f7\\n\u524d\u5f80 [sonatype](https://issues.sonatype.org/) \u6ce8\u518c\u8d26\u53f7\uff0c\u8d26\u53f7\u6ce8\u518c\u5b8c\u6bd5\u540e\u9700\u8981\u63d0\u4e2aissue\u6765\u7533\u8bf7 groupid .\\n\\n\u5982 [OSSRH-66388](https://issues.sonatype.org/browse/OSSRH-66388) \u6240\u793a\uff0c\u5982\u679c\u662fGitHub\u6216gitlab\u4e0b\u7684\u9879\u76ee\uff0c\u53ef\u4ee5\u7533\u8bf7 `io.github.<yourname>`\u3002\\n\u5982\u679c\u662f\u57df\u540d\uff0c\u5219\u9700\u8981\u5728\u57df\u540d\u7684dns\u89e3\u6790\u4e0b\u6dfb\u52a0 TXT \u8bb0\u5f55\uff0c\u5982 [OSSRH-66397](https://issues.sonatype.org/browse/OSSRH-66397)\u4e3e\u4f8b\uff0ctxt\u524d\u7f00\u4e3aOSSRH-66397 \u503c\u4e3a\u7f51\u5740https://issues.sonatype.org/browse/OSSRH-66397.\\n\\n> \u57282021\u5e742\u6708\u524d\u7533\u8bf7\u7684\u8d26\u53f7\uff0cmaven\u4ed3\u5e93\u7684\u5730\u5740\u4e3a [https://oss.sonatype.org/](https://oss.sonatype.org/)\uff0c\u800c\u5728\u4e4b\u540e\u7533\u8bf7\u7684\u7684\u5730\u5740\u4e3a [https://s01.oss.sonatype.org/](https://s01.oss.sonatype.org/).\u4e0d\u8fc7\u4e5f\u53ef\u4ee5\u5728[sonatype](https://issues.sonatype.org/)\u4e0a\u63d0 issue \u6765\u7533\u8bf7\u53d8\u66f4\u57df\u540d\u5730\u5740\uff0c\u5982\u8fd9\u4e2aissue\u6240\u793a->[OSSRH-66964](https://issues.sonatype.org/browse/OSSRH-66964)\\n\\n \\n## Maven Central\\n\u6ce8\u518c\u7ed3\u675f\u540e\uff0c\u53ef\u4ee5\u524d\u5f80[nexus repository](https://s01.oss.sonatype.org/)\u67e5\u770b\u81ea\u5df1\u7684\u4ed3\u5e93\u3002\u5728\u4ed3\u5e93\u4e2d\u4e00\u822c\u5206\u4e3a\u4e24\u79cd\u63d0\u4ea4\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f SNAPSHOT \u7248\u672c\uff0c\u4e00\u79cd\u662f\u6b63\u5f0f\u7248\u672c\u3002\\n\u4e24\u8005\u4ed3\u5e93\u5730\u5740\u4e0d\u540c\uff0c\u5206\u522b\u4e3a\uff1ahttps://s01.oss.sonatype.org/content/repositories/snapshots \u548c https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/\\n\\n### SNAPSHOT\\nSNAPSHOT \u7248\u672c\u53ef\u4ee5\u5728\u540c\u4e00\u7248\u672c\u53f7\u4e0b\u591a\u6b21\u63d0\u4ea4\uff0c\u5f53\u5176\u4ed6\u4eba\u62c9\u53d6\u8be5\u7248\u672c\u53f7\u65f6\u4f1a\u53d6\u6700\u540e\u63d0\u4ea4\u7684\u5305\uff0c\u5982\u4e0b\u56fe\u6240\u793a\\n<ImageLoader path=\\"blog/MavenCentral/SNAPSHOT\\" />\\n\u5728 SNAPSHOT \u4ed3\u5e93\u4e2d\u540c\u4e00\u4e2a\u7248\u672c\u4e0b\u591a\u4e2a\u5305\u4f1a\u901a\u8fc7\u63d0\u4ea4\u65e5\u671f\u6765\u533a\u5206\uff0c\u8fd9\u6837\u522b\u4eba\u4f9d\u8d56\u67d0\u4e2a\u7248\u672c\u65f6\u5c31\u80fd\u83b7\u5f97\u6700\u65b0\u66f4\u65b0\u7684\u5305\u3002\\n\u540c\u65f6 SNAPSHOT \u4e0d\u4f1a\u5bf9\u63d0\u4ea4\u7684\u5305\u8fdb\u884c `close` \u64cd\u4f5c\u6765\u5bf9\u5176\u8fdb\u884c\u5ba1\u6838\uff0c\u6ca1\u6709\u4e00\u5b9a\u8981\u6709 `javadoc`\u3001`sources`\u3001`GPG\u52a0\u5bc6`\u7b49\u8981\u6c42\u3002\\n\\n### \u6b63\u5f0f\u7248\\n\u63d0\u4ea4\u6b63\u5f0f\u7248\u540e\u5305\u4f1a\u5148\u8fdb\u5165 `Staging Repositories`,\u7136\u540e\u9700\u8981\u5728\u8fd9\u91cc\u4f9d\u6b21\u6267\u884c `close` \u548c `release` \u64cd\u4f5c\uff0c`close`\u64cd\u4f5c\u4f1a\u9a8c\u8bc1\u672c\u6b21\u7684\u63d0\u4ea4\u7684\u5305\u662f\u5426\u5305\u542b `javadoc`\u3001`sources`\u3001`GPG\u52a0\u5bc6\u6587\u4ef6` \u548c `pom`\u6587\u4ef6\u7684\u5408\u6cd5\u7b49\uff0c\u901a\u8fc7\u540e\u624d\u80fd\u6267\u884c `release` \u64cd\u4f5c\u5411\u5b98\u65b9\u4ed3\u5e93\u53d1\u5e03\u3002\\n\\n<ImageLoader path=\\"blog/MavenCentral/Repositories\\" />\\n\\n## \u5f00\u59cb\u51c6\u5907\\n\\n### 1. \u914d\u7f6e GPG \u79c1\u94a5\\n```cmd\\n# \u751f\u6210\u8bc1\u4e66\uff0c\u91cc\u9762\u4f1a\u8981\u6c42\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u6709\u6548\u671f\u4e24\u5e74\u3002\\ngpg --gen-key\\n\\n# \u67e5\u770b\u516c\u94a5\\ngpg --list-keys\\n\\n# \u67e5\u770b\u79c1\u94a5\\ngpg --list-secret-keys\\n\\n# \u5c06\u8bc1\u4e66\u4e0a\u4f20 key server\uff0c\u6069\uff0c\u56fd\u5185\u9700\u8981\u4ee3\u7406\\ngpg --keyserver-options http-proxy=127.0.0.1:1087 --send-keys D81E8990E415EDE0\\n\\n# \u67e5\u770b8\u4f4d\u77edid\\ngpg --list-keys --keyid-format short\\n\\n# \u751f\u6210\u79c1\u94a5\u6587\u4ef6\uff0c\u914d\u7f6e\u5230gradle\u4f7f\u7528\\ngpg --export-secret-keys -o secring.gpg\\n\\n# \u751f\u6210base64\u6587\u4ef6\uff0c\u540e\u7eed\u653e\u5165github secrets \u4e2d\u4f7f\u7528\\nbase64 secring.gpg > secring.gpg.b64\\n```\\n\u5177\u4f53\u53ef\u53c2\u8003 [gpg\u914d\u7f6e](https://central.sonatype.org/publish/requirements/gpg/)\\n\\n### 2. \u672c\u5730\u5168\u5c40 gradle \u914d\u7f6e\\n\u627e\u5230 `.gradle`\u6587\u4ef6\u5939\u4e0bgradle.properties\u6587\u4ef6\uff0c\u5982\u4e0b\u8fdb\u884c\u914d\u7f6e\\n\\n```gradle\\n## growingio\'s config\\nNEXUS_USERNAME=<sonatype\u8d26\u53f7>\\nNEXUS_PASSWORD=<sonatype\u5bc6\u7801>\\n\\nsigning.keyId=09B66CAF\\nsigning.password=<\u751f\u6210\u8bc1\u4e66\u65f6\u7684\u8f93\u5165\u5bc6\u7801>\\nsigning.secretKeyRingFile=<\u751f\u6210\u79c1\u94a5\u6587\u4ef6\u7684\u6587\u4ef6\u8def\u5f84>\\n```\\n\\n\u5f53\u7136\u5728\u9879\u76ee\u4e0b\u7684gradle.properties\u4e5f\u540c\u6837\u751f\u6548\u3002\\n\\n### 3. \u914d\u7f6e pom \u6587\u4ef6\\n\u5728\u6839\u9879\u76ee\u4e0b\u7684 gradle.properties \u6dfb\u52a0\u4ee5\u4e0b\u914d\u7f6e\u8bf4\u660e\uff0c\u8fd9\u4e9b\u8bf4\u660e\u5c06\u4f1a\u4e00\u4e00\u586b\u5165\u5230 pom \u6587\u4ef6\u4e2d\\n\\n```xml\\nGROUP=com.growingio.android\\nPOM_DESCRIPTION=GrowingIO Android SDK Library.\\nPOM_DEVELOPER_EMAIL=sdk-integration@growingio.com\\nPOM_URL=https://github.com/growingio/growingio-sdk-android-autotracker\\nPOM_SCM_URL=https://github.com/growingio/growingio-sdk-android-autotracker\\nPOM_SCM_CONNECTION=scm:git@github.com:growingio/growingio-sdk-android-autotracker.git\\nPOM_SCM_DEV_CONNECTION=scm:git@github.com:growingio/growingio-sdk-android-autotracker.git\\nPOM_LICENCE_NAME=The Apache Software License, Version 2.0\\nPOM_LICENCE_URL=http://www.apache.org/licenses/LICENSE-2.0.txt\\nPOM_LICENCE_DIST=repo\\nPOM_DEVELOPER_ID=GrowingIo Sdk\\nPOM_DEVELOPER_NAME=GrowingIo Sdk\\n```\\n\\n### 4. \u7f16\u5199gradle\u7684maven\u4e0a\u4f20\u4ee3\u7801\\n[sonatype \u7684gradle\u6559\u7a0b](https://central.sonatype.org/publish/publish-gradle/) \u5df2\u7ecf\u8fc7\u671f\u597d\u4e45\u4e86\uff0c\u8fd9\u91cc\u63a8\u8350\u5728 Github \u4e0a\u7684[gradle-mvn-push](https://github.com/chrisbanes/gradle-mvn-push)\u3002\u540e\u9762\u7684\u6240\u6709\u6539\u52a8\u90fd\u57fa\u4e8e\u5728\u8fd9\u4e2a\u6587\u4ef6\u7248\u672c\u4e0a\u5f97\u6765\u7684\uff0c\u5177\u4f53\u5982\u4f55\u6539\u52a8\u5728\u540e\u7eed\u8bf4\u660e\u3002\\n\u793a\u4f8b\u4ee3\u7801 `publishMaven.gradle`\uff1a\\n\\n```groovy\\n/*\\n * Copyright 2021 Cpacm\\n *\\n * Licensed under the Apache License, Version 2.0 (the \\"License\\");\\n * you may not use this file except in compliance with the License.\\n * You may obtain a copy of the License at\\n *\\n *     http://www.apache.org/licenses/LICENSE-2.0\\n *\\n * Unless required by applicable law or agreed to in writing, software\\n * distributed under the License is distributed on an \\"AS IS\\" BASIS,\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n * See the License for the specific language governing permissions and\\n * limitations under the License.\\n *\\n *\\n * Based on: https://github.com/mcxiaoke/gradle-mvn-push/blob/master/gradle-mvn-push.gradle.\\n *\\n * To install in a local maven repo:\\n * 1. In the project you want to test, add mavenLocal() to the repositories list.\\n * 2. In Project, run: ./gradlew publishToMavenLocal\\n *\\n * For faster runs add: -x check when building.\\n */\\n\\napply plugin: \'maven-publish\'\\napply plugin: \'signing\'\\n\\nversion = releaseConfiguration.releaseVersion\\ngroup = GROUP\\n\\n@SuppressWarnings(\\"GrMethodMayBeStatic\\")\\ndef isReleaseBuild() {\\n    return !version.contains(\\"SNAPSHOT\\")\\n}\\n\\ndef getReleaseRepositoryUrl() {\\n    return hasProperty(\'RELEASE_REPOSITORY_URL\') ? RELEASE_REPOSITORY_URL\\n            : \'https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/\'\\n}\\n\\ndef getSnapshotRepositoryUrl() {\\n    return hasProperty(\'SNAPSHOT_REPOSITORY_URL\') ? SNAPSHOT_REPOSITORY_URL\\n            : \'https://s01.oss.sonatype.org/content/repositories/snapshots/\'\\n}\\n\\ndef getRepositoryUsername() {\\n    return hasProperty(\'USERNAME\') ? USERNAME : (hasProperty(\'NEXUS_USERNAME\') ? NEXUS_USERNAME : \'\')\\n}\\n\\ndef getRepositoryPassword() {\\n    return hasProperty(\'PASSWORD\') ? PASSWORD : (hasProperty(\'NEXUS_PASSWORD\') ? NEXUS_PASSWORD : \'\')\\n}\\n\\ndef configurePom(pom) {\\n    pom.name = POM_NAME\\n    pom.packaging = POM_PACKAGING\\n    pom.description = POM_DESCRIPTION\\n    pom.url = POM_URL\\n\\n    pom.scm {\\n        url = POM_SCM_URL\\n        connection = POM_SCM_CONNECTION\\n        developerConnection = POM_SCM_DEV_CONNECTION\\n    }\\n\\n    pom.licenses {\\n        license {\\n            name = POM_LICENCE_NAME\\n            url = POM_LICENCE_URL\\n            distribution = POM_LICENCE_DIST\\n        }\\n    }\\n\\n    pom.developers {\\n        developer {\\n            id = POM_DEVELOPER_ID\\n            name = POM_DEVELOPER_NAME\\n            email = POM_DEVELOPER_EMAIL\\n        }\\n    }\\n}\\n\\nafterEvaluate { project ->\\n    def isAndroidProject = project.plugins.hasPlugin(\'com.android.application\') || project.plugins.hasPlugin(\'com.android.library\')\\n    publishing {\\n        repositories {\\n            maven {\\n                def releasesRepoUrl = getReleaseRepositoryUrl()\\n                def snapshotsRepoUrl = getSnapshotRepositoryUrl()\\n                url = isReleaseBuild() ? releasesRepoUrl : snapshotsRepoUrl\\n                credentials(PasswordCredentials) {\\n                    username = getRepositoryUsername()\\n                    password = getRepositoryPassword()\\n                }\\n            }\\n        }\\n    }\\n\\n    if (isAndroidProject) {\\n        task androidJavadocs(type: Javadoc, dependsOn: assembleDebug) {\\n            source = android.sourceSets.main.java.source\\n            classpath += project.files(android.getBootClasspath().join(File.pathSeparator))\\n            // include BuildConfig.java\\n            classpath += project.files(project.file(\\"build/generated/source/buildConfig/debug\\"))\\n            excludes = [\'**/*.kt\']\\n        }\\n\\n        task androidJavadocsJar(type: Jar, dependsOn: androidJavadocs) {\\n            classifier = \'javadoc\'\\n            from androidJavadocs.destinationDir\\n        }\\n\\n        task androidSourcesJar(type: Jar) {\\n            classifier = \'sources\'\\n            from android.sourceSets.main.java.source\\n        }\\n\\n        android.libraryVariants.all { variant ->\\n            tasks.androidJavadocs.doFirst {\\n                classpath += files(variant.javaCompileProvider.get().classpath.files.join(File.pathSeparator))\\n            }\\n        }\\n    } else {\\n\\n        task sourcesJar(type: Jar, dependsOn: classes) {\\n            classifier = \'sources\'\\n            from sourceSets.main.allSource\\n        }\\n\\n        task javadocsJar(type: Jar, dependsOn: javadoc) {\\n            classifier = \'javadoc\'\\n            from javadoc.destinationDir\\n        }\\n\\n        artifacts {\\n            archives sourcesJar\\n            archives javadocsJar\\n        }\\n    }\\n\\n    if (JavaVersion.current().isJava8Compatible()) {\\n        allprojects {\\n            tasks.withType(Javadoc) {\\n                options.addStringOption(\'Xdoclint:none\', \'-quiet\')\\n            }\\n        }\\n    }\\n\\n    if (JavaVersion.current().isJava9Compatible()) {\\n        allprojects {\\n            tasks.withType(Javadoc) {\\n                options.addBooleanOption(\'html5\', true)\\n            }\\n        }\\n    }\\n\\n    artifacts {\\n        if (isAndroidProject) {\\n            archives androidSourcesJar\\n            archives androidJavadocsJar\\n\\n            archives project.tasks.bundleDebugAar\\n        }\\n    }\\n\\n    publishing {\\n        publications {\\n            mavenAgent(MavenPublication) {\\n                groupId GROUP\\n                artifactId POM_ARTIFACT_ID\\n                version version\\n                configurePom(pom)\\n\\n                if (isAndroidProject) {\\n                    artifact bundleReleaseAar\\n                    artifact androidSourcesJar\\n\\n                    pom.withXml {\\n                        def dependenciesNode = asNode().appendNode(\'dependencies\')\\n                        project.configurations.all { configuration ->\\n                            def name = configuration.name\\n                            // api will duplicate with implementation\\n                            if (name == \'releaseImplementation\' || name == \'implementation\') {\\n                                configuration.allDependencies.each {\\n                                    if (it.name != \\"unspecified\\" && it.version != \\"unspecified\\") {\\n                                        def groupId = it.group\\n                                        def artifactId = it.name\\n                                        if (it instanceof ProjectDependency) {\\n                                            def properties = it.getDependencyProject().getProperties()\\n                                            groupId = properties.get(\\"GROUP\\")\\n                                            artifactId = properties.get(\\"POM_ARTIFACT_ID\\")\\n                                        }\\n                                        println \\"dependencies:\\" + groupId + \\":\\" + artifactId + \\":\\" + it.version\\n                                        def dependencyNode = dependenciesNode.appendNode(\'dependency\')\\n                                        dependencyNode.appendNode(\'groupId\', groupId)\\n                                        dependencyNode.appendNode(\'artifactId\', artifactId)\\n                                        dependencyNode.appendNode(\'version\', it.version)\\n                                        dependencyNode.appendNode(\'scope\', \'compile\')\\n                                    }\\n                                }\\n                            }\\n                        }\\n                    }\\n                } else {\\n                    from components.java\\n                    artifact sourcesJar\\n                    artifact javadocsJar\\n                }\\n            }\\n\\n            if (project.plugins.hasPlugin(\'java-gradle-plugin\')) {\\n                pluginMaven(MavenPublication) {\\n                    groupId GROUP\\n                    artifactId POM_ARTIFACT_ID\\n                    version version\\n                    configurePom(pom)\\n                }\\n            }\\n        }\\n    }\\n}\\n\\nsigning {\\n    required { isReleaseBuild() && gradle.taskGraph.hasTask(\\"publish\\") }\\n    publishing.publications.all { publication ->\\n        sign publication\\n    }\\n}\\n\\n```\\n\u57fa\u672c\u4f7f\u7528\uff1a\u5728\u9700\u8981\u53d1\u5e03\u7684\u9879\u76ee\u4e0b\u6dfb\u52a0 `gradle.properties`\u6587\u4ef6\uff0c\u5e76\u6ce8\u660e `ARTIFACT_ID`\u540d\uff0c\u5982\u4e0b\uff1a\\n```xml\\nPOM_NAME=autotracker\\nPOM_ARTIFACT_ID=autotracker\\nPOM_PACKAGING=aar\\nPOM_DESCRIPTION=GrowingIO Android SDK AutoTracker.\\n```\\n\u540c\u65f6\u5728 `build.gradle` \u4e2d\u5f15\u5165\u8be5\u6587\u4ef6\\n```gradle\\napply from: \\"${rootProject.projectDir}/gradle/publishMaven.gradle\\"\\n```\\n```cmd\\n# \u4e0a\u4f20\u5230\u672c\u5730\u4ed3\u5e93\\n./gradlew publishToMavenLocal\\n\\n# \u4e0a\u4f20\u5230\u8fdc\u7a0b\u4ed3\u5e93\\n./gradlew publish\\n\\n```\\n\\n### 5. Github Ci\u811a\u672c\\nGitHub\u4e0a\u6709\u63d0\u4f9b Action \u8fd9\u4e00\u5de5\u5177\uff0c\u8be5\u5de5\u5177\u53ef\u4ee5\u5728\u7ebf\u4e0a\u8fdb\u884c\u5404\u79cd\u64cd\u4f5c\uff1a\u6bd4\u5982\u7f16\u8bd1\uff0c\u6d4b\u8bd5\uff0c\u6821\u9a8c\u7b49\uff0c\u6240\u4ee5\u6253\u5305\u4e0a\u4f20\u4e5f\u662f\u53ef\u4ee5\u7684\u3002\\n1. \u914d\u7f6e Github Secrets\\n<ImageLoader path=\\"blog/MavenCentral/Secrets\\" />\\n\u5404\u4e2a\u914d\u7f6e\u5206\u522b\u5bf9\u5e94 `\u5168\u5c40 gradle \u914d\u7f6e` \u6b65\u9aa4\u4e2d\u7684\u5404\u4e2a\u53c2\u6570\uff0c\u5176\u4e2d `SIGNING_SECRET_KEY_RING_FILE` \u662f\u79d8\u94a5\u6587\u4ef6\u7ecf\u8fc7 base64 \u540e\u4ea7\u751f\u7684\u5b57\u7b26\u4e32\u3002\\n\\n2. \u81ea\u52a8 close \u548c release\\n\u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528 [gradle-nexus-staging-plugin](https://github.com/Codearte/gradle-nexus-staging-plugin)\u7684\u63d2\u4ef6\u3002\u5b83\u80fd\u901a\u8fc7 sonatype \u7684api\u6765\u81ea\u52a8\u5b9e\u73b0 `Staging Repositories`\u4e0a\u7684close\u548crelease\u64cd\u4f5c\\n\\n3. \u5b8c\u6574ci\u811a\u672c\\n\\n```yml\\nname: Publish Maven\\non:\\n  release:\\n    types: [published]\\n\\njobs:\\n  publish:\\n    runs-on: ubuntu-latest\\n\\n    steps:\\n      - uses: actions/checkout@v2\\n\\n      - name: Set up JDK 1.8\\n        uses: actions/setup-java@v1\\n        with:\\n          java-version: 1.8\\n\\n      # Gradle \u7f13\u5b58\u914d\u7f6e\\n      - name: Cache Gradle packages\\n        uses: actions/cache@v2\\n        with:\\n          path: ~/.gradle/caches\\n          key: ${{ runner.os }}-gradle-${{ hashFiles(\'**/*.gradle\') }}\\n          restore-keys: ${{ runner.os }}-gradle\\n\\n      # \u7ed9 gradlew \u6587\u4ef6\u6388\u6743\\n      - name: Grant Permission to Execute\\n        run: |\\n          chmod +x gradlew\\n          chmod +x gradle/publishAllToMavenLocal.sh\\n\\n      # \u6784\u5efa\u9879\u76ee\\n      - name: Build with Gradle\\n        run: |\\n          bash ./gradle/publishAllToMavenLocal.sh\\n\\n      # \u89e3\u7801\u79d8\u94a5\\n      - name: Decode\\n        run: |\\n          echo \\"${{secrets.SIGNING_SECRET_KEY_RING_FILE}}\\" > ~/.gradle/secring.gpg.b64\\n          base64 -d ~/.gradle/secring.gpg.b64 > ~/.gradle/secring.gpg\\n\\n      - name: Publish to Sonatype\\n        env:\\n          NEXUS_USERNAME: ${{ secrets.NEXUS_USERNAME }}\\n          NEXUS_PASSWORD: ${{ secrets.NEXUS_PASSWORD }}\\n        run: ./gradlew publish -PNEXUS_USERNAME=\\"${NEXUS_USERNAME}\\" -PNEXUS_PASSWORD=\\"${NEXUS_PASSWORD}\\" -Psigning.keyId=${{secrets.SIGNING_KEY_ID}} -Psigning.password=${{secrets.SIGNING_PASSWORD}} -Psigning.secretKeyRingFile=$(echo ~/.gradle/secring.gpg)\\n\\n      - name: Close And Release Package\\n        env:\\n          NEXUS_USERNAME: ${{ secrets.NEXUS_USERNAME }}\\n          NEXUS_PASSWORD: ${{ secrets.NEXUS_PASSWORD }}\\n        run: ./gradlew tryCloseAndReleaseRepository -PNEXUS_USERNAME=\\"${NEXUS_USERNAME}\\" -PNEXUS_PASSWORD=\\"${NEXUS_PASSWORD}\\"\\n\\n```\\n\\n\u81f3\u6b64\uff0c\u4e00\u5957\u5b8c\u6574\u7684\u81ea\u52a8\u6253\u5305\u7cfb\u7edf\u5c31\u642d\u5efa\u5b8c\u6210\u4e86\u3002\\n\\n------\\n\u53c2\u8003\u8d44\u6599\uff1a\\n1. [github action](https://docs.github.com/cn/actions/reference/events-that-trigger-workflows)\\n2. [gradle \u914d\u7f6e](https://docs.gradle.org/current/userguide/signing_plugin.html#sec:signatory_credentials)\\n\\n## \u9644\u5f55\uff1a\u5173\u4e8e\u5728 GrowingIO \u5404\u4e2a\u4ed3\u5e93\u4e0a\u9047\u5230\u7684\u51e0\u4e2a\u95ee\u9898\\n\\n### gradle plugin \u63d2\u4ef6\u6253\u5305\\nplugin\u9879\u76ee\u5e94\u8be5\u5c5e\u4e8e java \u9879\u76ee\uff0c\u4f46\u5728 `publications`\u4e0b\u5b83\u4f1a\u5355\u72ec\u8d70 `pluginMaven`\uff0c\u6240\u4ee5\u9700\u8981\u5bf9\u5176\u505a\u7279\u522b\u5904\u7406\u6765\u89c4\u8303\u5176 ARTIFACT_ID\\n\\n```groovy\\nif (project.plugins.hasPlugin(\'java-gradle-plugin\')) {\\n    pluginMaven(MavenPublication) {\\n        groupId GROUP\\n        artifactId POM_ARTIFACT_ID\\n        version version\\n        configurePom(pom)\\n    }\\n}\\n\\n```\\n\\n### javadoc\u627e\u4e0d\u5230BuildConfig\u6587\u4ef6\\n\\n\u8fd9\u91cc\u9700\u8981\u5728\u751f\u6210 javadoc \u5305\u7684\u65f6\u5019\u6dfb\u52a0 BuildConfig\u7c7b\u7684\u8def\u5f84\u5230 classpath \u4e2d\u3002\\n```groovy\\ntask androidJavadocs(type: Javadoc, dependsOn: assembleDebug) {\\n    source = android.sourceSets.main.java.source\\n    classpath += project.files(android.getBootClasspath().join(File.pathSeparator))\\n    // include BuildConfig.java\\n    classpath += project.files(project.file(\\"build/generated/source/buildConfig/debug\\"))\\n    excludes = [\'**/*.kt\']\\n}\\n```\\n\u5f53\u7136\u53ef\u80fd\u4e0d\u540c\u7248\u672c\u7684gradle\u751f\u6210\u7684\u5730\u5740\u4e0d\u4e00\u6837\uff0c\u8bf7\u81ea\u5df1\u6d4b\u8bd5\u5e76\u6dfb\u52a0\\n\\n### \u5173\u4e8e uploadArchives\\n\u65e7\u7248\u672c Gradle \u7684task\uff0c\u4f9d\u8d56\u4e8e\u63d2\u4ef6 maven\u3002\u73b0\u5728\u4e00\u822c\u90fd\u662f\\n```groovy\\napply plugin: \'maven-publish\'\\n\\nafterEvaluate { project ->\\n    publishing {}\\n}\\n```\\n\u4e14\u5728 gradle \u7248\u672c 5.0\u540e\uff0c\u9700\u8981\u5c06 publishing \u653e\u7f6e\u5728 afterEvaluate \u4e2d\u3002\\n\\n### \u5173\u4e8e\u4f9d\u8d56\\napi\u4f9d\u8d56\u548cimplementation\u4f9d\u8d56\u4f1a\u91cd\u590d\u51fa\u73b0\u5728 `project.configurations.all`\u5faa\u73af\u4e2d(api > implementation)\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u5224\u65ad `implementation`\u5373\u53ef\\n\\n```groovy\\npom.withXml {\\n    def dependenciesNode = asNode().appendNode(\'dependencies\')\\n    project.configurations.all { configuration ->\\n        def name = configuration.name\\n        // api will duplicate with implementation\\n        if (name == \'releaseImplementation\' || name == \'implementation\') {\\n            configuration.allDependencies.each {\\n                if (it.name != \\"unspecified\\" && it.version != \\"unspecified\\") {\\n                    def groupId = it.group\\n                    def artifactId = it.name\\n                    if (it instanceof ProjectDependency) {\\n                        def properties = it.getDependencyProject().getProperties()\\n                        groupId = properties.get(\\"GROUP\\")\\n                        artifactId = properties.get(\\"POM_ARTIFACT_ID\\")\\n                    }\\n                    println \\"dependencies:\\" + groupId + \\":\\" + artifactId + \\":\\" + it.version\\n                    def dependencyNode = dependenciesNode.appendNode(\'dependency\')\\n                    dependencyNode.appendNode(\'groupId\', groupId)\\n                    dependencyNode.appendNode(\'artifactId\', artifactId)\\n                    dependencyNode.appendNode(\'version\', it.version)\\n                    dependencyNode.appendNode(\'scope\', \'compile\')\\n                }\\n            }\\n        }\\n    }\\n}\\n```"}]}')}}]);